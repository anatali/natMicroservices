<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
 
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 80%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 80%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	 
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	 
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{
	width: 700px;
    font-size: 15px;
}
k{
    color: #990000;
	font-weight: bold;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px; 
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #C0F0E0;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;
	
}    
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}       
div.remark{
	background-color: #E3F2FD;	
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}  
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
} 

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}     

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed
	
}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>
    
<head>
   
<title>MirthIntro</title></head>
    
<body>
<div id="body">
<h1>Mirth | introduction (in natMicroservices)<font size="5"></font> </h1>
<ul>
 
<li><a href="../../it.unibo.hapi2.2/userDocs/HapiUsage.html" target="web"> 
DISI - HapiUsage.html</a> (on <tt>natMicroservices .... it.unibo.hapi2.2/userDocs/</tt>) </li>
<li><a href="./MirthExperiments.html" target="web"> 
DISI - MirthExperiments.html</a> (on <tt>natMicroservices .... it.unibo.mirth.java/userDocs/MirthExperiments.html/</tt>) </li>
   
</ul>

<h2>Startup</h2>

 <center>
<table style="width:98%">
<tbody>	
<tr>
<td style="width:50%" >
<h3>What is Mirth Connect</h3> 
Mirth Connect is an open source cross-platform HL7 interface engine that enables bi-directional sending of HL7 messages between systems 
and applications over multiple transports.
<div class="remark">
Un canale e' un insieme di funzioni che generalmente costituiscono una applicazione completa.
</div>
</td>
<td><a href="http://wiki.patesco.ca/doku.php?id=hl7:mirth:tutorial" target="web">Mirth Connect Introduction and Tutorial (Patesco)</a> 
<br/>
<a href="https://www.youtube.com/watch?v=-CoTa7vhCEA" target="web">Introduction to the Mirth Connect Interface Engine VIDEO</a>
<br/><br/>
<a href="https://www.caduceus.es/en/download-mirth-connect/" target="web">Download</a> 
<br/>
<a href="https://www.sachpazidis.com/mirth-connect-installation/" target="web">MIRTH Connect installation</a> 
<br/>
<a href="https://github.com/vynca/mirth_exporter" target="web">mirth_exporter GITHUB</a> (exporter per le metriche di Prometheus)
<br/><br/>
<a href="nextgen-connect-39-user-guide.pdf" target="lab">User guide</a> 
<br/>
<a href="https://blog.galenhealthcare.com/2015/05/12/10-tips-and-tricks-to-make-mirth-connect-work-for-you/" target="lab">10 Tips and Tricks (Galen)</a> <br/>
<a href="http://www.mirthcorp.com/community/wiki/pages/viewpage.action?pageId=38798961" target="web">Mirth FHIR UserGuide</a><br/>
</td>
</tr>
<tr><td>
From <a href="www.mirthcorp.com" target="lab">www.mirthcorp.com</a> :<br/>
The Mirth suite of products includes:<br/>
<ks>Mirth Connect</ks>, the flagship product that acts as a two way interface for healthcare messaging, <br/>
<ks>Mirth Results</ks>, which collects, organizes and aggregates clinical data and can act as an EHR repository, <br/>
<ks>Mirth Match</ks>, that provides an enterprise class Entity Identification Service, <br/>
<ks>Mirth Mail</ks>, a directed exchange solution based on Nationwide Health Information Network (NwHIN) email paradigm specification, <br/>
<ks>Mirth Care</ks>, a suite of components for Patient Centered Medical Homes and Accountable Care Organizations (ACO) , <br/>
<ks>Mirth Appliances</ks>, turnkey integrated hardware and software solutions based on Mirth, <br/>
<ks>Mirth Test</ks> Drive for the clients to test different vendor applications for interoperability requirements before purchase.</ks>
 
</td>
<td><img src="./img/mirthServerManager.png" alt="mirthServerManager.png" width="50%" />
 
 <h3>Use cases</h3>

See:<br/>
 <a href="https://d2oc0ihd6a5bt.cloudfront.net/wp-content/uploads/sites/1045/2016/08/ISD-White-Paper-Mirth-Interface-Use-Cases.pdf" target="lab">
MIRTH CONNECT INTERFACE USE CASES</a><br/>

<a href="http://wiki.patesco.ca/doku.php?id=hl7:mirth:tutorial#business_use_cases_for_mirth_connect" target="lab">Business use cases for Mirth Connect (Patesco)</a><br/>

</td>
</tr>

<tr><td> 
<pre>
To clear your Java cache in Windows:
--------------------------------------------------------
Click Start > Control Panel.
Locate and double click the Java icon in the Control Panel.
Click Settings under Temporary Internet Files.
Click Delete Files.
Select all boxes and click OK on Delete Temporary Files window.
Click OK on Temporary Files Settings window.
Click OK to close the Java Control Panel.
</pre>
</td>
<td><h3>Mirth and Java</h3>
 
See:<br/>
<a href="https://www.mirthcorp.com/community/wiki/display/mirth/How+to+create+and+invoke+custom+Java+code+in+Mirth+Connect" target="lab">
How to create and invoke custom Java code in Mirth Connect</a><br/>
<a href="https://betaingegneria.it/howto/webservices/mirth/#Realizzare_un_web_service_con_Mirth" target="lab">
Mirth 1.6 (betaingegneria)</a><br/>
</td>
</tr>

 </tbody>
</table>
 </center> 
 
 <h3>Using API</h3>
 <pre>
https://localhost:8443/api/#/users/_login 
https://localhost:8443/api/#/Users/login

curl -X POST "https://localhost:8443/api/users/_login" -H "accept: application/xml" 
	-H "Content-Type: application/x-www-form-urlencoded" -d "username=admin&password=nat25650"
<kc>curl: (77) schannel: next InitializeSecurityContext failed: SEC_E_UNTRUSTED_ROOT (0x80090325) - 
Catena di certificati emessa da una Autorit√† di certificazione non disponibile nell'elenco locale.</kc>


https://localhost:8443/api/#/Channels/getChannels
 </pre>
 
 <h3>HL7251 message example</h3>
 <m><pre>
MSH|^~\&|Test EHR Application|X68||NIST Test Iz Reg|201207010822||VXU^V04^VXU_V04|NIST-IZ-001.00|P|2.5.1|||AL|ER
PID|1||D26376273^^^NIST MPI^MR||Snow^Madelynn^Ainsley^^^^L|Lam^Morgan|20070706|F||2076-8^Native Hawaiian or Other Pacific Islander^CDCREC|32 Prescott Street Ave^^Warwick^MA^02452^USA^L||^PRN^PH^^^657^5558563|||||||||2186-5^non Hispanic or Latino^CDCREC
PD1|||||||||||02^Reminder/Recall - any method^HL70215|||||A|20120701|20120701
NK1|1|Lam^Morgan^^^^^L|MTH^Mother^HL70063|32 Prescott Street Ave^^Warwick^MA^02452^USA^L|^PRN^PH^^^657^5558563
ORC|RE||IZ-783274^NDA|||||||I-23432^Burden^Donna^A^^^^^NIST-AA-1||57422^RADON^NICHOLAS^^^^^^NIST-AA-1^L
RXA|0|1|20120814||140^Influenza, seasonal, injectable, preservative free^CVX|0.5|mL^MilliLiter [SI Volume Units]^UCUM||00^New immunization record^NIP001|7832-1^Lemon^Mike^A^^^^^NIST-AA-1|^^^X68||||Z0860BB|20121104|CSL^CSL Behring^MVX|||CP|A
RXR|C28161^Intramuscular^NCIT|LD^Left Arm^HL70163
OBX|1|CE|64994-7^Vaccine funding program eligibility category^LN|1|V05^VFC eligible - Federally Qualified Health Center Patient (under-insured)^HL70064||||||F|||20120701|||VXC40^Eligibility captured at the immunization level^CDCPHINVS
OBX|2|CE|30956-7^vaccine type^LN|2|88^Influenza, unspecified formulation^CVX||||||F
OBX|3|TS|29768-9^Date vaccine information statement published^LN|2|20120702||||||F
OBX|4|TS|29769-7^Date vaccine information statement presented^LN|2|20120814||||||F
</pre></m>

<h4>TCP transformer</h4>
<pre>
var input = connectorMessage.getRawData();
//logger.info( input );
var R1  = Packages.it.unibo.mirth.java.MirthJava0.getText(input);  //static 
responseMap.put("R1", R1);
</pre>

<h4>HTTP transformer</h4>
<pre>
var inputData = connectorMessage.getRawData();
logger.info( inputData );
var R1= Packages.it.unibo.mirth.java.MirthJava0.getHtmlText(inputData);

responseMap.put("R1",R1);
var res = new Packages.it.unibo.mirth.java.MirthJava0()
responseMap.put("R1a",res.getHtmlText());
responseMap.put("R1b",res.getHtmlText());
</pre>

<h4>TODO</h4>
  
<pre>
https://www.hl7soup.com/

https://www.youtube.com/watch?v=sTkHtatz_0c
https://techno-soft.com/fhir-setup-on-mirth-connect.html/#:~:text=Find%20the%20FHIR%20zip%20file,FHIR%20Listener%20extension%20is%20installed.
https://www.youtube.com/watch?v=WkBaRwVzkl4

https://localhost:8443
 
OTHER
wget http://downloads.mirthcorp.com/mirthconnect-3.9.0.b2526-unix.tar.gz

https://www.youtube.com/watch?v=Wm2Bqs3r0hI HL7 Tutorial: Mirth Connect and HL7 Soup Message Relay

http://www.mirthcorp.com/community/wiki/display/mirthuserguidev1r7p1/TCP+Listener

docker run --name conn -p8443:8443 nextgenhealthcare/connect:3.9

https://vigyanix.com/blog/mirth-connect-series-introduction/

</pre>

<h3>Install on PC</h3>
<pre>
docker pull nextgenhealthcare/connect
docker run --name natconn  -p8443:8443 -p7001:7001 nextgenhealthcare/connect:3.9
docker run --name natconn1 -p8443:8443 -p7001:7001  brandonstevens/mirth-connect

</pre>

<h3>Install on RaspberryPi</h3>
Docker does not work
<pre>
https://www.youtube.com/watch?v=eh_ZMJsQ77g
sudo -su root

wget http://downloads.mirthcorp.com/mirthconnect-3.5.1.b194-unix.tar.gz

--unzip mirth download (update filename as necessary)
tar xvfz mirthconnect-3.5.1.b194-unix.tar.gz

--copy mirth software to an appropriate folder
mv Mirth\ Connect/ /opt/mirthconnect

--cleanup download (update filename as necessary)
rm mirthconnect-3.5.1.b194-unix.tar.gz

--start mcservice
/opt/mirthconnect/mcservice start
bash mcservice start
--verify status
/opt/mirthconnect/mcservice status
bash mcservice status

-verify 8080 in broswer
dg1.hdcbc.ca:8080

--verify 8443 in broswer
dg1.hdcbc.ca:8443
</pre>

<h2>Using Java</h2>

<table style="width:98%">
<tbody>	

<tr><td style="width:40%">we can load a <ks>jar</ks> in some (mirth-local or non-local) directory specified as a resource via <ks>Settings/Resources</ks>
<br/><br/>
when we change the library, we must click on  <ks>Reload Resource</ks>
</td>
<td><img src="./img/uniboLibMirth.png" alt="uniboLibMirth.png" width="80%"  /></td>
</tr>

<tr>
<td style="width:40%" >we can use (custom) Java classes within JavaScript
</td>
<td><pre>var R1= <ks>Packages.</ks>.it.unibo.mirth.java.MirthJava0.getHtmlText();
responseMap.put("R1",R1);
var res = new <ks>Packages.</ks>.it.unibo.mirth.java.MirthJava0()
responseMap.put("R1a",res.getHtmlText());
responseMap.put("<k>R1b</k>",res.getHtmlText());<m><kc>//selected as Response in Source</kc></m>
</pre>
</td>
</tr>


<tr><td>while a Java class is in use, the static variables are preserved</td>
<td><m><pre>package it.unibo.mirth.java;
public class <k>MirthJava0</k> {
private <k>static</k> int n = 0;
 public void doJob() {
	System.out.println("MirthJava0  doJob");
 }
 public static String getText() {
	return "MirthJava0  hello " + n++;
 }
 public static String getHtmlText() {
	return &lt;html>&lt;p>Hello From MirthJava0:"+ n++ +"&lt;/p>&lt;/html>";
 }
}</pre></m></td>
</tr>

<tr><td><h3>OUTPUT</h3><pre>
R1:  &lt;html>&lt;p>Hello From MirthJava0:0&lt;/p>&lt;/html>
R1a: &lt;html>&lt;p>Hello From MirthJava0:1&lt;/p>&lt;/html>
R1b: &lt;html>&lt;p>Hello From MirthJava0:2&lt;/p>&lt;/html>
</pre></td>
<td><img src="./img/httpMirthJavaBrowser.png" alt="httpMirthJavaBrowser.png" width="80%"  />
</td>
</tr>
<tr><td></td>
<td></td>
</tr>
 </tbody>
</table>
 <br/><br/>
 
<ol>
<li></li>
<li>
 

</li>
<li></li>
<li>while a Java class is in use, the static variables are preserved</li>
</ol>

<h2>Creating a Channel</h2>
 <a href="https://cabolabs.com/" target="web">CaboLabs</a> 
  <br/>
<a href="https://cabolabs.com/education/" target="web">CaboLabs: Health Information Systems, Interoperability and Standards Online Training Program</a> 
<br/>
<a href="https://cabolabs.com/education/program_mirth_connect_workshop.pdf" target="web">program_mirth_connect_workshop.pdf</a>

<br/>
<a href="https://www.youtube.com/watch?v=sTkHtatz_0c" target="web">Mirth Connect creating and using a channel VIDEO</a> 

 <pre>
 netstat -t
 http://localhost:8089/sample/
 curl --location --request POST 'http://localhost:8089/sample/' --header 'Content-Type: json' --form 'move=l'
 
 logger.info(connectorMessage.getRawData())
 
 curl -X POST "https://localhost:8443/api/channels/channelTcp1/messages?destinationMetaDataId=" -H "accept: application/xml" -H "Content-Type: text/plain" -d "msg2"
 Code Template: Automatic Mirth Backup https://forums.mirthproject.io/forum/mirth-connect/support/16298-code-template-automatic-mirth-backup?t=217155 
 Mirth (old, ma spiega) https://betaingegneria.it/howto/webservices/mirth/
 PAblo https://www.linkedin.com/pulse/mirth-connect-download-install-run-pablo-pazos-gutierrez?articleId=6642952560405737472
 Mirth Channel Overview BENE https://help.datica.com/hc/en-us/articles/115005322583-Mirth-Channel-Overview
 http://wiki.patesco.ca/doku.php?id=hl7:mirth:intro
 MIRTH CONNECT EXAMPLES ON DOCKER https://github.com/marlycormar/mirth-connect-channel-examples
 
 </pre>
 
<h2>Certificati</h2>

One big problem of the JRE is that it completelly ignores the Windows certificate stores. 
Instead of using the windows certificate store it uses its own implementation. Java certificates are stored in a file called  
<k>cacerts</k> located at  <k>C:\Program Files (x86)\Java\jre1.x.x_xxx\lib\security\</k>.
You can open <k>javacpl.exe</k> to get a graphical overview about the content:
<br/><br/>
You will need to import a certificate to the Java Keystore if
You are not using a SSL certificate that is signed by an authority trusted by Java.
Use of a trusted certificate is preferred and recommended because using an untrusted certificate, 
such as a self-signed certificate, will cause web services communication to fail with the 
SSLHandshakeException error. 
If you do opt to use an untrusted certificate, then you must import it into the Java keystore. 

<pre>
keytool -help
keytool -list -keystore "C:\Program Files\Java\jre1.8.0_191\lib\security\jssecacerts"  -storepass changeit
keytool -importcert -file

"C:\Program Files\Java\jdk-11.0.1\bin\keytool" -importcert -file C:\Polarion\bundled\apache\conf\certificate.crt -alias labs.polarion.com -keystore "C:\Program Files\Java\jdk-11.0.1\lib\security\jssecacerts" -storepass changeit 
"C:\Program Files\Java\jre1.8.0_191\bin" -importcert -file C:\Polarion\bundled\apache\conf\certificate.crt -alias l -keystore "C:\Program Files\Java\jre1.8.0_191\lib\security\jssecacerts" -storepass changeit 
</pre>
I can see that Mirth has a <k>truststore.jks</k> file and a <k>keystore.jks</k> file and that Mirth generates a certificate and encryption key 
on startup that is held in the <k>keystore.jks</k> file.
<br/><br/>
Understand the difference between the <em>keystore</em> (in which you have the private key and cert you prove your own identity with) 
 and the <em>trust store</em> (which determines who you trust) - and the fact that your own identity also has a 'chain' of trust to the root 
 - which is separate from any chain to a root you need to figure out 'who' you trust.<br/><br/>
From
<a href="https://mkyong.com/webservices/jax-ws/suncertpathbuilderexception-unable-to-find-valid-certification-path-to-requested-target/" target="web">
Mirth Connect creating and using a channel</a> we have a solution:

<ol>
<li>Get <a href="../../../it.unibo.qak.communicate/src/connQak/InstallCert.java" target="code">InstallCert.java</a></li>
<li>Add Trusted Keystore by running: 
<pre>java InstallCert localhost:8443</pre>
and press <ks>1</ks> when ask for input. 
It will add your localhost as a trusted keystore, and generates a file <k>jssecacerts</k>.</li>
<li>Verify Trusted Keystore: Try run the InstallCert command again, the connection should be ok now.</li>
<li>Copy the generated <a href="../../../it.unibo.qak.communicate/jssecacerts" target="code"><k>jssecacerts</k></a>
 file to your $JAVA_HOME\jre\lib\security folder. For my Eclipse:
 <pre><ks>jre1.8.0_191</ks>\lib\security </pre></li>
<li>To check thta now Mirth works, run: 
<a href="../../../it.unibo.qak.communicate/src/connQak/HttpClientTutorial.java" target="code"><k>HttpClientTutorial.java</k></a>
</li>

</ol>

<pre>
fetch('https://localhost:8443/api/channels', {
  method: 'GET',
  headers: {
    'Content-type': 'application/x-www-form-urlencoded'
  }
})
.then(console.log)
</pre>



<h2>Model Driven Health Tools (MDHT)</h2>

<a href="https://help.datica.com/hc/en-us/articles/115005322886-Navigating-Mirth" target="code">Navigating Mirth</a>
<br/><br/>
<a href="https://sourceforge.net/projects/oht-modeling/files/Releases/Runtime/" target="code">Model Driven Health Tools</a>
<br/><br/>
<a href="https://www.spheregen.com/parsing-continuity-of-care-ccd-using-mirth-and-mdht/" target="code">Parsing CCD using Mirth and MDHT</a>

<h2>Using FHIR</h2>
<h3>Setup</h3>
<a href="http://www.mirthcorp.com/community/wiki/pages/viewpage.action?pageId=38798954" target="code">FHIR Connector Extension (3.9)</a><br/>
<a href="https://techno-soft.com/fhir-setup-on-mirth-connect.html/#:~:text=Find%20the%20FHIR%20zip%20file,FHIR%20Listener%20extension%20is%20installed." target="web">FHIR Setup on Mirth Connect</a> 
<a href="http://www.mirthcorp.com/community/wiki/pages/viewpage.action?pageId=38798991">Getting the FHIR Connector (3.9)</a><br/>
After restarting the server, make sure that you launch the <tt>Mirth Administrator</tt> by clicking the Launch 
<tt>Mirth Connect Administrator</tt> button and not using a previously downloaded <k>JNLP</k> file.
 <br/>  <br/> 
The FHIR Listener connector acts much like an HTTP Listener but also includes an assortment of FHIR-specific settings 
as well as some helper/utility classes for working with responses.  <br/> 
There is also an FHIR Sender destination connector and a new FHIR Resource Builder available 
as both a transformer step type and code template type. 
<a href="https://github.com/nextgenhealthcare/fhir-example-channels/tree/master/channels">fhir-example-channels GIT</a><br/>
<h3>Examples</h3>
<a href="https://nilkamaldp.wordpress.com/fhir-implementation-using-mirth/" target="code">FHIR Implementation Using Mirth</a>
explains what is reported in 
<a href="http://www.mirthcorp.com/community/wiki/pages/viewpage.action?pageId=38798957" target="code">Mirth Example Channel (R4)</a>.<br/>
 See <a href="./MirthExperiments.html#fhir" target="web"> DISI - MirthExperiments.html | fhir</a><br/>
 
See also <a href="https://www.hl7.org/fhir/patient-example.json.html" target="code">FHIR R4 - Patient-example.json</a>.<br/>
<br/>

<br/><br/>
<table style="width:98%">
<tbody>	
<tr>
<td style="width:50%" >
</td>
<td>
</td>
</tr>
<tr><td>
</td>
<td></td>
</tr>
 </tbody>
</table>
 <br/><br/>
 </div>    

 

<div style="background-color:rgba(86, 56, 253, 0.9); width:100%;text-align:center;font-size:small;color:white">
By AN Unibo-DISI  
</div> 

</body>
</html>


 
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
 
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 80%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 80%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	 
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	 
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{
	width: 700px;
    font-size: 15px;
}
k{
    color: #990000;
	font-weight: bold;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px; 
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #C0F0E0;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;
	
}    
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}       
div.remark{
	background-color: #E3F2FD;	
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}  
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
} 

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}     

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed
	
}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>
    
<head>
   
<title>MirthExperiments</title></head>
    
<body>
<div id="body">
<h1>Mirth | experiments (in natMicroservices)<font size="5"></font> </h1>
<ul>
<li><a href="../../../natmaterial/health/userDocs/HealthReferences.html" target="web"> 
DISI - HealthReferences.html</a> (on <tt>natmaterial .... health/userDocs/</tt>) </li>
<li><a href="../../../natmaterial/health/userDocs/HealthReferences.html" target="web">DISI - HealthReferences.html </a></li>
 <li><a href="./MirthIntro.html" target="web"> 
DISI - MirthIntro.html</a> (on <tt>natMicroservices .... it.unibo.mirth.java/userDocs/MirthExperiments.html/</tt>) </li>
<li><a href="../../it.unibo.hapi2.2/userDocs/HapiUsage.html" target="web"> 
DISI - HapiUsage.html</a> (on <tt>natMicroservices .... it.unibo.hapi2.2/userDocs/</tt>) </li>
<li><a href="../../../Evolution/it.unibo.mirth.java/userDocs/HapiFhirUsage.html" target="web"> 
DISI - HapiFhirUsage.html</a> (on <tt>natMicroservices .... it.unibo.mirth.java/userDocs/</tt>) </li>

</ul>


<h2>Tools </h2>
<table style="width:98%">
<tbody>	
<tr><td style="width:25%">Using Mirth-API
</td>
<td ><a href="../src/it/unibo/mirth/java/MirthApiUsage.java" target="code">MirthApiUsage.java</a> (by DISI) </td>
</tr>

<tr><td>SmartHL7</td>
<td>
<a href="https://smarthl7.com/" target="web">Free HL7 Tool Viewer Editor Filter Sender Receiver</a> 
</td>
</tr>
 </tbody>
</table>

<h2>Channel TCP</h2>

<table style="width:98%">
<tbody>	
<tr>
<td style="width:25%" ><a href="../uniboChannels/channelTcp1.xml" target="code">channelTcp1</a>
</td>
<td>A TCP listener con data=<k>raw</k> on port=<tt>7001</tt>, Destination=<tt>JavaScrpt Writer</tt>:
<pre>
logger.info(connectorMessage.getRawData())
</pre>
A TCP sender: <a href="../src/it/unibo/mirth/java/TCPClientMirth.java" target="code">TCPClientMirth.java</a>.
<br/><br/>
</td>
</tr>

<tr>
<td style="width:25%" ><a href="../uniboChannels/channelTcp1.xml" target="code">channelTcp1</a>
</td>
<td>A TCP listener con data=<k>raw</k> on port=<tt>7002</tt>, Destination=<tt>Channel Writer</tt>, Transformer:
<pre>
var input = connectorMessage.getRawData();
logger.info( input );
var R1  = <k>Packages.</k>it.unibo.mirth.java.MirthJava0.getText(input);  <kc>//RESPONSE</kc>
responseMap.put("R1", R1);
</pre>
A user-defined Java library: <a href="../src/it/unibo/mirth/java/MirthJava0.java" target="code">MirthJava0.java</a>
<br/><br/>
<k>Problem</k>: not able to receive an answer sent by the TCP listener.
<br/><br/>
</td>
</tr>

<tr><td> 
</td>
<td> </td>
</tr>

<tr><td>
</td>
<td></td>
</tr>
 </tbody>
</table>

<h2 id="fhir">FHIR</h2>
See <a href="../../../natmaterial/fhir-example-channels/channels" target="web">fhir-example-channels/channels</a> 
 (in natmaterial: a repository of sample channels, code template libraries, and transformers that can be used with the 
FHIR Connector Extension).<br/>

<h3>Example</h3>
<a href="https://nilkamaldp.wordpress.com/fhir-implementation-using-mirth/" target="code">FHIR Implementation Using Mirth</a>
explains what is reported in 
<a href="http://www.mirthcorp.com/community/wiki/pages/viewpage.action?pageId=38798957" target="code">Mirth Example Channel (R4)</a>.<br/>

<ul>
<li>This example channel depends on a database to store resource information. It is set up to support PostgreSQL or SQL Server, 
though you can modify the code templates to support others.</li>
<li>The example channel also relies on some configuration map properties to store database connection information. 
If you don't already have configuration map properties set, you can just import this file:
<pre>
PostgreSQL:
 The type of database server (postgres, sqlserver).fhirDBDatabaseType = postgres
 # The JDBC Driver class to use when connecting to the FHIR database.fhirDBDriver = org.postgresql.Driver
 # The JDBC connection URL to use when connecting to the FHIR database.fhirDBUrl = jdbc:postgresql://localhost:5432/fhirdb
 # The username to use when connecting to the FHIR database.fhirDBUsername = postgres
 # The password to use when connecting to the FHIR database.fhirDBPassword = postgres
 # The maximum amount of retry attempts when a database connection fails.fhirDBMaxRetries = 3
</pre>
Otherwise, you can just add them to the configuration map table.
</li>
<li>certain interactions have been selectively enabled for certain resource types</li>
<li>We use destination set filtering to decide in advance which destination to send a message to. 
Each destination is named according to one of the possible FHIR interactions, like 'create' or 'update.'</li>

<li>'create' destination: the JavaScript Writer takes a resource posted to the channel and stores it in the database.
It uses <tt>FhirResponseFactory</tt> to create a <tt>FhirResponse</tt> object. <br/><br/>
'read' destination: similar code to select resource data from the same database table and return the data in an appropriate 
<tt>FhirResponse</tt> object. 
<m><pre>
try {
    var fhirVersion = $('fhirVersion');
    var type = $('fhirType').toLowerCase();
    var id = $('fhirId');
    
    var result = getResource(type, id);
    
    if (result.next()) {
        var version = new String(result.getInt('version'));
        var data = getResultSetString(result, 'data');
        var contentType = getResultSetString(result, 'mimetype');
        var lastModified = getResultSetDate(result, 'last_modified');
        var deleted = result.getBoolean('deleted');

        if (deleted) {
            return createOperationOutcome('error', 'processing', $('fhirType') + ' ID ' + id + ' has been deleted.', fhirVersion, 410);
        } else {
            var response = FhirResponseFactory.getReadResponse(data, version, lastModified, 200, contentType);
            responseMap.put('response', response);
            return response.getMessage();
        }
    } else {
        return createOperationOutcome('error', 'processing', $('fhirType') + ' ID ' + id + ' not found.', fhirVersion, 404);
    }
} catch (e) {
    return createOperationOutcome('error', 'transient', 'Error reading resource.', fhirVersion, 500, e);
}
</pre></m>

</li>

<li>request the home page at the URL <ks>http://localhost:9001/r4/</ks>, or the conformance statement at the URL 
<ks>http://localhost:9001/r4/metadata</ks>. </li>

<li>create a new Patient resource. POST a request to <tt>http://localhost:9001/r4/Patient</tt>.
<br/>
If you choose an XML-formatted resource, use  <tt>application/fhir+xml</tt>  for the Content-Type. <br/>
If you choose JSON, use <tt>application/fhir+json</tt>.
<h4>Create a patient resource</h4>
See <a href="../fhir/examples/patient0.json" target="code">patient0.json</a> (general person)
taken from <a href="https://www.hl7.org/fhir/patient-example.json.html" target="code">FHIR R4 - Patient-example.json</a>
<br/><br/>
See also
<a href="https://hapifhir.io/hapi-fhir/docs/client/examples.html" target="web">HAPI FHIR Client Examples</a>
and 
<a href="http://hapi.fhir.org/" target="web">HAPI FHIR Public Server</a>
<br/><br/>
In whatever HTTP client youâ€™re using, you should have received a 201 (Created) status code and also a Location header. <br/>
The <k>Location header</k> contains a URL telling the client where to issue a 'vread' interaction to retrieve the same resource you just created.
 </li>
 
 <li>copy that URL and issue a new GET request to it</li>
 
 <li>You can also create and read Binary resources</li>
</ul>


  <br/><br/>
<table style="width:98%">
<tbody>	
<tr>
<td style="width:50%" >
</td>
<td>
</td>
</tr>

<tr><td>
</td>
<td></td>
</tr>

 </tbody>
</table>
 <br/><br/>
 </div>    

 

<div style="background-color:rgba(86, 56, 253, 0.9); width:100%;text-align:center;font-size:small;color:white">
By AN Unibo-DISI  
</div> 

</body>
</html>


 
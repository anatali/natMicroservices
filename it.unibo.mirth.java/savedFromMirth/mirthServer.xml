<serverConfiguration version="3.9.0">
  <date>2020-07-22 09:05:03</date>
  <channelGroups/>
  <channels>
    <channel version="3.9.0">
      <id>e678dbf5-f021-43dc-84ae-967500d5c31a</id>
      <nextMetaDataId>2</nextMetaDataId>
      <name>Convert HL7 to FHIR Patient - Example 1</name>
      <description></description>
      <revision>3</revision>
      <sourceConnector version="3.9.0">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.tcp.TcpReceiverProperties" version="3.9.0">
          <pluginProperties/>
          <listenerConnectorProperties version="3.9.0">
            <host>0.0.0.0</host>
            <port>7001</port>
          </listenerConnectorProperties>
          <sourceConnectorProperties version="3.9.0">
            <responseVariable>None</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>true</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
          <transmissionModeProperties class="com.mirth.connect.model.transmission.framemode.FrameModeProperties">
            <pluginPointName>Basic</pluginPointName>
            <startOfMessageBytes></startOfMessageBytes>
            <endOfMessageBytes></endOfMessageBytes>
          </transmissionModeProperties>
          <serverMode>true</serverMode>
          <remoteAddress></remoteAddress>
          <remotePort></remotePort>
          <overrideLocalBinding>false</overrideLocalBinding>
          <reconnectInterval>5000</reconnectInterval>
          <receiveTimeout>0</receiveTimeout>
          <bufferSize>65536</bufferSize>
          <maxConnections>10</maxConnections>
          <keepConnectionOpen>true</keepConnectionOpen>
          <dataTypeBinary>false</dataTypeBinary>
          <charsetEncoding>DEFAULT_ENCODING</charsetEncoding>
          <respondOnNewConnection>0</respondOnNewConnection>
          <responseAddress></responseAddress>
          <responsePort></responsePort>
        </properties>
        <transformer version="3.9.0">
          <elements>
            <com.mirth.connect.model.IteratorStep version="3.9.0">
              <name>For each msg[&apos;PID&apos;][&apos;PID.3&apos;]</name>
              <sequenceNumber>0</sequenceNumber>
              <enabled>true</enabled>
              <properties>
                <target>msg[&apos;PID&apos;][&apos;PID.3&apos;]</target>
                <indexVariable>i</indexVariable>
                <prefixSubstitutions>
                  <string>msg[&apos;PID&apos;][&apos;PID.3&apos;]</string>
                  <string>tmp[&apos;PID&apos;][&apos;PID.3&apos;]</string>
                </prefixSubstitutions>
                <children>
                  <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep version="3.9.0">
                    <name>Create Identifier</name>
                    <sequenceNumber>0-0</sequenceNumber>
                    <enabled>true</enabled>
                    <storeAsLocal>true</storeAsLocal>
                    <mapType>CHANNEL</mapType>
                    <variable>identifiers</variable>
                    <definition>Identifier</definition>
                    <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                      <usingBuilder>true</usingBuilder>
                      <properties class="linked-hash-map">
                        <entry>
                          <string>use</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>false</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>usual</stringValue>
                              <usingEnum>true</usingEnum>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>type</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                              <usingBuilder>true</usingBuilder>
                              <properties class="linked-hash-map">
                                <entry>
                                  <string>text</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>msg[&apos;PID&apos;][&apos;PID.3&apos;][i][&apos;PID.3.5&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                              </properties>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>system</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.3&apos;][i][&apos;PID.3.4&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>value</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.3&apos;][i][&apos;PID.3.1&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>period</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                              <usingBuilder>true</usingBuilder>
                              <properties class="linked-hash-map">
                                <entry>
                                  <string>start</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.3&apos;][i][&apos;PID.3.7&apos;].toString())</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>end</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.3&apos;][i][&apos;PID.3.8&apos;].toString())</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                              </properties>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                      </properties>
                    </model>
                    <fhirVersion>R4</fhirVersion>
                  </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                </children>
              </properties>
            </com.mirth.connect.model.IteratorStep>
            <com.mirth.connect.model.IteratorStep version="3.9.0">
              <name>For each msg[&apos;PID&apos;][&apos;PID.5&apos;]</name>
              <sequenceNumber>1</sequenceNumber>
              <enabled>true</enabled>
              <properties>
                <target>msg[&apos;PID&apos;][&apos;PID.5&apos;]</target>
                <indexVariable>i</indexVariable>
                <prefixSubstitutions>
                  <string>msg[&apos;PID&apos;][&apos;PID.5&apos;]</string>
                  <string>tmp[&apos;PID&apos;][&apos;PID.5&apos;]</string>
                </prefixSubstitutions>
                <children>
                  <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep version="3.9.0">
                    <name>Create HumanName</name>
                    <sequenceNumber>1-0</sequenceNumber>
                    <enabled>true</enabled>
                    <storeAsLocal>true</storeAsLocal>
                    <mapType>CHANNEL</mapType>
                    <variable>names</variable>
                    <definition>HumanName</definition>
                    <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                      <usingBuilder>true</usingBuilder>
                      <properties class="linked-hash-map">
                        <entry>
                          <string>use</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>usual</stringValue>
                              <usingEnum>true</usingEnum>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>family</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.5&apos;][i][&apos;PID.5.1&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>given</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                              <usingBuilder>true</usingBuilder>
                              <elements>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>msg[&apos;PID&apos;][&apos;PID.5&apos;][i][&apos;PID.5.2&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>msg[&apos;PID&apos;][&apos;PID.5&apos;][i][&apos;PID.5.3&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                              </elements>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>prefix</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                              <usingBuilder>true</usingBuilder>
                              <elements>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>msg[&apos;PID&apos;][&apos;PID.5&apos;][i][&apos;PID.5.5&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                              </elements>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>suffix</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                              <usingBuilder>true</usingBuilder>
                              <elements>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>msg[&apos;PID&apos;][&apos;PID.5&apos;][i][&apos;PID.5.4&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                              </elements>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>period</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                              <usingBuilder>true</usingBuilder>
                              <properties class="linked-hash-map">
                                <entry>
                                  <string>start</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.5&apos;][i][&apos;PID.5.12&apos;].toString())</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>end</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.5&apos;][i][&apos;PID.5.13&apos;].toString())</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                              </properties>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                      </properties>
                    </model>
                    <fhirVersion>R4</fhirVersion>
                  </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                </children>
              </properties>
            </com.mirth.connect.model.IteratorStep>
            <com.mirth.connect.model.IteratorStep version="3.9.0">
              <name>For each msg[&apos;PID&apos;][&apos;PID.9&apos;]</name>
              <sequenceNumber>2</sequenceNumber>
              <enabled>true</enabled>
              <properties>
                <target>msg[&apos;PID&apos;][&apos;PID.9&apos;]</target>
                <indexVariable>i</indexVariable>
                <prefixSubstitutions>
                  <string>msg[&apos;PID&apos;][&apos;PID.9&apos;]</string>
                  <string>tmp[&apos;PID&apos;][&apos;PID.9&apos;]</string>
                </prefixSubstitutions>
                <children>
                  <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep version="3.9.0">
                    <name>Create HumanName</name>
                    <sequenceNumber>2-0</sequenceNumber>
                    <enabled>true</enabled>
                    <storeAsLocal>true</storeAsLocal>
                    <mapType>CHANNEL</mapType>
                    <variable>aliases</variable>
                    <definition>HumanName</definition>
                    <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                      <usingBuilder>true</usingBuilder>
                      <properties class="linked-hash-map">
                        <entry>
                          <string>use</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>usual</stringValue>
                              <usingEnum>true</usingEnum>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>family</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.9&apos;][i][&apos;PID.9.1&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>given</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                              <usingBuilder>true</usingBuilder>
                              <elements>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>msg[&apos;PID&apos;][&apos;PID.9&apos;][i][&apos;PID.9.2&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>msg[&apos;PID&apos;][&apos;PID.9&apos;][i][&apos;PID.9.3&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                              </elements>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>prefix</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                              <usingBuilder>true</usingBuilder>
                              <elements>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>msg[&apos;PID&apos;][&apos;PID.9&apos;][i][&apos;PID.9.5&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                              </elements>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>suffix</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                              <usingBuilder>true</usingBuilder>
                              <elements>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>msg[&apos;PID&apos;][&apos;PID.9&apos;][i][&apos;PID.9.4&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                              </elements>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>period</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                              <usingBuilder>true</usingBuilder>
                              <properties class="linked-hash-map">
                                <entry>
                                  <string>start</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.9&apos;][i][&apos;PID.9.12&apos;].toString())</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>end</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.9&apos;][i][&apos;PID.9.13&apos;].toString())</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                              </properties>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                      </properties>
                    </model>
                    <fhirVersion>R4</fhirVersion>
                  </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                </children>
              </properties>
            </com.mirth.connect.model.IteratorStep>
            <com.mirth.connect.model.IteratorStep version="3.9.0">
              <name>For each msg[&apos;PID&apos;][&apos;PID.13&apos;]</name>
              <sequenceNumber>3</sequenceNumber>
              <enabled>true</enabled>
              <properties>
                <target>msg[&apos;PID&apos;][&apos;PID.13&apos;]</target>
                <indexVariable>i</indexVariable>
                <prefixSubstitutions>
                  <string>msg[&apos;PID&apos;][&apos;PID.13&apos;]</string>
                  <string>tmp[&apos;PID&apos;][&apos;PID.13&apos;]</string>
                </prefixSubstitutions>
                <children>
                  <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep version="3.9.0">
                    <name>Create ContactPoint</name>
                    <sequenceNumber>3-0</sequenceNumber>
                    <enabled>true</enabled>
                    <storeAsLocal>true</storeAsLocal>
                    <mapType>CHANNEL</mapType>
                    <variable>homePhoneNumbers</variable>
                    <definition>ContactPoint</definition>
                    <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                      <usingBuilder>true</usingBuilder>
                      <properties class="linked-hash-map">
                        <entry>
                          <string>system</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>phone</stringValue>
                              <usingEnum>true</usingEnum>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>value</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.13&apos;][i][&apos;PID.13.1&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>use</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>home</stringValue>
                              <usingEnum>true</usingEnum>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                      </properties>
                    </model>
                    <fhirVersion>R4</fhirVersion>
                  </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                </children>
              </properties>
            </com.mirth.connect.model.IteratorStep>
            <com.mirth.connect.model.IteratorStep version="3.9.0">
              <name>For each msg[&apos;PID&apos;][&apos;PID.14&apos;]</name>
              <sequenceNumber>4</sequenceNumber>
              <enabled>true</enabled>
              <properties>
                <target>msg[&apos;PID&apos;][&apos;PID.14&apos;]</target>
                <indexVariable>i</indexVariable>
                <prefixSubstitutions>
                  <string>msg[&apos;PID&apos;][&apos;PID.14&apos;]</string>
                  <string>tmp[&apos;PID&apos;][&apos;PID.14&apos;]</string>
                </prefixSubstitutions>
                <children>
                  <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep version="3.9.0">
                    <name>Create ContactPoint</name>
                    <sequenceNumber>4-0</sequenceNumber>
                    <enabled>true</enabled>
                    <storeAsLocal>true</storeAsLocal>
                    <mapType>CHANNEL</mapType>
                    <variable>businessPhoneNumbers</variable>
                    <definition>ContactPoint</definition>
                    <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                      <usingBuilder>true</usingBuilder>
                      <properties class="linked-hash-map">
                        <entry>
                          <string>system</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>phone</stringValue>
                              <usingEnum>true</usingEnum>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>value</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.14&apos;][i][&apos;PID.14.1&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>use</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>work</stringValue>
                              <usingEnum>true</usingEnum>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                      </properties>
                    </model>
                    <fhirVersion>R4</fhirVersion>
                  </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                </children>
              </properties>
            </com.mirth.connect.model.IteratorStep>
            <com.mirth.connect.model.IteratorStep version="3.9.0">
              <name>For each msg[&apos;PID&apos;][&apos;PID.11&apos;]</name>
              <sequenceNumber>5</sequenceNumber>
              <enabled>true</enabled>
              <properties>
                <target>msg[&apos;PID&apos;][&apos;PID.11&apos;]</target>
                <indexVariable>i</indexVariable>
                <prefixSubstitutions>
                  <string>msg[&apos;PID&apos;][&apos;PID.11&apos;]</string>
                  <string>tmp[&apos;PID&apos;][&apos;PID.11&apos;]</string>
                </prefixSubstitutions>
                <children>
                  <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep version="3.9.0">
                    <name>Create Address</name>
                    <sequenceNumber>5-0</sequenceNumber>
                    <enabled>true</enabled>
                    <storeAsLocal>true</storeAsLocal>
                    <mapType>CHANNEL</mapType>
                    <variable>addresses</variable>
                    <definition>Address</definition>
                    <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                      <usingBuilder>true</usingBuilder>
                      <properties class="linked-hash-map">
                        <entry>
                          <string>use</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>convertAddressUse(msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.7&apos;].toString())</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>type</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>false</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>postal</stringValue>
                              <usingEnum>true</usingEnum>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>text</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>(msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.1&apos;].toString() + &apos; &apos; + msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.2&apos;].toString() + &apos; &apos; + msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.3&apos;].toString() + &apos; &apos; + msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.4&apos;].toString() + &apos; &apos; + msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.5&apos;].toString() + &apos; &apos; + msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.6&apos;].toString()).trim()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>line</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                              <usingBuilder>true</usingBuilder>
                              <elements>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.1&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.2&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                              </elements>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>city</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.3&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>district</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.9&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>state</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.4&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>postalCode</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.5&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>country</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.6&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>period</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                              <usingBuilder>true</usingBuilder>
                              <properties class="linked-hash-map">
                                <entry>
                                  <string>start</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.13&apos;].toString())</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>end</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.11&apos;][i][&apos;PID.11.14&apos;].toString())</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                              </properties>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                      </properties>
                    </model>
                    <fhirVersion>R4</fhirVersion>
                  </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                </children>
              </properties>
            </com.mirth.connect.model.IteratorStep>
            <com.mirth.connect.model.IteratorStep version="3.9.0">
              <name>For each msg[&apos;NK1&apos;]</name>
              <sequenceNumber>6</sequenceNumber>
              <enabled>true</enabled>
              <properties>
                <target>msg[&apos;NK1&apos;]</target>
                <indexVariable>i</indexVariable>
                <prefixSubstitutions>
                  <string>msg[&apos;NK1&apos;]</string>
                  <string>tmp[&apos;NK1&apos;]</string>
                </prefixSubstitutions>
                <children>
                  <com.mirth.connect.model.IteratorStep version="3.9.0">
                    <name>For each msg[&apos;NK1&apos;][i][&apos;NK1.5&apos;]</name>
                    <sequenceNumber>6-0</sequenceNumber>
                    <enabled>true</enabled>
                    <properties>
                      <target>msg[&apos;NK1&apos;][i][&apos;NK1.5&apos;]</target>
                      <indexVariable>j</indexVariable>
                      <prefixSubstitutions>
                        <string>msg[&apos;NK1&apos;][i][&apos;NK1.5&apos;]</string>
                        <string>tmp[&apos;NK1&apos;][i][&apos;NK1.5&apos;]</string>
                      </prefixSubstitutions>
                      <children>
                        <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep version="3.9.0">
                          <name>Create ContactPoint</name>
                          <sequenceNumber>6-0-0</sequenceNumber>
                          <enabled>true</enabled>
                          <storeAsLocal>true</storeAsLocal>
                          <mapType>CHANNEL</mapType>
                          <variable>contactHomePhoneNumbers</variable>
                          <definition>ContactPoint</definition>
                          <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                            <usingBuilder>true</usingBuilder>
                            <properties class="linked-hash-map">
                              <entry>
                                <string>system</string>
                                <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                  <enabled>true</enabled>
                                  <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                    <stringValue>phone</stringValue>
                                    <usingEnum>true</usingEnum>
                                  </properties>
                                </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                              </entry>
                              <entry>
                                <string>value</string>
                                <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                  <enabled>true</enabled>
                                  <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                    <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.5&apos;][j][&apos;NK1.5.1&apos;].toString()</stringValue>
                                    <scriptExpression>true</scriptExpression>
                                  </properties>
                                </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                              </entry>
                              <entry>
                                <string>use</string>
                                <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                  <enabled>true</enabled>
                                  <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                    <stringValue>home</stringValue>
                                    <usingEnum>true</usingEnum>
                                  </properties>
                                </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                              </entry>
                            </properties>
                          </model>
                          <fhirVersion>R4</fhirVersion>
                        </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                      </children>
                    </properties>
                  </com.mirth.connect.model.IteratorStep>
                </children>
              </properties>
            </com.mirth.connect.model.IteratorStep>
            <com.mirth.connect.model.IteratorStep version="3.9.0">
              <name>For each msg[&apos;NK1&apos;]</name>
              <sequenceNumber>7</sequenceNumber>
              <enabled>true</enabled>
              <properties>
                <target>msg[&apos;NK1&apos;]</target>
                <indexVariable>i</indexVariable>
                <prefixSubstitutions>
                  <string>msg[&apos;NK1&apos;]</string>
                  <string>tmp[&apos;NK1&apos;]</string>
                </prefixSubstitutions>
                <children>
                  <com.mirth.connect.model.IteratorStep version="3.9.0">
                    <name>For each msg[&apos;NK1&apos;][i][&apos;NK1.6&apos;]</name>
                    <sequenceNumber>7-0</sequenceNumber>
                    <enabled>true</enabled>
                    <properties>
                      <target>msg[&apos;NK1&apos;][i][&apos;NK1.6&apos;]</target>
                      <indexVariable>j</indexVariable>
                      <prefixSubstitutions>
                        <string>msg[&apos;NK1&apos;][i][&apos;NK1.6&apos;]</string>
                        <string>tmp[&apos;NK1&apos;][i][&apos;NK1.6&apos;]</string>
                      </prefixSubstitutions>
                      <children>
                        <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep version="3.9.0">
                          <name>Create ContactPoint</name>
                          <sequenceNumber>7-0-0</sequenceNumber>
                          <enabled>true</enabled>
                          <storeAsLocal>true</storeAsLocal>
                          <mapType>CHANNEL</mapType>
                          <variable>contactBusinessPhoneNumbers</variable>
                          <definition>ContactPoint</definition>
                          <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                            <usingBuilder>true</usingBuilder>
                            <properties class="linked-hash-map">
                              <entry>
                                <string>system</string>
                                <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                  <enabled>true</enabled>
                                  <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                    <stringValue>phone</stringValue>
                                    <usingEnum>true</usingEnum>
                                  </properties>
                                </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                              </entry>
                              <entry>
                                <string>value</string>
                                <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                  <enabled>true</enabled>
                                  <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                    <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.6&apos;][j][&apos;NK1.6.1&apos;].toString()</stringValue>
                                    <scriptExpression>true</scriptExpression>
                                  </properties>
                                </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                              </entry>
                              <entry>
                                <string>use</string>
                                <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                  <enabled>true</enabled>
                                  <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                    <stringValue>work</stringValue>
                                    <usingEnum>true</usingEnum>
                                  </properties>
                                </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                              </entry>
                            </properties>
                          </model>
                          <fhirVersion>R4</fhirVersion>
                        </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                      </children>
                    </properties>
                  </com.mirth.connect.model.IteratorStep>
                </children>
              </properties>
            </com.mirth.connect.model.IteratorStep>
            <com.mirth.connect.model.IteratorStep version="3.9.0">
              <name>For each msg[&apos;NK1&apos;]</name>
              <sequenceNumber>8</sequenceNumber>
              <enabled>true</enabled>
              <properties>
                <target>msg[&apos;NK1&apos;]</target>
                <indexVariable>i</indexVariable>
                <prefixSubstitutions>
                  <string>msg[&apos;NK1&apos;]</string>
                  <string>tmp[&apos;NK1&apos;]</string>
                </prefixSubstitutions>
                <children>
                  <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep version="3.9.0">
                    <name>Create Patient_Contact</name>
                    <sequenceNumber>8-0</sequenceNumber>
                    <enabled>true</enabled>
                    <storeAsLocal>true</storeAsLocal>
                    <mapType>CHANNEL</mapType>
                    <variable>contacts</variable>
                    <definition>Patient_Contact</definition>
                    <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                      <usingBuilder>true</usingBuilder>
                      <properties class="linked-hash-map">
                        <entry>
                          <string>relationship</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                              <usingBuilder>true</usingBuilder>
                              <elements>
                                <com.mirth.connect.jsonbuilder.shared.models.ObjectModel>
                                  <usingBuilder>true</usingBuilder>
                                  <properties class="linked-hash-map">
                                    <entry>
                                      <string>id</string>
                                      <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                        <enabled>true</enabled>
                                        <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                          <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.3&apos;][&apos;NK1.3.1&apos;].toString()</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </properties>
                                      </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    </entry>
                                    <entry>
                                      <string>text</string>
                                      <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                        <enabled>true</enabled>
                                        <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                          <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.3&apos;][&apos;NK1.3.2&apos;].toString()</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </properties>
                                      </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    </entry>
                                  </properties>
                                </com.mirth.connect.jsonbuilder.shared.models.ObjectModel>
                                <com.mirth.connect.jsonbuilder.shared.models.ObjectModel>
                                  <usingBuilder>true</usingBuilder>
                                  <properties class="linked-hash-map">
                                    <entry>
                                      <string>id</string>
                                      <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                        <enabled>true</enabled>
                                        <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                          <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.7&apos;][&apos;NK1.7.1&apos;].toString()</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </properties>
                                      </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    </entry>
                                    <entry>
                                      <string>text</string>
                                      <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                        <enabled>true</enabled>
                                        <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                          <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.7&apos;][&apos;NK1.7.2&apos;].toString()</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </properties>
                                      </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    </entry>
                                  </properties>
                                </com.mirth.connect.jsonbuilder.shared.models.ObjectModel>
                              </elements>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>name</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                              <usingBuilder>true</usingBuilder>
                              <properties class="linked-hash-map">
                                <entry>
                                  <string>use</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>usual</stringValue>
                                      <usingEnum>true</usingEnum>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>family</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.2&apos;][&apos;NK1.2.1&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>given</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                                      <usingBuilder>true</usingBuilder>
                                      <elements>
                                        <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                          <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.2&apos;][&apos;NK1.2.2&apos;].toString()</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                        <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                          <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.2&apos;][&apos;NK1.2.3&apos;].toString()</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                      </elements>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>prefix</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                                      <usingBuilder>true</usingBuilder>
                                      <elements>
                                        <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                          <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.2&apos;][&apos;NK1.2.5&apos;].toString()</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                      </elements>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>suffix</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                                      <usingBuilder>true</usingBuilder>
                                      <elements>
                                        <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                          <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.2&apos;][&apos;NK1.2.4&apos;].toString()</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                      </elements>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>period</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                                      <usingBuilder>true</usingBuilder>
                                      <properties class="linked-hash-map">
                                        <entry>
                                          <string>start</string>
                                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                            <enabled>true</enabled>
                                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                              <stringValue>convertToFhirTimestamp(msg[&apos;NK1&apos;][i][&apos;NK1.2&apos;][&apos;NK1.2.12&apos;].toString())</stringValue>
                                              <scriptExpression>true</scriptExpression>
                                            </properties>
                                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                        </entry>
                                        <entry>
                                          <string>end</string>
                                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                            <enabled>true</enabled>
                                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                              <stringValue>convertToFhirTimestamp(msg[&apos;NK1&apos;][i][&apos;NK1.2&apos;][&apos;NK1.2.13&apos;].toString())</stringValue>
                                              <scriptExpression>true</scriptExpression>
                                            </properties>
                                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                        </entry>
                                      </properties>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                              </properties>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>telecom</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                              <stringValue>combineArrays(contactHomePhoneNumbers, contactBusinessPhoneNumbers)</stringValue>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>address</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                              <usingBuilder>true</usingBuilder>
                              <properties class="linked-hash-map">
                                <entry>
                                  <string>use</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>convertAddressUse(msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.7&apos;].toString())</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>type</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>false</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>postal</stringValue>
                                      <usingEnum>true</usingEnum>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>text</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>(msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.1&apos;].toString() + &apos; &apos; + msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.2&apos;].toString() + &apos; &apos; + msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.3&apos;].toString() + &apos; &apos; + msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.4&apos;].toString() + &apos; &apos; + msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.5&apos;].toString() + &apos; &apos; + msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.6&apos;].toString()).trim()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>line</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                                      <usingBuilder>true</usingBuilder>
                                      <elements>
                                        <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                          <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.1&apos;].toString()</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                        <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                          <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.2&apos;].toString()</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                      </elements>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>city</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.3&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>district</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.9&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>state</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.4&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>postalCode</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.5&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>country</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.6&apos;].toString()</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>period</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                                      <usingBuilder>true</usingBuilder>
                                      <properties class="linked-hash-map">
                                        <entry>
                                          <string>start</string>
                                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                            <enabled>true</enabled>
                                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                              <stringValue>convertToFhirTimestamp(msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.13&apos;].toString())</stringValue>
                                              <scriptExpression>true</scriptExpression>
                                            </properties>
                                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                        </entry>
                                        <entry>
                                          <string>end</string>
                                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                            <enabled>true</enabled>
                                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                              <stringValue>convertToFhirTimestamp(msg[&apos;NK1&apos;][i][&apos;NK1.4&apos;][&apos;NK1.4.14&apos;].toString())</stringValue>
                                              <scriptExpression>true</scriptExpression>
                                            </properties>
                                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                        </entry>
                                      </properties>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                              </properties>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>gender</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>convertToFhirGender(msg[&apos;NK1&apos;][i][&apos;NK1.15&apos;][&apos;NK1.15.1&apos;].toString())</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                      </properties>
                    </model>
                    <fhirVersion>R4</fhirVersion>
                  </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
                </children>
              </properties>
            </com.mirth.connect.model.IteratorStep>
            <com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep version="3.9.0">
              <name>Create Patient</name>
              <sequenceNumber>9</sequenceNumber>
              <enabled>true</enabled>
              <storeAsLocal>true</storeAsLocal>
              <mapType>CHANNEL</mapType>
              <variable>patient</variable>
              <definition>Patient</definition>
              <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                <usingBuilder>true</usingBuilder>
                <properties class="linked-hash-map">
                  <entry>
                    <string>resourceType</string>
                    <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                      <enabled>true</enabled>
                      <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                        <stringValue>Patient</stringValue>
                      </properties>
                    </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                  </entry>
                  <entry>
                    <string>identifier</string>
                    <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                      <enabled>true</enabled>
                      <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                        <stringValue>identifiers</stringValue>
                      </properties>
                    </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                  </entry>
                  <entry>
                    <string>name</string>
                    <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                      <enabled>true</enabled>
                      <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                        <stringValue>combineArrays(names, aliases)</stringValue>
                      </properties>
                    </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                  </entry>
                  <entry>
                    <string>telecom</string>
                    <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                      <enabled>true</enabled>
                      <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                        <stringValue>combineArrays(homePhoneNumbers, businessPhoneNumbers)</stringValue>
                      </properties>
                    </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                  </entry>
                  <entry>
                    <string>gender</string>
                    <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                      <enabled>true</enabled>
                      <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                        <stringValue>convertToFhirGender(msg[&apos;PID&apos;][&apos;PID.8&apos;][&apos;PID.8.1&apos;].toString())</stringValue>
                        <scriptExpression>true</scriptExpression>
                      </properties>
                    </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                  </entry>
                  <entry>
                    <string>birthDate</string>
                    <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                      <enabled>true</enabled>
                      <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                        <stringValue>convertToFhirDate(msg[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString())</stringValue>
                        <scriptExpression>true</scriptExpression>
                      </properties>
                    </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                  </entry>
                  <entry>
                    <string>deceasedBoolean</string>
                    <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                      <enabled>true</enabled>
                      <properties class="com.mirth.connect.jsonbuilder.shared.models.BooleanModel">
                        <stringValue>convertYesNoIndicator(msg[&apos;PID&apos;][&apos;PID.30&apos;][&apos;PID.30.1&apos;].toString())</stringValue>
                      </properties>
                    </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                  </entry>
                  <entry>
                    <string>deceasedDateTime</string>
                    <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                      <enabled>true</enabled>
                      <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                        <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.29&apos;][&apos;PID.29.1&apos;].toString())</stringValue>
                        <scriptExpression>true</scriptExpression>
                      </properties>
                    </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                  </entry>
                  <entry>
                    <string>address</string>
                    <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                      <enabled>true</enabled>
                      <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                        <stringValue>addresses</stringValue>
                      </properties>
                    </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                  </entry>
                  <entry>
                    <string>maritalStatus</string>
                    <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                      <enabled>true</enabled>
                      <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                        <usingBuilder>true</usingBuilder>
                        <properties class="linked-hash-map">
                          <entry>
                            <string>text</string>
                            <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                              <enabled>true</enabled>
                              <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                <stringValue>msg[&apos;PID&apos;][&apos;PID.16&apos;][&apos;PID.16.1&apos;].toString()</stringValue>
                                <scriptExpression>true</scriptExpression>
                              </properties>
                            </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                          </entry>
                        </properties>
                      </properties>
                    </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                  </entry>
                  <entry>
                    <string>multipleBirthBoolean</string>
                    <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                      <enabled>true</enabled>
                      <properties class="com.mirth.connect.jsonbuilder.shared.models.BooleanModel">
                        <stringValue>convertYesNoIndicator(msg[&apos;PID&apos;][&apos;PID.24&apos;][&apos;PID.24.1&apos;].toString())</stringValue>
                      </properties>
                    </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                  </entry>
                  <entry>
                    <string>contact</string>
                    <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                      <enabled>true</enabled>
                      <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                        <stringValue>contacts</stringValue>
                      </properties>
                    </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                  </entry>
                  <entry>
                    <string>communication</string>
                    <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                      <enabled>true</enabled>
                      <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                        <usingBuilder>true</usingBuilder>
                        <elements>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectModel>
                            <usingBuilder>true</usingBuilder>
                            <properties class="linked-hash-map">
                              <entry>
                                <string>language</string>
                                <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                  <enabled>true</enabled>
                                  <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                                    <usingBuilder>true</usingBuilder>
                                    <properties class="linked-hash-map">
                                      <entry>
                                        <string>id</string>
                                        <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                          <enabled>true</enabled>
                                          <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                            <stringValue>msg[&apos;PID&apos;][&apos;PID.15&apos;][&apos;PID.15.1&apos;].toString()</stringValue>
                                            <scriptExpression>true</scriptExpression>
                                          </properties>
                                        </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                      </entry>
                                      <entry>
                                        <string>text</string>
                                        <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                          <enabled>true</enabled>
                                          <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                            <stringValue>msg[&apos;PID&apos;][&apos;PID.15&apos;][&apos;PID.15.2&apos;].toString()</stringValue>
                                            <scriptExpression>true</scriptExpression>
                                          </properties>
                                        </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                      </entry>
                                    </properties>
                                  </properties>
                                </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                              </entry>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectModel>
                        </elements>
                      </properties>
                    </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                  </entry>
                </properties>
              </model>
              <fhirVersion>R4</fhirVersion>
            </com.mirth.connect.plugins.fhir.shared.FhirModelBuilderTransformerStep>
            <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.0">
              <name>Cleanup, and set msg</name>
              <sequenceNumber>10</sequenceNumber>
              <enabled>true</enabled>
              <script>msg = consolidate(cleanupFhirPatient(patient));</script>
            </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
          </elements>
          <inboundTemplate encoding="base64"></inboundTemplate>
          <outboundTemplate encoding="base64"></outboundTemplate>
          <inboundDataType>HL7V2</inboundDataType>
          <outboundDataType>FHIR</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.0">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.0">
              <handleRepetitions>true</handleRepetitions>
              <handleSubcomponents>true</handleSubcomponents>
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <stripNamespaces>true</stripNamespaces>
              <segmentDelimiter>\r</segmentDelimiter>
              <convertLineBreaks>true</convertLineBreaks>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.0">
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <segmentDelimiter>\r</segmentDelimiter>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.0">
              <splitType>MSH_Segment</splitType>
              <batchScript></batchScript>
            </batchProperties>
            <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.0">
              <segmentDelimiter>\r</segmentDelimiter>
              <successfulACKCode>AA</successfulACKCode>
              <successfulACKMessage></successfulACKMessage>
              <errorACKCode>AE</errorACKCode>
              <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
              <rejectedACKCode>AR</rejectedACKCode>
              <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
              <msh15ACKAccept>false</msh15ACKAccept>
              <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
            </responseGenerationProperties>
            <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.0">
              <successfulACKCode>AA,CA</successfulACKCode>
              <errorACKCode>AE,CE</errorACKCode>
              <rejectedACKCode>AR,CR</rejectedACKCode>
              <validateMessageControlId>true</validateMessageControlId>
              <originalMessageControlId>Destination_Encoded</originalMessageControlId>
              <originalIdMapVariable></originalIdMapVariable>
            </responseValidationProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
              <serializationType>JSON</serializationType>
              <fhirVersion>R4</fhirVersion>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
              <serializationType>JSON</serializationType>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.0">
          <elements/>
        </filter>
        <transportName>TCP Listener</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.0">
          <metaDataId>1</metaDataId>
          <name>Destination 1</name>
          <properties class="com.mirth.connect.connectors.vm.VmDispatcherProperties" version="3.9.0">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.0">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <channelId>none</channelId>
            <channelTemplate>${message.encodedData}</channelTemplate>
            <mapVariables/>
          </properties>
          <transformer version="3.9.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.0">
            <elements/>
          </filter>
          <transportName>Channel Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.0">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>DEVELOPMENT</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>true</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>SOURCE</name>
            <type>STRING</type>
            <mappingName>mirth_source</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>TYPE</name>
            <type>STRING</type>
            <mappingName>mirth_type</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.0">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>true</enabled>
          <lastModified>
            <time>1595349106717</time>
            <timezone>Europe/Rome</timezone>
          </lastModified>
          <pruningSettings>
            <archiveEnabled>true</archiveEnabled>
          </pruningSettings>
        </metadata>
      </exportData>
    </channel>
    <channel version="3.9.0">
      <id>42e730bb-0721-435e-8dcf-d25d6d5d1dc6</id>
      <nextMetaDataId>2</nextMetaDataId>
      <name>Convert HL7 to FHIR Patient - Example 2</name>
      <description></description>
      <revision>1</revision>
      <sourceConnector version="3.9.0">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.vm.VmReceiverProperties" version="3.9.0">
          <pluginProperties/>
          <sourceConnectorProperties version="3.9.0">
            <responseVariable>None</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
        </properties>
        <transformer version="3.9.0">
          <elements>
            <com.mirth.connect.plugins.messagebuilder.MessageBuilderStep version="3.9.0">
              <name>Convert HL7 v2.x message to FHIR Patient resource</name>
              <sequenceNumber>0</sequenceNumber>
              <enabled>true</enabled>
              <messageSegment>msg</messageSegment>
              <mapping>createAndConsolidateFhirPatient(msg)</mapping>
              <defaultValue></defaultValue>
              <replacements/>
            </com.mirth.connect.plugins.messagebuilder.MessageBuilderStep>
          </elements>
          <inboundTemplate encoding="base64"></inboundTemplate>
          <outboundTemplate encoding="base64"></outboundTemplate>
          <inboundDataType>HL7V2</inboundDataType>
          <outboundDataType>FHIR</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.0">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.0">
              <handleRepetitions>true</handleRepetitions>
              <handleSubcomponents>true</handleSubcomponents>
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <stripNamespaces>true</stripNamespaces>
              <segmentDelimiter>\r</segmentDelimiter>
              <convertLineBreaks>true</convertLineBreaks>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.0">
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <segmentDelimiter>\r</segmentDelimiter>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.0">
              <splitType>MSH_Segment</splitType>
              <batchScript></batchScript>
            </batchProperties>
            <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.0">
              <segmentDelimiter>\r</segmentDelimiter>
              <successfulACKCode>AA</successfulACKCode>
              <successfulACKMessage></successfulACKMessage>
              <errorACKCode>AE</errorACKCode>
              <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
              <rejectedACKCode>AR</rejectedACKCode>
              <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
              <msh15ACKAccept>false</msh15ACKAccept>
              <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
            </responseGenerationProperties>
            <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.0">
              <successfulACKCode>AA,CA</successfulACKCode>
              <errorACKCode>AE,CE</errorACKCode>
              <rejectedACKCode>AR,CR</rejectedACKCode>
              <validateMessageControlId>true</validateMessageControlId>
              <originalMessageControlId>Destination_Encoded</originalMessageControlId>
              <originalIdMapVariable></originalIdMapVariable>
            </responseValidationProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
              <serializationType>JSON</serializationType>
              <fhirVersion>R4</fhirVersion>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
              <serializationType>JSON</serializationType>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.0">
          <elements/>
        </filter>
        <transportName>Channel Reader</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.0">
          <metaDataId>1</metaDataId>
          <name>Destination 1</name>
          <properties class="com.mirth.connect.connectors.vm.VmDispatcherProperties" version="3.9.0">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.0">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <channelId>none</channelId>
            <channelTemplate>${message.encodedData}</channelTemplate>
            <mapVariables/>
          </properties>
          <transformer version="3.9.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.0">
            <elements/>
          </filter>
          <transportName>Channel Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.0">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>DEVELOPMENT</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>true</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>SOURCE</name>
            <type>STRING</type>
            <mappingName>mirth_source</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>TYPE</name>
            <type>STRING</type>
            <mappingName>mirth_type</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.0">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>true</enabled>
          <lastModified>
            <time>1595399134298</time>
            <timezone>Europe/Rome</timezone>
          </lastModified>
          <pruningSettings>
            <archiveEnabled>true</archiveEnabled>
          </pruningSettings>
        </metadata>
      </exportData>
    </channel>
    <channel version="3.9.0">
      <id>1892f241-d643-4abb-b0af-b20b87e0cf12</id>
      <nextMetaDataId>8</nextMetaDataId>
      <name>FHIR Listener</name>
      <description>  NOTE: This channel depends on the following variables being declared in the configuration map:
    fhirDBDatabaseType= mysql                            The type of database server .
    fhirDBDriver= org.postgresql.Driver                  The JDBC Driver class to use when connecting to the FHIR database.
    fhirDBUrl= jdbc:postgresql://localhost:5432/fhirdb   The JDBC connection URL to use when connecting to the FHIR database.
    fhirDBUsername= root                                 The username to use when connecting to the FHIR database.
    fhirDBPassword=root-password                         The password to use when connecting to the FHIR database.
    fhirDBMaxRetries=3                                   The maximum amount of retry attempts when a database connection fails.
</description>
      <revision>5</revision>
      <sourceConnector version="3.9.0">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.fhir.shared.FhirReceiverProperties" version="3.9.0">
          <pluginProperties>
            <com.mirth.connect.plugins.httpauth.NoneHttpAuthProperties version="3.9.0">
  <authType>NONE</authType>
            </com.mirth.connect.plugins.httpauth.NoneHttpAuthProperties>
          </pluginProperties>
          <listenerConnectorProperties version="3.9.0">
            <host>0.0.0.0</host>
            <port>7002</port>
          </listenerConnectorProperties>
          <sourceConnectorProperties version="3.9.0">
            <responseVariable>response</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
          <contextPath>r4</contextPath>
          <timeout>0</timeout>
          <conformanceTemplate>&lt;CapabilityStatement xmlns=&quot;http://hl7.org/fhir&quot;&gt;
    &lt;description value=&quot;This is the example FHIR Listener channel.&quot;/&gt;
    &lt;rest&gt;
        &lt;mode value=&quot;server&quot;/&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Account&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ActivityDefinition&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;AllergyIntolerance&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;AdverseEvent&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Appointment&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;AppointmentResponse&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;AuditEvent&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Basic&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Binary&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;BodySite&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Bundle&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;CapabilityStatement&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;CarePlan&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;CareTeam&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ChargeItem&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Claim&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ClaimResponse&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ClinicalImpression&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;CodeSystem&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Communication&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;CommunicationRequest&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;CompartmentDefinition&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Composition&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ConceptMap&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Condition&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Consent&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Contract&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Coverage&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;DataElement&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;DetectedIssue&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Device&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;DeviceComponent&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;DeviceMetric&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;DeviceRequest&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;DeviceUseStatement&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;DiagnosticReport&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;DocumentManifest&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;DocumentReference&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;EligibilityRequest&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;EligibilityResponse&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Encounter&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Endpoint&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;EnrollmentRequest&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;EnrollmentResponse&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;EpisodeOfCare&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ExpansionProfile&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ExplanationOfBenefit&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;FamilyMemberHistory&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Flag&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Goal&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;GraphDefinition&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Group&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;GuidanceResponse&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;HealthcareService&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ImagingManifest&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ImagingStudy&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Immunization&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ImmunizationRecommendation&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ImplementationGuide&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Library&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Linkage&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;List&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Location&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Measure&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;MeasureReport&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Media&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Medication&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;MedicationAdministration&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;MedicationDispense&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;MedicationRequest&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;MedicationStatement&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;MessageDefinition&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;MessageHeader&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;NamingSystem&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;NutritionOrder&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Observation&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;OperationDefinition&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;OperationOutcome&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Organization&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Parameters&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Patient&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
            &lt;searchParam&gt;
                &lt;name value=&quot;identifier&quot;/&gt;
                &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/patient-identifier&quot;/&gt;
                &lt;type value=&quot;token&quot;/&gt;
                &lt;documentation value=&quot;A patient identifier&quot;/&gt;
            &lt;/searchParam&gt;
            &lt;searchParam&gt;
                &lt;name value=&quot;name&quot;/&gt;
                &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/Patient-name&quot;/&gt;
                &lt;type value=&quot;string&quot;/&gt;
                &lt;documentation value=&quot;Case insensitive and partial-value searching&quot;/&gt;
                &lt;modifier value=&quot;contains&quot;/&gt;
            &lt;/searchParam&gt;
            &lt;searchParam&gt;
                &lt;name value=&quot;family&quot;/&gt;
                &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/Patient-family&quot;/&gt;
                &lt;type value=&quot;string&quot;/&gt;
                &lt;documentation value=&quot;Case insensitive and partial-value searching&quot;/&gt;
                &lt;modifier value=&quot;contains&quot;/&gt;
            &lt;/searchParam&gt;
            &lt;searchParam&gt;
                &lt;name value=&quot;given&quot;/&gt;
                &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/Patient-given&quot;/&gt;
                &lt;type value=&quot;string&quot;/&gt;
                &lt;documentation value=&quot;Case insensitive and partial-value searching&quot;/&gt;
                &lt;modifier value=&quot;contains&quot;/&gt;
            &lt;/searchParam&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;PaymentNotice&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;PaymentReconciliation&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Person&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;PlanDefinition&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Practitioner&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;PractitionerRole&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Procedure&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ProcedureRequest&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ProcessRequest&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ProcessResponse&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Provenance&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Questionnaire&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;QuestionnaireResponse&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ReferralRequest&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;RelatedPerson&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;RequestGroup&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ResearchStudy&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ResearchSubject&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;RiskAssessment&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Schedule&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
            &lt;searchParam&gt;
                &lt;name value=&quot;identifier&quot;/&gt;
                &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/schedule-identifier&quot;/&gt;
                &lt;type value=&quot;token&quot;/&gt;
                &lt;documentation value=&quot;A Schedule Identifier&quot;/&gt;
            &lt;/searchParam&gt;
            &lt;searchParam&gt;
                &lt;name value=&quot;actor&quot;/&gt;
                &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/schedule-actor&quot;/&gt;
                &lt;type value=&quot;reference&quot;/&gt;
                &lt;documentation value=&quot;The individual(HealthcareService, Practitioner, Location, ...) to find a Schedule for&quot;/&gt;
            &lt;/searchParam&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;SearchParameter&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Sequence&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ServiceDefinition&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Slot&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
            &lt;searchParam&gt;
                 &lt;name value=&quot;identifier&quot;/&gt;
                 &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/slot-identifier&quot;/&gt;
                 &lt;type value=&quot;token&quot;/&gt;
                 &lt;documentation value=&quot;A Slot Identifier&quot;/&gt;
            &lt;/searchParam&gt;
            &lt;searchParam&gt;
                 &lt;name value=&quot;schedule&quot;/&gt;
                 &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/slot-schedule&quot;/&gt;
                 &lt;type value=&quot;reference&quot;/&gt;
                 &lt;documentation value=&quot;The Schedule Resource that we are seeking a slot within&quot;/&gt;
            &lt;/searchParam&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Specimen&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;StructureDefinition&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;StructureMap&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Subscription&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Substance&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;SupplyDelivery&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;SupplyRequest&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;Task&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;TestScript&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;TestReport&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;ValueSet&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;type value=&quot;VisionPrescription&quot;/&gt;
            &lt;versioning value=&quot;versioned&quot;/&gt;
            &lt;readHistory value=&quot;true&quot;/&gt;
            &lt;updateCreate value=&quot;true&quot;/&gt;
        &lt;/resource&gt;
        &lt;interaction&gt;
            &lt;code value=&quot;search-system&quot;/&gt;
        &lt;/interaction&gt;
        &lt;searchParam&gt; 
            &lt;name value=&quot;_content&quot;/&gt; 
            &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/Resource-content&quot;/&gt; 
            &lt;type value=&quot;string&quot;/&gt; 
            &lt;documentation value=&quot;Search on the entire content of the resource&quot;/&gt; 
        &lt;/searchParam&gt; 
        &lt;searchParam&gt;
            &lt;name value=&quot;_id&quot;/&gt;
            &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/Resource-id&quot;/&gt;
            &lt;type value=&quot;token&quot;/&gt;
            &lt;documentation value=&quot;Logical id of this artifact&quot;/&gt;
        &lt;/searchParam&gt;
        &lt;searchParam&gt;
            &lt;name value=&quot;_lastUpdated&quot;/&gt;
            &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/Resource-lastUpdated&quot;/&gt;
            &lt;type value=&quot;date&quot;/&gt;
            &lt;documentation value=&quot;When the resource version last changed&quot;/&gt;
            &lt;target value=&quot;Patient&quot;/&gt;
        &lt;/searchParam&gt;
    &lt;/rest&gt;
&lt;/CapabilityStatement&gt;</conformanceTemplate>
          <conformanceURL></conformanceURL>
          <conformanceName>Mirth Connect FHIR Server</conformanceName>
          <supportsXML>true</supportsXML>
          <supportsJSON>true</supportsJSON>
          <systemInteractions>
            <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_SEARCH_SYSTEM</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
          </systemInteractions>
          <resourceProperties>
            <disabledInteractions>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>PERSON</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>SUPPLY_DELIVERY</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>OPERATION_DEFINITION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>HEALTHCARE_SERVICE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>CLAIM_RESPONSE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>DEVICE_COMPONENT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>COMPOSITION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>SUBSTANCE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>SPECIMEN</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>GROUP</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>IMMUNIZATION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>COMMUNICATION_REQUEST</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>MESSAGE_DEFINITION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>RESEARCH_SUBJECT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>PAYMENT_NOTICE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>MEASURE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>MEDICATION_STATEMENT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>LIST</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>ELIGIBILITY_REQUEST</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>EXPANSION_PROFILE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>CHARGE_ITEM</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>FAMILY_MEMBER_HISTORY</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>STRUCTURE_MAP</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>COMPARTMENT_DEFINITION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>PATIENT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>CONTRACT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>EPISODE_OF_CARE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>COVERAGE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>REQUEST_GROUP</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>EXPLANATION_OF_BENEFIT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>OBSERVATION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>DEVICE_USE_STATEMENT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>LINKAGE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>LIBRARY</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>CARE_TEAM</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>DIAGNOSTIC_REPORT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>PLAN_DEFINITION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>AUDIT_EVENT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_DELETE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_UPDATE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>MEDICATION_REQUEST</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>COMMUNICATION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>PROCEDURE_REQUEST</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>PRACTITIONER_ROLE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>NUTRITION_ORDER</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>CONCEPT_MAP</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>QUESTIONNAIRE_RESPONSE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>CONSENT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>SLOT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>ENDPOINT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>ORGANIZATION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>SERVICE_DEFINITION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>RESEARCH_STUDY</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>IMMUNIZATION_RECOMMENDATION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>SEARCH_PARAMETER</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>RELATED_PERSON</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>PROCESS_REQUEST</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>SUPPLY_REQUEST</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>ACTIVITY_DEFINITION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>CODE_SYSTEM</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>TEST_REPORT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>SEQUENCE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>ACCOUNT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>PRACTITIONER</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>PROCEDURE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>GRAPH_DEFINITION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>DEVICE_METRIC</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>ELIGIBILITY_RESPONSE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>TASK</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>OPERATION_OUTCOME</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>PROVENANCE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>DETECTED_ISSUE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>CLINICAL_IMPRESSION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>REFERRAL_REQUEST</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>SCHEDULE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>LOCATION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>CARE_PLAN</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>ENCOUNTER</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>ENROLLMENT_RESPONSE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>BUNDLE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_READ</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_SEARCH_TYPE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_HISTORY_INSTANCE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_HISTORY_TYPE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_DELETE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_VREAD</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_CREATE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_UPDATE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>MEASURE_REPORT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>BINARY</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_SEARCH_TYPE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>APPOINTMENT_RESPONSE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>DEVICE_REQUEST</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>NAMING_SYSTEM</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>PARAMETERS</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_READ</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_SEARCH_TYPE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_HISTORY_INSTANCE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_HISTORY_TYPE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_DELETE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_VREAD</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_CREATE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_UPDATE</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>MEDICATION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>IMPLEMENTATION_GUIDE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>MEDICATION_ADMINISTRATION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>FLAG</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>PROCESS_RESPONSE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>CAPABILITY_STATEMENT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>CLAIM</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>SUBSCRIPTION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>VALUE_SET</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>BASIC</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>MEDICATION_DISPENSE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>RISK_ASSESSMENT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>DATA_ELEMENT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>TEST_SCRIPT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>VISION_PRESCRIPTION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>QUESTIONNAIRE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>GUIDANCE_RESPONSE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>MESSAGE_HEADER</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>ALLERGY_INTOLERANCE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>CONDITION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>DOCUMENT_REFERENCE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>STRUCTURE_DEFINITION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>DOCUMENT_MANIFEST</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>APPOINTMENT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>MEDIA</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>DEVICE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>ENROLLMENT_REQUEST</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>BODY_SITE</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>ADVERSE_EVENT</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>IMAGING_STUDY</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>PAYMENT_RECONCILIATION</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>IMAGING_MANIFEST</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
              <entry>
                <com.mirth.connect.connectors.fhir.shared.FhirResource>GOAL</com.mirth.connect.connectors.fhir.shared.FhirResource>
                <set>
                  <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_PATCH</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
                </set>
              </entry>
            </disabledInteractions>
          </resourceProperties>
          <fhirVersion>R4</fhirVersion>
        </properties>
        <transformer version="3.9.0">
          <elements>
            <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.0">
              <name>Filter destinations by FHIR interaction</name>
              <sequenceNumber>0</sequenceNumber>
              <enabled>true</enabled>
              <script>var interaction = sourceMap.get(&apos;fhirInteraction&apos;);

if (interaction == &apos;operation&apos;) {
	// Operation destinations will have a name of &quot;$name&quot;.
	destinationSet.removeAllExcept([sourceMap.get(&apos;fhirOperationName&apos;)]);
} else if (interaction.startsWith(&apos;history&apos;)) {
	// This will match history-system, history-type, and history-instance
	destinationSet.removeAllExcept([&apos;history&apos;]);
} else if (interaction.startsWith(&apos;search&apos;)) {
	// This will match search-system and search-type
	destinationSet.removeAllExcept([&apos;search&apos;]);
} else {
	// All other destinations should have a name equal to the interaction
	destinationSet.removeAllExcept([interaction]);
}</script>
            </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
            <com.mirth.connect.plugins.mapper.MapperStep version="3.9.0">
              <name>fhirVersion</name>
              <sequenceNumber>1</sequenceNumber>
              <enabled>true</enabled>
              <variable>fhirVersion</variable>
              <mapping>&apos;R4&apos;</mapping>
              <defaultValue></defaultValue>
              <replacements/>
              <scope>CHANNEL</scope>
            </com.mirth.connect.plugins.mapper.MapperStep>
          </elements>
          <inboundTemplate encoding="base64"></inboundTemplate>
          <outboundTemplate encoding="base64"></outboundTemplate>
          <inboundDataType>FHIR</inboundDataType>
          <outboundDataType>FHIR</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
              <serializationType>XML</serializationType>
              <fhirVersion>R4</fhirVersion>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
              <serializationType>JSON</serializationType>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
              <serializationType>XML</serializationType>
              <fhirVersion>R4</fhirVersion>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
              <serializationType>XML</serializationType>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.0">
          <elements/>
        </filter>
        <transportName>FHIR Listener</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.0">
          <metaDataId>1</metaDataId>
          <name>create</name>
          <properties class="com.mirth.connect.connectors.js.JavaScriptDispatcherProperties" version="3.9.0">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.0">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <script>try {
    var fhirVersion = $(&apos;fhirVersion&apos;);
    var type = $(&apos;fhirType&apos;).toLowerCase();
    var id = UUIDGenerator.getUUID();
    var versionId = 1;
    var data = AttachmentUtil.reAttachMessage(connectorMessage);
    var contentType = FhirUtil.getMIMETypeXML();
    var preferReturn = getPreferValue();

    var resource = FhirUtil.fromXML(data, fhirVersion);
    var resourceType = resource.getResourceType();

    if (resourceType == null) {
        return createOperationOutcome(&apos;error&apos;, &apos;invalid&apos;, &apos;Resource type unknown, cannot be created as a(n) &apos; + $(&apos;fhirType&apos;) + &apos; resource.&apos;, fhirVersion);
    } else if (resourceType.toString().toLowerCase() != type) {
        return createOperationOutcome(&apos;error&apos;, &apos;invalid&apos;, &apos;Resource type &apos; + resourceType + &apos; cannot be created as a(n) &apos; + $(&apos;fhirType&apos;) + &apos; resource.&apos;, fhirVersion);
    }

    var lastUpdated = updateResourceMeta(resource, id, versionId);

    data = FhirUtil.toXML(resource, fhirVersion).replaceAll(&apos;\\s*xmlns:?[^=]*\\s*=\\s*&quot;http://hl7.org/fhir&quot;&apos;, &apos;&apos;);

    insertFhirResource(type, id, versionId, lastUpdated, data, contentType, $(&apos;method&apos;), $(&apos;url&apos;));

    var response;
    if (preferReturn == &apos;minimal&apos; || (!preferReturn &amp;&amp; type == &apos;binary&apos;)) {
        // If the Prefer header is set to minimal then don&apos;t send back the created resource
        response = FhirResponseFactory.getCreateResponse(id, versionId, lastUpdated, 201);
        if (preferReturn == &apos;minimal&apos;) {
            response.addHeader(&apos;Preference-Applied&apos;, &apos;return=minimal&apos;);
        }
    } else {
        response = FhirResponseFactory.getCreateResponse(data, id, versionId, lastUpdated, 201, contentType);
        if (preferReturn == &apos;representation&apos;) {
            response.addHeader(&apos;Preference-Applied&apos;, &apos;return=representation&apos;);
        }
    }
    
    responseMap.put(&apos;response&apos;, response);
    return response.getMessage();
} catch (e) {
    return createOperationOutcome(&apos;error&apos;, &apos;transient&apos;, &apos;Error creating resource.&apos;, fhirVersion, 500, e);
}</script>
          </properties>
          <transformer version="3.9.0">
            <elements/>
            <inboundTemplate encoding="base64"></inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.0">
            <elements/>
            <inboundTemplate encoding="base64"></inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.0">
            <elements/>
          </filter>
          <transportName>JavaScript Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
        <connector version="3.9.0">
          <metaDataId>2</metaDataId>
          <name>update</name>
          <properties class="com.mirth.connect.connectors.js.JavaScriptDispatcherProperties" version="3.9.0">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.0">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <script>try {
    var fhirVersion = $(&apos;fhirVersion&apos;);
    var type = $(&apos;fhirType&apos;).toLowerCase();
    var id = $(&apos;fhirId&apos;);
    var data = AttachmentUtil.reAttachMessage(connectorMessage);
    var contentType = FhirUtil.getMIMETypeXML();
    var responseCode = 201;
    var preferReturn = getPreferValue();

    var resource = FhirUtil.fromXML(data, fhirVersion);
    var resourceType = resource.getResourceType();

    if (resourceType == null) {
        return createOperationOutcome(&apos;error&apos;, &apos;invalid&apos;, &apos;Resource type unknown, cannot be updated as a(n) &apos; + $(&apos;fhirType&apos;) + &apos; resource.&apos;, fhirVersion);
    } else if (resourceType.toString().toLowerCase() != type) {
        return createOperationOutcome(&apos;error&apos;, &apos;invalid&apos;, &apos;Resource type &apos; + resourceIdElement.getResourceType() + &apos; cannot be updated as a(n) &apos; + $(&apos;fhirType&apos;) + &apos; resource.&apos;, fhirVersion);
    }

    var versionId = getFhirVersion(type, id) + 1;
    if (versionId &gt; 1) {
        responseCode = 200;
    }

    var lastUpdated = updateResourceMeta(resource, id, versionId);
    
    data = FhirUtil.toXML(resource, fhirVersion).replaceAll(&apos;\\s*xmlns:?[^=]*\\s*=\\s*&quot;http://hl7.org/fhir&quot;&apos;, &apos;&apos;);

    insertFhirResource(type, id, versionId, lastUpdated, data, contentType, $(&apos;method&apos;), $(&apos;url&apos;));

    var response;
    if (preferReturn == &apos;minimal&apos; || (!preferReturn &amp;&amp; type == &apos;binary&apos;)) {
        // If the Prefer header is set to minimal then don&apos;t send back the created resource
        response = FhirResponseFactory.getUpdateResponse(versionId, lastUpdated, responseCode);
        if (preferReturn == &apos;minimal&apos;) {
            response.addHeader(&apos;Preference-Applied&apos;, &apos;return=minimal&apos;);
        }
    } else {
        response = FhirResponseFactory.getUpdateResponse(data, versionId, lastUpdated, responseCode, contentType);
        if (preferReturn == &apos;representation&apos;) {
            response.addHeader(&apos;Preference-Applied&apos;, &apos;return=representation&apos;);
        }
    }
    responseMap.put(&apos;response&apos;, response);
    return response.getMessage();
} catch (e) {
    return createOperationOutcome(&apos;error&apos;, &apos;transient&apos;, &apos;Error updating resource.&apos;, fhirVersion, 500, e);
}</script>
          </properties>
          <transformer version="3.9.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.0">
            <elements/>
            <inboundTemplate encoding="base64"></inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.0">
            <elements/>
          </filter>
          <transportName>JavaScript Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
        <connector version="3.9.0">
          <metaDataId>3</metaDataId>
          <name>delete</name>
          <properties class="com.mirth.connect.connectors.js.JavaScriptDispatcherProperties" version="3.9.0">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.0">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <script>try {
    var fhirVersion = $(&apos;fhirVersion&apos;);
    var type = $(&apos;fhirType&apos;).toLowerCase();
    var id = $(&apos;fhirId&apos;);

    var result = getFhirVersionAndDeleted(type, id);
    var response;
    
    if (result.next() &amp;&amp; !result.getBoolean(&apos;deleted&apos;)) {
        var versionId = result.getInt(&apos;version&apos;) + 1;
        var lastUpdated = new java.util.Date();
        var sequenceId = insertFhirDeletedResource(type, id, versionId, lastUpdated, $(&apos;method&apos;), $(&apos;url&apos;));
        response = FhirResponseFactory.getDeleteResponse(versionId, lastUpdated, 204);
    } else {
        response = FhirResponseFactory.getDeleteResponse(null, null, 200);
    }

    responseMap.put(&apos;response&apos;, response);
} catch (e) {
    return createOperationOutcome(&apos;error&apos;, &apos;transient&apos;, &apos;Error deleting resource.&apos;, fhirVersion, 500, e);
}</script>
          </properties>
          <transformer version="3.9.0">
            <elements/>
            <inboundTemplate encoding="base64"></inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.0">
            <elements/>
            <inboundTemplate encoding="base64"></inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.0">
            <elements/>
          </filter>
          <transportName>JavaScript Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
        <connector version="3.9.0">
          <metaDataId>4</metaDataId>
          <name>read</name>
          <properties class="com.mirth.connect.connectors.js.JavaScriptDispatcherProperties" version="3.9.0">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.0">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <script>try {
    var fhirVersion = $(&apos;fhirVersion&apos;);
    var type = $(&apos;fhirType&apos;).toLowerCase();
    var id = $(&apos;fhirId&apos;);
logger.info(&quot;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; read JSWriter in FHIR Listsener type=&quot;+type);    
    var result = getResource(type, id);
    
    if (result.next()) {
        var version = new String(result.getInt(&apos;version&apos;));
        var data = getResultSetString(result, &apos;data&apos;);
        var contentType = getResultSetString(result, &apos;mimetype&apos;);
        var lastModified = getResultSetDate(result, &apos;last_modified&apos;);
        var deleted = result.getBoolean(&apos;deleted&apos;);

        if (deleted) {
            return createOperationOutcome(&apos;error&apos;, &apos;processing&apos;, $(&apos;fhirType&apos;) + &apos; ID &apos; + id + &apos; has been deleted.&apos;, fhirVersion, 410);
        } else {
            var response = FhirResponseFactory.getReadResponse(data, version, lastModified, 200, contentType);
            responseMap.put(&apos;response&apos;, response);
            return response.getMessage();
        }
    } else {
        return createOperationOutcome(&apos;error&apos;, &apos;processing&apos;, $(&apos;fhirType&apos;) + &apos; ID &apos; + id + &apos; not found.&apos;, fhirVersion, 404);
    }
} catch (e) {
    return createOperationOutcome(&apos;error&apos;, &apos;transient&apos;, &apos;Error reading resource.&apos;, fhirVersion, 500, e);
}</script>
          </properties>
          <transformer version="3.9.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.0">
            <elements/>
          </filter>
          <transportName>JavaScript Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
        <connector version="3.9.0">
          <metaDataId>5</metaDataId>
          <name>vread</name>
          <properties class="com.mirth.connect.connectors.js.JavaScriptDispatcherProperties" version="3.9.0">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.0">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <script>try {
    var fhirVersion = $(&apos;fhirVersion&apos;);
    var type = $(&apos;fhirType&apos;).toLowerCase();
    var id = $(&apos;fhirId&apos;);
    var versionId = $(&apos;fhirVid&apos;);
    
    var result = getResourceVersion(type, id, versionId);
    
    if (result.next()) {
        var data = getResultSetString(result, &apos;data&apos;);
        var contentType = getResultSetString(result, &apos;mimetype&apos;);
        var lastModified = getResultSetDate(result, &apos;last_modified&apos;);
        var deleted = result.getBoolean(&apos;deleted&apos;);

        if (deleted) {
            return createOperationOutcome(&apos;error&apos;, &apos;processing&apos;, $(&apos;fhirType&apos;) + &apos; ID &apos; + id + &apos; at version &apos; + versionId + &apos; has been deleted.&apos;, fhirVersion, 410);
        } else {
            var response = FhirResponseFactory.getVreadResponse(data, lastModified, 200, contentType);
            responseMap.put(&apos;response&apos;, response);
            return response.getMessage();
        }
    } else {
        return createOperationOutcome(&apos;error&apos;, &apos;processing&apos;, $(&apos;fhirType&apos;) + &apos; ID &apos; + id + &apos; at version &apos; + versionId + &apos; not found.&apos;, fhirVersion, 404);
    }
} catch (e) {
    return createOperationOutcome(&apos;error&apos;, &apos;transient&apos;, &apos;Error reading resource.&apos;, fhirVersion, 500, e);
}</script>
          </properties>
          <transformer version="3.9.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.0">
            <elements/>
          </filter>
          <transportName>JavaScript Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
        <connector version="3.9.0">
          <metaDataId>6</metaDataId>
          <name>history</name>
          <properties class="com.mirth.connect.connectors.js.JavaScriptDispatcherProperties" version="3.9.0">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.0">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <script>try {
    var fhirVersion = $(&apos;fhirVersion&apos;);
    var type = $(&apos;fhirType&apos;).toLowerCase();
    var id = $(&apos;fhirId&apos;);
    var requestURL = $(&apos;url&apos;);
    if (!requestURL.endsWith(&apos;/&apos;)) {
        requestURL += &apos;/&apos;;
    }
    var requestURL = new java.net.URI(requestURL);

    var _count = $(&apos;parameters&apos;).getParameter(&apos;_count&apos;);
    if (_count) {
        _count = parseInt(_count, 10);
        if (!_count) {
            return createOperationOutcome(&apos;error&apos;, &apos;invalid&apos;, &apos;Parameter _count formatted incorrectly: &apos; + $(&apos;parameters&apos;).getParameter(&apos;_count&apos;), fhirVersion);
        }
    }
    
    var _since = $(&apos;parameters&apos;).getParameter(&apos;_since&apos;);
    if (_since) {
        try {
            _since = convertDate(_since, &apos;yyyy-MM-dd HH:mm:ss.SSSZZ&apos;);
        } catch (e) {
            return createOperationOutcome(&apos;error&apos;, &apos;invalid&apos;, &apos;Parameter _since formatted incorrectly: &apos; + _since, fhirVersion);
        }
    }

    // Build up the WHERE clause and prepared query parameters
    var whereParts = [];
    var params = [];
    
    if (type &amp;&amp; id) {
        // history-instance
        whereParts.push(&quot;name = ?&quot;);
        whereParts.push(&quot;id = ?&quot;);
        params.push(type);
        params.push(id);
    } else if (type) {
        // history-type
        whereParts.push(&quot;name = ?&quot;);
        params.push(type);
    }

    if (_since) {
        whereParts.push(getFhirHistorySinceWherePart());
        params.push(_since);
    }

    // Build up the actual query
    var query = getFhirHistoryBaseQuery();
    if (whereParts.length &gt; 0) {
        query += &quot; WHERE &quot; + whereParts.join(&quot; AND &quot;);
    }
    query += &quot; ORDER BY name ASC, id ASC, version DESC&quot;;
    if (_count &gt; 0) {
        query += &quot; LIMIT &quot; + _count;
    }

    var result = executeCachedQuery(query, params);
    var bundle = new Packages.org.hl7.fhir.r4.model.Bundle().setType(Packages.org.hl7.fhir.r4.model.Bundle.BundleType.HISTORY);

    while (result.next()) {
        var entryType = getResultSetString(result, &apos;name&apos;);
        var entryId = getResultSetString(result, &apos;id&apos;);
        var entryVersion = result.getInt(&apos;version&apos;);
        var entryData = getResultSetString(result, &apos;data&apos;);
        var entryContentType = getResultSetString(result, &apos;mimetype&apos;);
        var entryDeleted = result.getBoolean(&apos;deleted&apos;);
        var entryRequestMethod = getResultSetString(result, &apos;request_method&apos;);
        var entryRequestURL = getResultSetString(result, &apos;request_url&apos;);
        
        var resourceType = FhirUtil.getResourceType(entryType, fhirVersion);
        if (resourceType != null) {
            entryType = resourceType.getPath();
        }

        var request = new Packages.org.hl7.fhir.r4.model.Bundle.BundleEntryRequestComponent().setMethod(new Packages.org.hl7.fhir.r4.model.Bundle.HTTPVerbEnumFactory().fromCode(entryRequestMethod)).setUrl(entryRequestURL);
        var entry = bundle.addEntry().setRequest(request);
        
        if (!entryDeleted) {
            var relativeUrl = &apos;../&apos;;
            if (id) {
                relativeUrl += &apos;../&apos;;
            }
            entry.setFullUrl(requestURL.resolve(relativeUrl + entryId + &apos;/_history/&apos; + entryVersion).toString());
            entry.setResource(FhirUtil.fromXML(entryData, fhirVersion));
        }
    }

    bundle.setTotal(bundle.getEntry().size());

    var response = FhirResponseFactory.getHistoryResponse(FhirUtil.toXML(bundle, fhirVersion), 200, FhirUtil.getMIMETypeXML());
    responseMap.put(&apos;response&apos;, response);
    return response.getMessage();
} catch (e) {
    return createOperationOutcome(&apos;error&apos;, &apos;transient&apos;, &apos;Error retrieving resource history.&apos;, fhirVersion, 500, e);
}</script>
          </properties>
          <transformer version="3.9.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.0">
            <elements/>
          </filter>
          <transportName>JavaScript Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
        <connector version="3.9.0">
          <metaDataId>7</metaDataId>
          <name>search</name>
          <properties class="com.mirth.connect.connectors.js.JavaScriptDispatcherProperties" version="3.9.0">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.0">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <script>try {
    var fhirVersion = $(&apos;fhirVersion&apos;);
    var type = $(&apos;fhirType&apos;).toLowerCase();
    var requestURL = $(&apos;url&apos;);
    if (!requestURL.endsWith(&apos;/&apos;)) {
        requestURL += &apos;/&apos;;
    }
    var requestURL = new java.net.URI(requestURL);

    // Add more supported parameters as you see fit
    var supportedParameters = [
        // General
        &apos;_format&apos;,
        // All resources
        &apos;_content&apos;,
        &apos;_id&apos;,
        &apos;_lastupdated&apos;,
        // Results
        &apos;_count&apos;,
    ]

    // Add more supported parameters as you see fit
    var supportedTypeParameters = {
        patient: [
            &apos;identifier&apos;,
            &apos;name&apos;,
            &apos;given&apos;,
            &apos;family&apos;
        ],
        schedule: [
            &apos;identifier&apos;,
            &apos;actor&apos;
        ],
        slot: [
            &apos;identifier&apos;,
            &apos;schedule&apos;
        ]
    }

    if (type) {
        var typeParameters = supportedTypeParameters[type.toLowerCase()];
        if (typeParameters) {
            for each (param in typeParameters) {
                supportedParameters.push(param);
            }
        }
    }

    // Uncomment this to reject requests with parameters that aren&apos;t supported
//  for each (key in $(&apos;parameters&apos;).getKeys().toArray()) {
//      if (supportedParameters.indexOf(key.toLowerCase()+&apos;&apos;) &lt; 0) {
//          return createOperationOutcome(&apos;error&apos;, &apos;invalid&apos;, &apos;Unknown or unsupported parameter &apos; + key + &apos;.&apos;, fhirVersion);
//      }
//  }

    var _content = $(&apos;parameters&apos;).getParameter(&apos;_content&apos;);

    var _id = $(&apos;parameters&apos;).getParameter(&apos;_id&apos;);

    var _lastUpdated = $(&apos;parameters&apos;).getParameter(&apos;_lastUpdated&apos;);
    var lastUpdatedOperator = &apos;eq&apos;;
    if (_lastUpdated) {
        try {
            if (/^(eq|ne|gt|lt|ge|le|sa|eb|ap).*/.test(_lastUpdated)) {
                lastUpdatedOperator = _lastUpdated.substr(0, 2);
                _lastUpdated = _lastUpdated.substr(2);
            }
            _lastUpdated = convertDate(_lastUpdated, &apos;yyyy-MM-dd HH:mm:ss.SSSZZ&apos;);
        } catch (e) {
            return createOperationOutcome(&apos;error&apos;, &apos;invalid&apos;, &apos;Parameter _lastUpdated formatted incorrectly: &apos; + _lastUpdated, fhirVersion);
        }
    }

    var _count = $(&apos;parameters&apos;).getParameter(&apos;_count&apos;);
    if (_count) {
        _count = parseInt(_count, 10);
        if (!_count) {
            return createOperationOutcome(&apos;error&apos;, &apos;invalid&apos;, &apos;Parameter _count formatted incorrectly: &apos; + $(&apos;parameters&apos;).getParameter(&apos;_count&apos;), fhirVersion);
        }
    }

    // Build up the WHERE clause and prepared query parameters
    var whereParts = [];
    var params = [];
    
    if (type) {
        // search-type
        whereParts.push(&quot;name = ?&quot;);
        params.push(type);
    }

    // Search on the entire content of the resource
    if (_content) {
        whereParts.push(getFhirSearchContentWherePart());
        params.push(&apos;%&apos; + _content + &apos;%&apos;);
    }

    // Logical id of the resource
    if (_id) {
        whereParts.push(&quot;id = ?&quot;);
        params.push(_id);
    }

    // When the resource version last changed
    if (_lastUpdated) {
        whereParts.push(getFhirSearchLastUpdatedWherePart(lastUpdatedOperator));
        params.push(_lastUpdated);
    }

    // Add resource-specific query expressions
    if (type == &apos;patient&apos;) {
        if ($(&apos;parameters&apos;).contains(&apos;identifier&apos;)) {
            addXPath(xpathSearch(&apos;/*/identifier&apos;, [&apos;value/@value&apos;], $(&apos;parameters&apos;).getParameter(&apos;identifier&apos;), true, true), whereParts, params);
        }
        if ($(&apos;parameters&apos;).contains(&apos;name&apos;)) {
            addXPath(xpathSearch(&apos;/*/name&apos;, [&apos;family/@value&apos;, &apos;given/@value&apos;], $(&apos;parameters&apos;).getParameter(&apos;name&apos;)), whereParts, params);
        }
        if ($(&apos;parameters&apos;).contains(&apos;family&apos;)) {
            addXPath(xpathSearch(&apos;/*/name&apos;, [&apos;family/@value&apos;], $(&apos;parameters&apos;).getParameter(&apos;family&apos;)), whereParts, params);
        }
        if ($(&apos;parameters&apos;).contains(&apos;given&apos;)) {
            addXPath(xpathSearch(&apos;/*/name&apos;, [&apos;given/@value&apos;], $(&apos;parameters&apos;).getParameter(&apos;given&apos;)), whereParts, params);
        }
    } else if (type == &apos;schedule&apos;) {
        if ($(&apos;parameters&apos;).contains(&apos;identifier&apos;)) {
            addXPath(xpathSearch(&apos;/*/identifier&apos;, [&apos;value/@value&apos;], $(&apos;parameters&apos;).getParameter(&apos;identifier&apos;), true, true), whereParts, params);
        }
        if ($(&apos;parameters&apos;).contains(&apos;actor&apos;)) {
            addXPath(xpathSearch(&apos;/*/actor&apos;, [&apos;reference/@value&apos;], $(&apos;parameters&apos;).getParameter(&apos;actor&apos;)), whereParts, params);
        }
    } else if (type == &apos;slot&apos;) {
        if ($(&apos;parameters&apos;).contains(&apos;identifier&apos;)) {
            addXPath(xpathSearch(&apos;/*/identifier&apos;, [&apos;value/@value&apos;], $(&apos;parameters&apos;).getParameter(&apos;identifier&apos;), true, true), whereParts, params);
        }
        if ($(&apos;parameters&apos;).contains(&apos;schedule&apos;)) {
            addXPath(xpathSearch(&apos;/*/schedule&apos;, [&apos;reference/@value&apos;], $(&apos;parameters&apos;).getParameter(&apos;schedule&apos;)), whereParts, params);
        }
    }

    // Build up the actual query
    var usingLimit = _count &gt; 0;
    var query = getFhirSearchBaseQuery(usingLimit);
    if (whereParts.length &gt; 0) {
        query += &quot; AND &quot; + whereParts.join(&quot; AND &quot;);
    }
    query = addOrder(query, usingLimit);
    if (usingLimit) {
        query = addLimit(query, _count);
    }

    var result = executeCachedQuery(query, params);
    var bundle = new Packages.org.hl7.fhir.r4.model.Bundle().setType(Packages.org.hl7.fhir.r4.model.Bundle.BundleType.SEARCHSET);

    while (result.next()) {
        var entryType = getResultSetString(result, &apos;name&apos;);
        var entryId = getResultSetString(result, &apos;id&apos;);
        var entryVersion = result.getInt(&apos;version&apos;);
        var entryData = getResultSetString(result, &apos;data&apos;);
        var entryContentType = getResultSetString(result, &apos;mimetype&apos;);
        var entryRequestMethod = getResultSetString(result, &apos;request_method&apos;);
        var entryRequestURL = getResultSetString(result, &apos;request_url&apos;);

        var resourceType = FhirUtil.getResourceType(entryType, fhirVersion);
        if (resourceType != null) {
            entryType = resourceType.getPath();
        }

        var request = new Packages.org.hl7.fhir.r4.model.Bundle.BundleEntryRequestComponent().setMethod(new Packages.org.hl7.fhir.r4.model.Bundle.HTTPVerbEnumFactory().fromCode(entryRequestMethod)).setUrl(entryRequestURL);
        var entry = bundle.addEntry().setRequest(request);
    
        var relativeUrl = type ? &apos;&apos; : (resourceType + &apos;/&apos;);
        if ($(&apos;url&apos;).contains(&apos;_search&apos;) &amp;&amp; $(&apos;method&apos;) == &apos;POST&apos;) {
            relativeUrl = &apos;../&apos; + relativeUrl;
        }
        entry.setFullUrl(requestURL.resolve(relativeUrl + entryId + &apos;/_history/&apos; + entryVersion).toString());
        entry.setResource(FhirUtil.fromXML(entryData, fhirVersion));
    }

    bundle.setTotal(bundle.getEntry().size());;

    var response = FhirResponseFactory.getHistoryResponse(FhirUtil.toXML(bundle, fhirVersion), 200, FhirUtil.getMIMETypeXML());
    responseMap.put(&apos;response&apos;, response);
    return response.getMessage();
} catch (e) {
    return createOperationOutcome(&apos;error&apos;, &apos;transient&apos;, &apos;Error searching resources.&apos;, fhirVersion, 500, e);
}

/**
    Creates an XPath search selector within the given base node.

    @param String base - The base path to select within.
    @param String[] nodes - An array of child nodes to select by (combined with OR operator).
    @param String value - The value to test.
    @param Boolean equals - If true, the test will be equality, otherwise it will be a contains.
    @param Boolean caseSensitive - If true, the contains test will match using case sensitivity.
    @return The built-up contains selector.
*/
function xpathSearch(base, nodes, value, equals, caseSensitive) {
    var search = base + &quot;[&quot;;
    value = new java.lang.String(value).replaceAll(&quot;&apos;&quot;, &quot;&apos;&apos;&quot;);
    if (!caseSensitive) {
        value = value.toLowerCase();
    }
    
    for (var i = 0; i &lt; nodes.length; i++) {
        var node = convertXPathNodeSingleton(nodes[i]);
        if (!caseSensitive) {
            node = xpathLowerCase(node);
        }
        
        if (equals) {
            search += node + &quot; = &apos;&quot; + value + &quot;&apos;&quot;;
        } else {
            search += &quot;contains(&quot; + node + &quot;, &apos;&quot; + value + &quot;&apos;)&quot;;
        }
        
        if (i &lt; nodes.length - 1) {
            search += &quot; or &quot;;
        }
    }
    
    search += &quot;]&quot;;
    return search;
}</script>
          </properties>
          <transformer version="3.9.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>XML</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.9.0">
                <serializationType>RAW</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.0">
            <elements/>
          </filter>
          <transportName>JavaScript Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map

// Return an OperationOutcome if no destinations or anything else already handled the response
if (!responseMap.containsKey(&apos;response&apos;)) {
	if (sourceMap.get(&apos;fhirInteraction&apos;) == &apos;operation&apos;) {
		createOperationOutcome(&apos;error&apos;, &apos;processing&apos;, &apos;Invalid or unsupported operation: &apos; + sourceMap.get(&apos;fhirOperationName&apos;));
	} else {
		createOperationOutcome(&apos;error&apos;, &apos;processing&apos;, &apos;Invalid request URI.&apos;);
	}
}
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data

// Close the database connection
var dbConn = $gc(&apos;dbConn&apos;);
if (dbConn != null) {
	try { dbConn.close() } catch(e) {}
	globalChannelMap.remove(&apos;dbConn&apos;);
}

return;</undeployScript>
      <properties version="3.9.0">
        <clearGlobalChannelMap>false</clearGlobalChannelMap>
        <messageStorageMode>DEVELOPMENT</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>true</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>FHIR_TYPE</name>
            <type>STRING</type>
            <mappingName>fhirType</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>FHIR_INTERACTION</name>
            <type>STRING</type>
            <mappingName>fhirInteraction</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>FHIR_ID</name>
            <type>STRING</type>
            <mappingName>fhirId</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>FHIR_VID</name>
            <type>STRING</type>
            <mappingName>fhirVid</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>FHIR_OPERATION</name>
            <type>STRING</type>
            <mappingName>fhirOperationName</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.0">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>true</enabled>
          <lastModified>
            <time>1595169400939</time>
            <timezone>Europe/Rome</timezone>
          </lastModified>
          <pruningSettings>
            <archiveEnabled>true</archiveEnabled>
          </pruningSettings>
        </metadata>
      </exportData>
    </channel>
    <channel version="3.9.0">
      <id>7ef65bb8-203b-4a82-a312-33fb73cff9ed</id>
      <nextMetaDataId>2</nextMetaDataId>
      <name>HL7 to MySQL database</name>
      <description></description>
      <revision>1</revision>
      <sourceConnector version="3.9.0">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.file.FileReceiverProperties" version="3.9.0">
          <pluginProperties/>
          <pollConnectorProperties version="3.9.0">
            <pollingType>INTERVAL</pollingType>
            <pollOnStart>false</pollOnStart>
            <pollingFrequency>30000</pollingFrequency>
            <pollingHour>0</pollingHour>
            <pollingMinute>0</pollingMinute>
            <cronJobs/>
            <pollConnectorPropertiesAdvanced>
              <weekly>true</weekly>
              <inactiveDays>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
              </inactiveDays>
              <dayOfMonth>1</dayOfMonth>
              <allDay>true</allDay>
              <startingHour>8</startingHour>
              <startingMinute>0</startingMinute>
              <endingHour>17</endingHour>
              <endingMinute>0</endingMinute>
            </pollConnectorPropertiesAdvanced>
          </pollConnectorProperties>
          <sourceConnectorProperties version="3.9.0">
            <responseVariable>None</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
          <scheme>FILE</scheme>
          <host>/opt/connect/appdata</host>
          <fileFilter>*.hl7</fileFilter>
          <regex>false</regex>
          <directoryRecursion>false</directoryRecursion>
          <ignoreDot>true</ignoreDot>
          <anonymous>true</anonymous>
          <username>anonymous</username>
          <password>anonymous</password>
          <timeout>10000</timeout>
          <secure>true</secure>
          <passive>true</passive>
          <validateConnection>true</validateConnection>
          <afterProcessingAction>MOVE</afterProcessingAction>
          <moveToDirectory>/home/Dropoff</moveToDirectory>
          <moveToFileName>${originalFilename}</moveToFileName>
          <errorReadingAction>MOVE</errorReadingAction>
          <errorResponseAction>AFTER_PROCESSING</errorResponseAction>
          <errorMoveToDirectory>/home/Error</errorMoveToDirectory>
          <errorMoveToFileName>${originalFilename}</errorMoveToFileName>
          <checkFileAge>true</checkFileAge>
          <fileAge>1000</fileAge>
          <fileSizeMinimum>0</fileSizeMinimum>
          <fileSizeMaximum></fileSizeMaximum>
          <ignoreFileSizeMaximum>true</ignoreFileSizeMaximum>
          <sortBy>date</sortBy>
          <binary>false</binary>
          <charsetEncoding>DEFAULT_ENCODING</charsetEncoding>
        </properties>
        <transformer version="3.9.0">
          <elements/>
          <inboundDataType>HL7V2</inboundDataType>
          <outboundDataType>HL7V2</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.0">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.0">
              <handleRepetitions>true</handleRepetitions>
              <handleSubcomponents>true</handleSubcomponents>
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <stripNamespaces>true</stripNamespaces>
              <segmentDelimiter>\r</segmentDelimiter>
              <convertLineBreaks>true</convertLineBreaks>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.0">
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <segmentDelimiter>\r</segmentDelimiter>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.0">
              <splitType>MSH_Segment</splitType>
              <batchScript></batchScript>
            </batchProperties>
            <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.0">
              <segmentDelimiter>\r</segmentDelimiter>
              <successfulACKCode>AA</successfulACKCode>
              <successfulACKMessage></successfulACKMessage>
              <errorACKCode>AE</errorACKCode>
              <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
              <rejectedACKCode>AR</rejectedACKCode>
              <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
              <msh15ACKAccept>false</msh15ACKAccept>
              <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
            </responseGenerationProperties>
            <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.0">
              <successfulACKCode>AA,CA</successfulACKCode>
              <errorACKCode>AE,CE</errorACKCode>
              <rejectedACKCode>AR,CR</rejectedACKCode>
              <validateMessageControlId>true</validateMessageControlId>
              <originalMessageControlId>Destination_Encoded</originalMessageControlId>
              <originalIdMapVariable></originalIdMapVariable>
            </responseValidationProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.0">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.0">
              <handleRepetitions>true</handleRepetitions>
              <handleSubcomponents>true</handleSubcomponents>
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <stripNamespaces>true</stripNamespaces>
              <segmentDelimiter>\r</segmentDelimiter>
              <convertLineBreaks>true</convertLineBreaks>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.0">
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <segmentDelimiter>\r</segmentDelimiter>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.0">
              <splitType>MSH_Segment</splitType>
              <batchScript></batchScript>
            </batchProperties>
            <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.0">
              <segmentDelimiter>\r</segmentDelimiter>
              <successfulACKCode>AA</successfulACKCode>
              <successfulACKMessage></successfulACKMessage>
              <errorACKCode>AE</errorACKCode>
              <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
              <rejectedACKCode>AR</rejectedACKCode>
              <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
              <msh15ACKAccept>false</msh15ACKAccept>
              <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
            </responseGenerationProperties>
            <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.0">
              <successfulACKCode>AA,CA</successfulACKCode>
              <errorACKCode>AE,CE</errorACKCode>
              <rejectedACKCode>AR,CR</rejectedACKCode>
              <validateMessageControlId>true</validateMessageControlId>
              <originalMessageControlId>Destination_Encoded</originalMessageControlId>
              <originalIdMapVariable></originalIdMapVariable>
            </responseValidationProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.0">
          <elements/>
        </filter>
        <transportName>File Reader</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.0">
          <metaDataId>1</metaDataId>
          <name>HL7 to MySQL Patient database</name>
          <properties class="com.mirth.connect.connectors.jdbc.DatabaseDispatcherProperties" version="3.9.0">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.0">
              <queueEnabled>true</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <driver>com.mysql.jdbc.Driver</driver>
            <url>jdbc:mysql://db:3306/mirthdb</url>
            <username>root</username>
            <password>root_password</password>
            <query>var dbConn;

try {
	dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://db:3306/mirthdb&apos;,&apos;root&apos;,&apos;root_password&apos;);
	var result = dbConn.executeUpdate(&quot;INSERT INTO PERSON (USERNAME, FIRSTNAME, LASTNAME, LOGGED_IN) VALUES (&apos;&quot;+$(&apos;Username&apos;)+&quot;&apos;, &apos;&quot;+$(&apos;FirstName&apos;)+&quot;&apos;, &apos;&quot;+$(&apos;LastName&apos;)+&quot;&apos;, 0)&quot;);
} finally {
	if (dbConn) { 
		dbConn.close();
	}
}

var dbConn;

try {
	dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://db:3306/mirthdb&apos;,&apos;root&apos;,&apos;root_password&apos;);
	
	var result = dbConn.executeUpdate(&quot;INSERT INTO PERSON (USERNAME, FIRSTNAME, LASTNAME, LOGGED_IN) VALUES (&apos;&quot;+$(&apos;Username&apos;)+&quot;&apos;, &apos;&quot;+$(&apos;FirstName&apos;)+&quot;&apos;, &apos;&quot;+$(&apos;LastName&apos;)+&quot;&apos;, 0)&quot;);


} finally {
	if (dbConn) { 
		dbConn.close();
	}
}

</query>
            <useScript>true</useScript>
          </properties>
          <transformer version="3.9.0">
            <elements>
              <com.mirth.connect.plugins.mapper.MapperStep version="3.9.0">
                <name>Username</name>
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <variable>Username</variable>
                <mapping>msg[&apos;MSH&apos;][&apos;MSH.20&apos;][&apos;MSH.20.1&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
                <scope>CHANNEL</scope>
              </com.mirth.connect.plugins.mapper.MapperStep>
              <com.mirth.connect.plugins.mapper.MapperStep version="3.9.0">
                <name>LastName</name>
                <sequenceNumber>1</sequenceNumber>
                <enabled>true</enabled>
                <variable>LastName</variable>
                <mapping>msg[&apos;MSH&apos;][&apos;MSH.22&apos;][&apos;MSH.22.1&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
                <scope>CHANNEL</scope>
              </com.mirth.connect.plugins.mapper.MapperStep>
              <com.mirth.connect.plugins.mapper.MapperStep version="3.9.0">
                <name>FirstName</name>
                <sequenceNumber>2</sequenceNumber>
                <enabled>true</enabled>
                <variable>FirstName</variable>
                <mapping>msg[&apos;MSH&apos;][&apos;MSH.22&apos;][&apos;MSH.22.2&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
                <scope>CHANNEL</scope>
              </com.mirth.connect.plugins.mapper.MapperStep>
              <com.mirth.connect.plugins.mapper.MapperStep version="3.9.0">
                <name>Account</name>
                <sequenceNumber>3</sequenceNumber>
                <enabled>true</enabled>
                <variable>Account</variable>
                <mapping>msg[&apos;MSH&apos;][&apos;MSH.20&apos;][&apos;MSH.20.3&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
                <scope>CHANNEL</scope>
              </com.mirth.connect.plugins.mapper.MapperStep>
            </elements>
            <inboundTemplate encoding="base64">TVNIfF5+XCZ8RVBJQ0FEVHxESHxMQUJBRFR8REh8MjAxMzAxMDExMjI2fHxBRFReQTAxfEhMN01T
RzAwMDAxfFB8Mi4zfCBFVk58QTAxfDIwMTMwMTAxMTIyM3x8IFBJRHx8fE1STjEyMzQ1XjVeTTEx
fHxDT1JNQVJeTUFSTFl8fDE5NzEwMTAxfEZ8fEN8MSBEQVRJQ0EgU1RSRUVUXl5NQURJU09OXldJ
XjUzMDA1LTEwMjB8R0x8KDQxNCkzNzktMTIxMnwoNDE0KTI3MS0zNDM0fHxTfHxNUk4xMjM0NTAw
MV4yXk0xMHwxMjM0NTY3ODl8OTg3NjU0Xk5DfA==</inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>HL7V2</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.0">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.0">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.0">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.0">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.0">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.0">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.0">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.0">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.0">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.0">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.0">
            <elements/>
            <inboundDataType>HL7V2</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.0">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.0">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.0">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.0">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.0">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.0">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.0">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.0">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.0">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.0">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.0">
            <elements/>
          </filter>
          <transportName>Database Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.0">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>DEVELOPMENT</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>false</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>SOURCE</name>
            <type>STRING</type>
            <mappingName>mirth_source</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>TYPE</name>
            <type>STRING</type>
            <mappingName>mirth_type</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.0">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>false</enabled>
          <lastModified>
            <time>1595150460314</time>
            <timezone>Europe/Rome</timezone>
          </lastModified>
          <pruningSettings>
            <archiveEnabled>true</archiveEnabled>
          </pruningSettings>
        </metadata>
      </exportData>
    </channel>
    <channel version="3.9.0">
      <id>d6b7c1b0-ac5e-4993-9570-45d8947ad76d</id>
      <nextMetaDataId>2</nextMetaDataId>
      <name>channelTcpBase</name>
      <description></description>
      <revision>3</revision>
      <sourceConnector version="3.9.0">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.tcp.TcpReceiverProperties" version="3.9.0">
          <pluginProperties/>
          <listenerConnectorProperties version="3.9.0">
            <host>0.0.0.0</host>
            <port>7001</port>
          </listenerConnectorProperties>
          <sourceConnectorProperties version="3.9.0">
            <responseVariable>None</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
          <transmissionModeProperties class="com.mirth.connect.model.transmission.framemode.FrameModeProperties">
            <pluginPointName>Basic</pluginPointName>
            <startOfMessageBytes></startOfMessageBytes>
            <endOfMessageBytes></endOfMessageBytes>
          </transmissionModeProperties>
          <serverMode>true</serverMode>
          <remoteAddress></remoteAddress>
          <remotePort></remotePort>
          <overrideLocalBinding>false</overrideLocalBinding>
          <reconnectInterval>10</reconnectInterval>
          <receiveTimeout>50</receiveTimeout>
          <bufferSize>1024</bufferSize>
          <maxConnections>10</maxConnections>
          <keepConnectionOpen>true</keepConnectionOpen>
          <dataTypeBinary>false</dataTypeBinary>
          <charsetEncoding>DEFAULT_ENCODING</charsetEncoding>
          <respondOnNewConnection>0</respondOnNewConnection>
          <responseAddress></responseAddress>
          <responsePort></responsePort>
        </properties>
        <transformer version="3.9.0">
          <elements/>
          <inboundDataType>RAW</inboundDataType>
          <outboundDataType>RAW</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.0">
            <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.0">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.0">
            <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.0">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.0">
          <elements/>
        </filter>
        <transportName>TCP Listener</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.0">
          <metaDataId>1</metaDataId>
          <name>Destination 1</name>
          <properties class="com.mirth.connect.connectors.js.JavaScriptDispatcherProperties" version="3.9.0">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.0">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>true</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <script>var input = connectorMessage.getRawData();
logger.info( input );
var R1  = Packages.it.unibo.mirth.java.MirthJava0.getText(input);  //RESPONSE
responseMap.put(&quot;R1&quot;, R1);</script>
          </properties>
          <transformer version="3.9.0">
            <elements/>
            <inboundDataType>RAW</inboundDataType>
            <outboundDataType>RAW</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.0">
              <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.0">
              <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.0">
            <elements/>
            <inboundDataType>RAW</inboundDataType>
            <outboundDataType>RAW</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.0">
              <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.0">
              <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.0">
            <elements/>
          </filter>
          <transportName>JavaScript Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.0">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>DEVELOPMENT</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>true</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>SOURCE</name>
            <type>STRING</type>
            <mappingName>mirth_source</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>TYPE</name>
            <type>STRING</type>
            <mappingName>mirth_type</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.0">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>true</enabled>
          <lastModified>
            <time>1595001472308</time>
            <timezone>Europe/Berlin</timezone>
          </lastModified>
          <pruningSettings>
            <archiveEnabled>true</archiveEnabled>
          </pruningSettings>
        </metadata>
      </exportData>
    </channel>
    <channel version="3.9.0">
      <id>69c079fd-1cc3-469f-8f00-b4c51638fdde</id>
      <nextMetaDataId>3</nextMetaDataId>
      <name>json_to_hl7_dest_channel_writer</name>
      <description></description>
      <revision>4</revision>
      <sourceConnector version="3.9.0">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.http.HttpReceiverProperties" version="3.9.0">
          <pluginProperties>
            <com.mirth.connect.plugins.httpauth.NoneHttpAuthProperties version="3.9.0">
  <authType>NONE</authType>
            </com.mirth.connect.plugins.httpauth.NoneHttpAuthProperties>
          </pluginProperties>
          <listenerConnectorProperties version="3.9.0">
            <host>0.0.0.0</host>
            <port>7003</port>
          </listenerConnectorProperties>
          <sourceConnectorProperties version="3.9.0">
            <responseVariable>None</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
          <xmlBody>false</xmlBody>
          <parseMultipart>true</parseMultipart>
          <includeMetadata>false</includeMetadata>
          <binaryMimeTypes>application/.*(?&lt;!json|xml)$|image/.*|video/.*|audio/.*</binaryMimeTypes>
          <binaryMimeTypesRegex>true</binaryMimeTypesRegex>
          <responseContentType>text/plain</responseContentType>
          <responseDataTypeBinary>false</responseDataTypeBinary>
          <responseStatusCode></responseStatusCode>
          <responseHeaders class="linked-hash-map"/>
          <responseHeadersVariable></responseHeadersVariable>
          <useResponseHeadersVariable>false</useResponseHeadersVariable>
          <charset>UTF-8</charset>
          <contextPath></contextPath>
          <timeout>0</timeout>
          <staticResources/>
        </properties>
        <transformer version="3.9.0">
          <elements>
            <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.0">
              <sequenceNumber>0</sequenceNumber>
              <enabled>true</enabled>
              <script>tmp[&apos;MSH&apos;][&apos;MSH.3&apos;][&apos;MSH.3.1&apos;] = msg[&apos;application_sending&apos;];
tmp[&apos;MSH&apos;][&apos;MSH.4&apos;][&apos;MSH.4.1&apos;] = msg[&apos;sending_facility&apos;];
tmp[&apos;MSH&apos;][&apos;MSH.5&apos;][&apos;MSH.5.1&apos;] = msg[&apos;receiving_application&apos;];
tmp[&apos;MSH&apos;][&apos;MSH.6&apos;][&apos;MSH.6.1&apos;] = msg[&apos;receiving_facility&apos;];
tmp[&apos;MSH&apos;][&apos;MSH.7&apos;][&apos;MSH.7.1&apos;] = msg[&apos;time&apos;];
tmp[&apos;MSH&apos;][&apos;MSH.10&apos;][&apos;MSH.10.1&apos;] = msg[&apos;message_control_id&apos;];
tmp[&apos;MSH&apos;][&apos;MSH.11&apos;][&apos;MSH.11.1&apos;] = msg[&apos;process_id&apos;];
tmp[&apos;MSH&apos;][&apos;MSH.12&apos;][&apos;MSH.12.1&apos;] = msg[&apos;version_id&apos;];
tmp[&apos;MSH&apos;][&apos;MSH.9&apos;] = msg[&apos;message_type&apos;];</script>
            </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
          </elements>
          <inboundTemplate encoding="base64">ewogICAgImFwcGxpY2F0aW9uX3NlbmRpbmciIDogIkVQSUNBRFQiLAogICAgInNlbmRpbmdfZmFj
aWxpdHkiIDogIkRIIiwKICAgICJyZWNlaXZpbmdfYXBwbGljYXRpb24iIDogIkxBQkFEVCIsCiAg
ICAicmVjZWl2aW5nX2ZhY2lsaXR5IiA6ICJESCIsCiAgICAidGltZSI6ICIyMDEzMDEwMTEyMjYi
LAogICAgIm1lc3NhZ2VfdHlwZSIgOiAiQURUXkEwMSIsCiAgICAibWVzc2FnZV9jb250cm9sX2lk
IiA6ICJITDdNU0cwMDAwMSIsCiAgICAicHJvY2Vzc19pZCIgOiAiUCIsCiAgICAidmVyc2lvbl9p
ZCI6ICIyLjMiCn0K</inboundTemplate>
          <outboundTemplate encoding="base64">TVNIfF5+XCZ8RVBJQ0FEVHxESHxMQUJBRFR8REh8MjAxMzAxMDExMjI2fHxBRFReQTAxfEhMN01T
RzAwMDAxfFB8Mi4zfCAKUElEfHx8fHx8fHx8fHx8fHx8fHx8fHwKUEQxfHx8fHw=</outboundTemplate>
          <inboundDataType>JSON</inboundDataType>
          <outboundDataType>HL7V2</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.0">
            <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.0">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.0">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.0">
              <handleRepetitions>true</handleRepetitions>
              <handleSubcomponents>true</handleSubcomponents>
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <stripNamespaces>true</stripNamespaces>
              <segmentDelimiter>\r</segmentDelimiter>
              <convertLineBreaks>true</convertLineBreaks>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.0">
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <segmentDelimiter>\r</segmentDelimiter>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.0">
              <splitType>MSH_Segment</splitType>
              <batchScript></batchScript>
            </batchProperties>
            <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.0">
              <segmentDelimiter>\r</segmentDelimiter>
              <successfulACKCode>AA</successfulACKCode>
              <successfulACKMessage></successfulACKMessage>
              <errorACKCode>AE</errorACKCode>
              <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
              <rejectedACKCode>AR</rejectedACKCode>
              <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
              <msh15ACKAccept>false</msh15ACKAccept>
              <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
            </responseGenerationProperties>
            <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.0">
              <successfulACKCode>AA,CA</successfulACKCode>
              <errorACKCode>AE,CE</errorACKCode>
              <rejectedACKCode>AR,CR</rejectedACKCode>
              <validateMessageControlId>true</validateMessageControlId>
              <originalMessageControlId>Destination_Encoded</originalMessageControlId>
              <originalIdMapVariable></originalIdMapVariable>
            </responseValidationProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.0">
          <elements/>
        </filter>
        <transportName>HTTP Listener</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.0">
          <metaDataId>2</metaDataId>
          <name>Destination 1</name>
          <properties class="com.mirth.connect.connectors.vm.VmDispatcherProperties" version="3.9.0">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.0">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <channelId>69c079fd-1cc3-469f-8f00-b4c51638fdde</channelId>
            <channelTemplate>${message.transformedData}</channelTemplate>
            <mapVariables/>
          </properties>
          <transformer version="3.9.0">
            <elements/>
            <inboundTemplate encoding="base64">TVNIfF5+XCZ8RVBJQ0FEVHxESHxMQUJBRFR8REh8MjAxMzAxMDExMjI2fHxBRFReQTAxfEhMN01T
RzAwMDAxfFB8Mi4zfCAKUElEfHx8fHx8fHx8fHx8fHx8fHx8fHwKUEQxfHx8fHw=</inboundTemplate>
            <outboundTemplate encoding="base64">TVNIfF5+XCZ8RVBJQ0FEVHxESHxMQUJBRFR8REh8MjAxMzAxMDExMjI2fHxBRFReQTAxfEhMN01T
RzAwMDAxfFB8Mi4zfCAKUElEfHx8fHx8fHx8fHx8fHx8fHx8fHwKUEQxfHx8fHw=</outboundTemplate>
            <inboundDataType>HL7V2</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.0">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.0">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.0">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.0">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.0">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.0">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.0">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.0">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.0">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.0">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.0">
            <elements/>
            <inboundDataType>HL7V2</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.0">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.0">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.0">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.0">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.0">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.0">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.0">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.0">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.0">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.0">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.0">
            <elements/>
          </filter>
          <transportName>Channel Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.0">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>DEVELOPMENT</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>false</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>SOURCE</name>
            <type>STRING</type>
            <mappingName>mirth_source</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>TYPE</name>
            <type>STRING</type>
            <mappingName>mirth_type</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.0">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>true</enabled>
          <lastModified>
            <time>1595100162303</time>
            <timezone>Europe/Rome</timezone>
          </lastModified>
          <pruningSettings>
            <archiveEnabled>true</archiveEnabled>
          </pruningSettings>
        </metadata>
      </exportData>
    </channel>
  </channels>
  <channelTags>
    <channelTag>
      <id>28eda82e-7385-4be1-b540-ed4505f81192</id>
      <name>HL7v2</name>
      <channelIds>
        <string>42e730bb-0721-435e-8dcf-d25d6d5d1dc6</string>
        <string>e678dbf5-f021-43dc-84ae-967500d5c31a</string>
      </channelIds>
      <backgroundColor>
        <red>0</red>
        <green>255</green>
        <blue>0</blue>
        <alpha>255</alpha>
      </backgroundColor>
    </channelTag>
    <channelTag>
      <id>801da78a-5e23-458c-8771-2012cc1238f6</id>
      <name>FHIR</name>
      <channelIds>
        <string>1892f241-d643-4abb-b0af-b20b87e0cf12</string>
        <string>42e730bb-0721-435e-8dcf-d25d6d5d1dc6</string>
        <string>e678dbf5-f021-43dc-84ae-967500d5c31a</string>
      </channelIds>
      <backgroundColor>
        <red>255</red>
        <green>0</green>
        <blue>0</blue>
        <alpha>255</alpha>
      </backgroundColor>
    </channelTag>
  </channelTags>
  <alerts/>
  <codeTemplateLibraries>
    <codeTemplateLibrary version="3.9.0">
      <id>1f350e29-158e-4645-8809-9e60d1a47854</id>
      <name>FHIR DB Operations</name>
      <revision>3</revision>
      <lastModified>
        <time>1595322138226</time>
        <timezone>Etc/UTC</timezone>
      </lastModified>
      <description>Functions used by the FHIR Listener channel to communicate with the database.
PostgreSQL and SQL Server are supported. If you want to support other database
servers, feel free to add your own database-specific operations and queries.</description>
      <includeNewChannels>false</includeNewChannels>
      <enabledChannelIds>
        <string>1892f241-d643-4abb-b0af-b20b87e0cf12</string>
      </enabledChannelIds>
      <disabledChannelIds>
        <string>7ef65bb8-203b-4a82-a312-33fb73cff9ed</string>
        <string>69c079fd-1cc3-469f-8f00-b4c51638fdde</string>
        <string>d6b7c1b0-ac5e-4993-9570-45d8947ad76d</string>
        <string>e678dbf5-f021-43dc-84ae-967500d5c31a</string>
      </disabledChannelIds>
      <codeTemplates>
        <codeTemplate version="3.9.0">
          <id>13e82aac-df07-463e-b8ca-8f4b98243618</id>
          <name>FHIR DB - Execute Cached Query</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149838223</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>CHANNEL_ATTACHMENT</contextType>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>CHANNEL_POSTPROCESSOR</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Executes a prepared query on the FHIR database and returns a CachedRowSet.

	@param {String} expression - The prepared statement to be executed.
	@param {Array} parameters - The parameters for the prepared statement.
	@param {DatabaseConnection} dbConn - Optionally provide a specific connection object.
	@return {CachedRowSet} The result of the query, as a CachedRowSet.
*/
function executeCachedQuery(expression, parameters, dbConn) {
	return executeOperation(&apos;executeCachedQuery&apos;, expression, parameters, dbConn);
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>9ec9d96c-4ea4-4f1c-8520-b73782f36aed</id>
          <name>FHIR DB - Execute Cached Query and Get Keys</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149838916</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>CHANNEL_ATTACHMENT</contextType>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>CHANNEL_POSTPROCESSOR</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Executes an INSERT/UPDATE statement on the database and returns a CachedRowSet containing any
	generated keys.

	@param {String} expression - The prepared statement to be executed.
	@param {Array} parameters - The parameters for the prepared statement.
	@param {DatabaseConnection} dbConn - Optionally provide a specific connection object.
	@return {CachedRowSet} A CachedRowSet containing any generated keys.
*/
function executeUpdateAndGetGeneratedKeys(expression, parameters, dbConn) {
	return executeOperation(&apos;executeUpdateAndGetGeneratedKeys&apos;, expression, parameters, dbConn);
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>8960e710-4870-49ea-b952-63d2b74b7bbc</id>
          <name>FHIR DB - Execute Update</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149837656</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>CHANNEL_ATTACHMENT</contextType>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>CHANNEL_POSTPROCESSOR</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Executes a prepared INSERT/UPDATE statement on the database and returns the row count.

	@param {String} expression - The prepared statement to be executed.
	@param {Array} parameters - The parameters for the prepared statement.
	@param {DatabaseConnection} dbConn - Optionally provide a specific connection object.
	@return {int} A count of the number of updated rows.
*/
function executeUpdate(expression, parameters, dbConn) {
	return executeOperation(&apos;executeUpdate&apos;, expression, parameters, dbConn);
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>23d0fa52-0d56-4e9a-82a5-56a6a3d55e43</id>
          <name>FHIR DB - Get Connection</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149837816</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>CHANNEL_ATTACHMENT</contextType>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>CHANNEL_POSTPROCESSOR</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Retrieves the FHIR database connection from the global channel map, creating a new one if necessary.

	@param {Boolean} recreate - If true, the connection will always be closed and created anew.
	@return {DatabaseConnection} The database connection object.
*/
function getFHIRDBConnection(recreate) {
	var dbConn = $gc(&apos;dbConn&apos;);

	if (!dbConn || recreate) {
		if (dbConn) {
			try {
				dbConn.close();
			} catch (e) {}
		}
		dbConn = createFHIRDBConnection();
		$gc(&apos;dbConn&apos;, dbConn);
	}

	return dbConn;
}

function createFHIRDBConnection() {
	return DatabaseConnectionFactory.createDatabaseConnection($(&apos;fhirDBDriver&apos;), $(&apos;fhirDBUrl&apos;), $(&apos;fhirDBUsername&apos;), $(&apos;fhirDBPassword&apos;));
}

function executeOperation(operation, expression, parameters, dbConn) {
	var createDbConn = typeof dbConn == &apos;undefined&apos;;
	if (createDbConn) {
		dbConn = getFHIRDBConnection();
	}
	var attempts = 0;
	var maxAttempts = NumberUtils.toInt($(&apos;fhirDBMaxRetries&apos;) + &apos;&apos;, 0) + 1;

	while (attempts &lt; maxAttempts) {
		attempts++;

		try {
			if (parameters) {
				for (var i in parameters) {
					var param = parameters[i];
					if (param instanceof Number) {
						parameters[i] = new java.lang.Integer(param);
					} else if (param instanceof java.util.Date) {
						parameters[i] = convertDateParameter(param);
					}
				}
				
				return dbConn[operation](expression, java.util.Arrays.asList(parameters));
			} else {
				return dbConn[operation](expression);
			}
		} catch (e) {
			logger.info(&apos;Error executing statement, checking if valid...&apos;);
			var throwException = false;

			try {
				dbConn.executeCachedQuery(&apos;SELECT 1&apos;);
			} catch (e2) {
				if (createDbConn) {
					logger.info(&apos;Connection invalid, recreating...&apos;);
	
					try {
						dbConn = getFHIRDBConnection(true);
					} catch (e3) {
						throwException = true;
					}
				} else {
					throwException = true;
				}
			}

			if (attempts &gt;= maxAttempts) {
				throwException = true;
			}

			if (throwException) {
				var errorMessage = &apos;Unable to execute statement.\n&apos;;
				errorMessage += &apos;Expression: &apos; + expression + &apos;\n&apos;;
				if (parameters) {
					errorMessage += &apos;Parameters: &apos; + java.util.Arrays.asList(parameters).toString();
				}
				logger.error(errorMessage, e.javaException);
				throw e;
			}

			java.lang.Thread.sleep(1000);
		}
	}
}

function convertDateParameter(date) {
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);

	if (dbType == &apos;postgres&apos;) {
		return new java.sql.Timestamp(date.getTime());
	} else if (dbType == &apos;sqlserver&apos;) {
		return convertDate(date, &apos;yyyy-MM-dd HH:mm:ss.SSSZZ&apos;);
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>269ac003-07f8-4914-9572-b2433afa116a</id>
          <name>Get ResultSet Date</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149838553</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Retrives the java.util.Date value for a particular column from a ResultSet. Handles cases where the
	object returned from the ResultSet is a string.

	@param {ResultSet} resultSet - The ResultSet object to retrieve from.
	@param {String} columnName - The name or alias of the column to retrieve.
	@return {Date} The java.util.Date value.
*/
function getResultSetDate(resultSet, columnName) {
	var obj = resultSet.getObject(columnName);
	if (obj != null) {
		if (obj instanceof java.lang.String) {
			obj = getDate(obj);
		}
	}
	return obj;
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>278733a7-de15-4324-bfa0-2034ae868afd</id>
          <name>Get ResultSet String</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149837910</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Retrives the string value for a particular column from a ResultSet. Handles instances of
	java.sql.Clob and java.sql.Blob as well (with the JVM default charset).

	@param {ResultSet} resultSet - The ResultSet object to retrieve from.
	@param {String} columnName - The name or alias of the column to retrieve.
	@return {String} The string value.
*/
function getResultSetString(resultSet, columnName) {
	var obj = resultSet.getObject(columnName);
	if (obj != null) {
		if (obj instanceof java.sql.Clob) {
			obj = org.apache.commons.io.IOUtils.toString(obj.getCharacterStream());
		} else if (obj instanceof java.sql.Blob) {
			obj = org.apache.commons.io.IOUtils.toString(obj.getBinaryStream());
		} else {
			obj = java.lang.String.valueOf(obj);
		}
	}
	return obj;
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>62e254fc-a206-41b2-bf9f-e9c55cb49ef1</id>
          <name>History Utility Methods</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149838293</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	These functions are used with the history interaction.
*/
function getFhirHistoryBaseQuery() {
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);
	if (dbType == &apos;postgres&apos;) {
		return &quot;SELECT name, id, version, data::TEXT, mimetype, deleted, request_method, request_url FROM resource&quot;;
	} else if (dbType == &apos;sqlserver&apos;) {
		return &quot;SELECT name, id, version, CAST(data AS NVARCHAR(MAX)) AS data, mimetype, deleted, request_method, request_url FROM resource&quot;;
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}

function getFhirHistorySinceWherePart() {
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);
	if (dbType == &apos;postgres&apos;) {
		return &quot;last_modified &gt;= ?::TIMESTAMP WITH TIME ZONE&quot;;
	} else if (dbType == &apos;sqlserver&apos;) {
		return &quot;last_modified &gt;= CAST(? AS DATETIME)&quot;;
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}
</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>a67e8be3-11a3-4403-aaa7-ea495a98af23</id>
          <name>Insert Deleted Resource</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149838081</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Inserts a deleted entry for a resource and returns its DB sequence ID.

	@param {String} type - The FHIR resource type.
	@param {String} id - The logical ID of the resource.
	@param {Number} versionId - The version ID of the resource.
	@param {Date} lastUpdated - The last updated time of the resource.
	@param {String} method - The HTTP method used to create the resource.
	@param {String} url - The HTTP URL used to create the resource.
	@return {Number} The database sequence ID for the inserted resource.
*/
function insertFhirDeletedResource(type, id, versionId, lastUpdated, method, url) {
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);

	if (dbType == &apos;postgres&apos;) {
		var params = [type, id, versionId, lastUpdated, $(&apos;method&apos;), $(&apos;url&apos;)];
		var result = executeUpdateAndGetGeneratedKeys(&quot;INSERT INTO resource (name, id, version, last_modified, deleted, request_method, request_url) VALUES (?, ?, ?, ?, TRUE, ?, ?)&quot;, params);
		result.next();
		return result.getInt(1);
	} else if (dbType == &apos;sqlserver&apos;) {
		var dbConn = createFHIRDBConnection();
		
		try {
			dbConn.setAutoCommit(false);
			
			var idResult = executeCachedQuery(&apos;SELECT id FROM resource_sequence WITH (UPDLOCK)&apos;, [], dbConn);
			idResult.next();
			var sequenceId = idResult.getInt(1);
			executeUpdate(&apos;UPDATE resource_sequence SET ID = ID + 1&apos;, [], dbConn);
			dbConn.commit();

			var params = [sequenceId, type, id, versionId, lastUpdated, $(&apos;method&apos;), $(&apos;url&apos;)];
			executeUpdate(&quot;INSERT INTO resource (sequence_id, name, id, version, last_modified, deleted, request_method, request_url) VALUES (?, ?, ?, ?, ?, 1, ?, ?)&quot;, params, dbConn);
			dbConn.commit();
			
			return sequenceId;
		} catch (e) {
			try { dbConn.rollback() } catch (e2) {}
			throw e;
		} finally {
			try { dbConn.close() } catch (e) {}
		}
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>407c077f-579a-47af-bb78-1829cdd789c3</id>
          <name>Insert Resource</name>
          <revision>26</revision>
          <lastModified>
            <time>1595322138311</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Inserts a new resource and returns its DB sequence ID.

	@param {String} type - The FHIR resource type.
	@param {String} id - The logical ID of the resource.
	@param {Number} versionId - The version ID of the resource.
	@param {Date} lastUpdated - The last updated time of the resource.
	@param {String} data - The resource data.
	@param {String} contentType - The MIME type of the resource data.
	@param {String} method - The HTTP method used to create the resource.
	@param {String} url - The HTTP URL used to create the resource.
	@return {Number} The database sequence ID for the inserted resource.
*/
function insertFhirResource(type, id, versionId, lastUpdated, data, contentType, method, url) {
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);
	if (dbType == &apos;MySQL&apos;) {
		var params = [type, id, versionId, lastUpdated, data, contentType, method, url];			//postgres
		//var params = [sequenceId, type, id, versionId, lastUpdated, data, contentType, method, url]; //sqlserver
		var dbConn;
		try { 
/*			
logger.info(&quot;&amp;&amp;&amp; insertFhirResource MySQL params[0]  &quot; + params[0]);
logger.info(&quot;&amp;&amp;&amp; insertFhirResource MySQL params[1]  &quot; + params[1]);
logger.info(&quot;&amp;&amp;&amp; insertFhirResource MySQL params[2]  &quot; + params[2]);
logger.info(&quot;&amp;&amp;&amp; insertFhirResource MySQL params[3]  &quot; + params[3]);
logger.info(&quot;&amp;&amp;&amp; insertFhirResource MySQL params[4]  &quot; + params[4]);
logger.info(&quot;&amp;&amp;&amp; insertFhirResource MySQL params[5]  &quot; + params[5]);
logger.info(&quot;&amp;&amp;&amp; insertFhirResource MySQL params[6]  &quot; + params[6]);
logger.info(&quot;&amp;&amp;&amp; insertFhirResource MySQL params[7]  &quot; + params[7]);
			//var result = dbConn.executeUpdate(&quot;INSERT INTO PERSON (USERNAME, FIRSTNAME, LASTNAME, LOGGED_IN) VALUES (&apos;Username&apos;, &apos;FirstName&apos;, &apos;LastName&apos;, 0)&quot;);		
			//var result = dbConn.executeUpdate(&quot;INSERT INTO resource (name, id, version, last_modified, data, mimetype, request_method, request_url) VALUES (?, ?, ?, ?, ?::XML, ?, ?, ?)&quot;, params);
	//var result = dbConn.executeUpdate(&quot;INSERT INTO PERSON (USERNAME, FIRSTNAME, LASTNAME, LOGGED_IN) VALUES (&apos;&quot;+$(&apos;Username&apos;)+&quot;&apos;, &apos;&quot;+$(&apos;FirstName&apos;)+&quot;&apos;, &apos;&quot;+$(&apos;LastName&apos;)+&quot;&apos;, 0)&quot;);		
*/
			var patientdata = params[4];
			logger.info(&quot;%%% patientdata=  &quot; + patientdata);
			dbConn = DatabaseConnectionFactory.createDatabaseConnection(
			    &apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://db:3306/mirthdb&apos;,&apos;root&apos;,&apos;root_password&apos;);			
			var patientxml = new XML( patientdata );	
			var UserName  = patientxml.name.use.@value;
			var LastName  = patientxml.name.family.@value;
			var FirstName = patientxml.name.given.@value;			
			logger.info(&quot;%%% patientdata xml LastName=  &quot; + LastName);
			var result = dbConn.executeUpdate(
	 		&quot;INSERT INTO PERSON (USERNAME, FIRSTNAME, LASTNAME, LOGGED_IN) &quot;+
	 		&quot;VALUES (&apos;&quot;+ UserName +&quot;&apos;,&apos;&quot;+ FirstName +&quot;&apos;,&apos;&quot;+LastName +&quot;&apos;, 0)&quot;);			
		}catch (e) { throw &apos;MySQL db ERROR: &apos; + e; }
		finally { if (dbConn) {  dbConn.close(); } 
		}		
 	} else
	if (dbType == &apos;postgres&apos;) {
		var params = [type, id, versionId, lastUpdated, data, contentType, method, url];
 		var result = executeUpdateAndGetGeneratedKeys(&quot;INSERT INTO resource (name, id, version, last_modified, data, mimetype, request_method, request_url) VALUES (?, ?, ?, ?, ?::XML, ?, ?, ?)&quot;, params);
		result.next();
		return result.getInt(1);
	} else if (dbType == &apos;sqlserver&apos;) {
		var dbConn = createFHIRDBConnection();
		
		try {
			dbConn.setAutoCommit(false);
			
			var idResult = executeCachedQuery(&apos;SELECT id FROM resource_sequence WITH (UPDLOCK)&apos;, [], dbConn);
			idResult.next();
			var sequenceId = idResult.getInt(1);
			executeUpdate(&apos;UPDATE resource_sequence SET ID = ID + 1&apos;, [], dbConn);
			dbConn.commit();

			var params = [sequenceId, type, id, versionId, lastUpdated, data, contentType, method, url];
			executeUpdate(&quot;INSERT INTO resource (sequence_id, name, id, version, last_modified, data, mimetype, request_method, request_url) VALUES (?, ?, ?, ?, ?, CAST(? AS XML), ?, ?, ?)&quot;, params, dbConn);
			dbConn.commit();
			
			return sequenceId;
		} catch (e) {
			try { dbConn.rollback() } catch (e2) {}
			throw e;
		} finally {
			try { dbConn.close() } catch (e) {}
		}
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>f5c11e82-475f-4a53-a370-273a6027eba0</id>
          <name>Search Utility Methods</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149837351</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	These functions are used with the search interaction.
*/
function getFhirSearchBaseQuery(usingLimit) {
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);
	if (dbType == &apos;postgres&apos;) {
		return &quot;SELECT name, id, version, data::TEXT, mimetype, request_method, request_url FROM resource r1 WHERE version = (SELECT MAX(version) FROM resource r2 WHERE r2.name = r1.name AND r2.id = r1.id) AND (deleted IS NULL OR deleted = FALSE)&quot;;
	} else if (dbType == &apos;sqlserver&apos;) {
		var query = &quot;SELECT name, id, version, CAST(data AS NVARCHAR(MAX)) AS data, mimetype, request_method, request_url&quot;;
		if (usingLimit) {
			query += &quot;, ROW_NUMBER() OVER (&quot; + getOrderClause() + &quot;) AS ROWNUM&quot;;
		}
		return query + &quot; FROM resource r1 WHERE version = (SELECT MAX(version) FROM resource r2 WHERE r2.name = r1.name AND r2.id = r1.id) AND (deleted IS NULL OR deleted = 0)&quot;;
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}

function getFhirSearchContentWherePart() {
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);
	if (dbType == &apos;postgres&apos;) {
		return &quot;data::TEXT ILIKE ?&quot;;
	} else if (dbType == &apos;sqlserver&apos;) {
		return &quot;UPPER(CAST(data AS NVARCHAR(MAX))) LIKE UPPER(?)&quot;;
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}

function getFhirSearchLastUpdatedWherePart(lastUpdatedOperator) {
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);
	if (dbType == &apos;postgres&apos;) {
		return &quot;last_modified &quot; + convertFhirParameterOperator(lastUpdatedOperator) + &quot; ?::TIMESTAMP WITH TIME ZONE&quot;;
	} else if (dbType == &apos;sqlserver&apos;) {
		return &quot;last_modified &quot; + convertFhirParameterOperator(lastUpdatedOperator) + &quot; CAST(? AS DATETIMEOFFSET)&quot;;
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}

function convertFhirParameterOperator(operator) {
	switch ((operator + &apos;&apos;).toLowerCase()) {
		case &apos;eq&apos;: return &apos;=&apos;;
		case &apos;ne&apos;: return &apos;!=&apos;;
		case &apos;gt&apos;: return &apos;&gt;&apos;;
		case &apos;lt&apos;: return &apos;&lt;&apos;;
		case &apos;ge&apos;: return &apos;&gt;=&apos;;
		case &apos;le&apos;: return &apos;&lt;=&apos;;
		case &apos;sa&apos;: return &apos;&gt;&apos;;
		case &apos;eb&apos;: return &apos;&lt;&apos;;
		case &apos;ap&apos;: return &apos;=&apos;;
		default: return &apos;=&apos;;
	}
}

function convertXPathNodeSingleton(node) {
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);
	if (dbType == &apos;postgres&apos;) {
		return node;
	} else if (dbType == &apos;sqlserver&apos;) {
		return node.split(&apos;/&apos;).join(&apos;[1]/&apos;);
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}

function xpathLowerCase(value) {
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);
	if (dbType == &apos;postgres&apos;) {
		return &quot;translate(&quot; + value + &quot;, &apos;ABCDEFGHIJKLMNOPQRSTUVWXYZ&apos;, &apos;abcdefghijklmnopqrstuvwxyz&apos;)&quot;;
	} else if (dbType == &apos;sqlserver&apos;) {
		return &quot;fn:lower-case(&quot; + value + &quot;)&quot;;
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}

function getFhirSearchXPathWherePart() {
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);
	if (dbType == &apos;postgres&apos;) {
		return &quot;XPATH_EXISTS(?, data)&quot;;
	} else if (dbType == &apos;sqlserver&apos;) {
		return &quot;data.exist(?) = 1&quot;;
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}

function addXPath(xpath, whereParts, params) {
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);
	if (dbType == &apos;postgres&apos;) {
		whereParts.push(getFhirSearchXPathWherePart());
		params.push(xpath);
	} else if (dbType == &apos;sqlserver&apos;) {
		whereParts.push(getFhirSearchXPathWherePart().replace(&apos;?&apos;, &quot;&apos;&quot; + xpath.replace(/&apos;/g, &quot;&apos;&apos;&quot;) + &quot;&apos;&quot;));
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}

function addOrder(query, usingLimit) {
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);
	if (dbType == &apos;postgres&apos;) {
		return query + &quot; &quot; + getOrderClause();
	} else if (dbType == &apos;sqlserver&apos;) {
		if (usingLimit) {
			return query;
		} else {
			return query + &quot; &quot; + getOrderClause();
		}
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}

function getOrderClause() {
	return &quot;ORDER BY name ASC, id ASC, version DESC&quot;;
}

function addLimit(query, limit) {
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);
	if (dbType == &apos;postgres&apos;) {
		return query + &quot; LIMIT &quot; + limit;
	} else if (dbType == &apos;sqlserver&apos;) {
		return &quot;SELECT A.* FROM (&quot; + query + &quot;) AS A WHERE A.ROWNUM &lt;= &quot; + limit;
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}
</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>785079c4-fc60-4e5c-a4ec-645cb3741560</id>
          <name>Select Resource Instance</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149838839</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Returns a ResultSet for a specific resource instance.

	@param {String} type - The FHIR resource type.
	@param {String} id - The logical ID of the resource.
	@return {ResultSet} The ResultSet.
*/
function getResource(type, id) {
	var params = [type, id];
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);

	if (dbType == &apos;postgres&apos;) {
		return executeCachedQuery(&quot;SELECT version, data::TEXT, mimetype, last_modified, deleted FROM resource WHERE name = ? AND id = ? ORDER BY version DESC LIMIT 1&quot;, params);
	} else if (dbType == &apos;sqlserver&apos;) {
		return executeCachedQuery(&quot;SELECT TOP 1 version, CAST(data AS NVARCHAR(MAX)) AS data, mimetype, last_modified, deleted FROM resource WHERE name = ? AND id = ? ORDER BY version DESC&quot;, params);
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>9411a28b-5f0d-4bc3-8acf-d892b5beb7db</id>
          <name>Select Resource Instance by Version</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149837578</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Returns a ResultSet for a specific resource instance at a specific version.

	@param {String} type - The FHIR resource type.
	@param {String} id - The logical ID of the resource.
	@param {Number} versionId - The version ID of the resource.
	@return {ResultSet} The ResultSet.
*/
function getResourceVersion(type, id, versionId) {
	var params = [type, id, parseInt(versionId, 10)];
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);

	if (dbType == &apos;postgres&apos;) {
		return executeCachedQuery(&quot;SELECT data::TEXT, mimetype, last_modified, deleted FROM resource WHERE name = ? AND id = ? AND version = ?&quot;, params);
	} else if (dbType == &apos;sqlserver&apos;) {
		return executeCachedQuery(&quot;SELECT CAST(data AS NVARCHAR(MAX)) AS data, mimetype, last_modified, deleted FROM resource WHERE name = ? AND id = ? AND version = ?&quot;, params);
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>afe40f10-efc5-4014-833a-e96be7a422d1</id>
          <name>Select Version</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149837731</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Returns the version ID for a given resource, or 0 if it doesn&apos;t exist.

	@param {String} type - The FHIR resource type.
	@param {String} id - The logical ID of the resource.
	@return {Number} The version ID, or 0 if the resource doesn&apos;t exist.
*/
function getFhirVersion(type, id) {
	var params = [type, id];
	var result;

	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);
	if (dbType == &apos;postgres&apos;) {
		result = executeCachedQuery(&quot;SELECT version FROM resource WHERE name = ? AND id = ? ORDER BY version DESC LIMIT 1&quot;, params);
	} else if (dbType == &apos;sqlserver&apos;) {
		result = executeCachedQuery(&quot;SELECT TOP 1 version FROM resource WHERE name = ? AND id = ? ORDER BY version DESC&quot;, params);
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
	
	if (result.next()) {
		return result.getInt(1);
	}
	return 0;
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>2c822c38-30aa-4447-8e9e-9ea07e597c9d</id>
          <name>Select Version and Deleted ResultSet</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149837989</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Returns a ResultSet with the version and deleted flag for a given resource.

	@param {String} type - The FHIR resource type.
	@param {String} id - The logical ID of the resource.
	@return {ResultSet} The ResultSet.
*/
function getFhirVersionAndDeleted(type, id) {
	var params = [type, id];
	var dbType = $cfg(&apos;fhirDBDatabaseType&apos;);
	if (dbType == &apos;postgres&apos;) {
		return executeCachedQuery(&quot;SELECT version, deleted FROM resource WHERE name = ? AND id = ? ORDER BY version DESC LIMIT 1&quot;, params);
	} else if (dbType == &apos;sqlserver&apos;) {
		return executeCachedQuery(&quot;SELECT TOP 1 version, deleted FROM resource WHERE name = ? AND id = ? ORDER BY version DESC&quot;, params);
	} else {
		throw &apos;Unsupported DB type: &apos; + dbType;
	}
}</code>
          </properties>
        </codeTemplate>
      </codeTemplates>
    </codeTemplateLibrary>
    <codeTemplateLibrary version="3.9.0">
      <id>a084db27-49e0-4c67-893b-ffcc9f1d6e94</id>
      <name>FHIR Helper Functions</name>
      <revision>2</revision>
      <lastModified>
        <time>1595168629994</time>
        <timezone>Etc/UTC</timezone>
      </lastModified>
      <description>Other common helper functions used by the FHIR Listener channel.</description>
      <includeNewChannels>false</includeNewChannels>
      <enabledChannelIds>
        <string>1892f241-d643-4abb-b0af-b20b87e0cf12</string>
      </enabledChannelIds>
      <disabledChannelIds>
        <string>42e730bb-0721-435e-8dcf-d25d6d5d1dc6</string>
        <string>e678dbf5-f021-43dc-84ae-967500d5c31a</string>
      </disabledChannelIds>
      <codeTemplates>
        <codeTemplate version="3.9.0">
          <id>d8e6f7a5-aeec-4025-a6d2-e568eb48e647</id>
          <name>Convert Date</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149838456</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Supports parsing date strings in a variety of formats and outputting the date in a specific format.
*/
var patterns = [
	&quot;yyyy-MM-dd HH:mm:ss.SSSSSSS ZZ&quot;,
	&quot;yyyy-MM-dd&apos;T&apos;HH:mm:ss.SSSZ&quot;,
	&quot;yyyy-MM-dd&apos;T&apos;HH:mm:ssZ&quot;,
	&quot;yyyy-MM-dd&apos;T&apos;HH:mm:ss&quot;,
	&quot;yyyy-MM-dd&apos;T&apos;HH:mm&quot;,
	&apos;yyyy-MM-dd&apos;,
	&apos;yyyy-MM-dd HH:mm:ss:SSS&apos;,
	&apos;yyyy-MM-dd HH:mm:ss.SSS&apos;,
	&apos;yyyy-MM-dd HH:mm:ss&apos;,
	&apos;yyyy-MM-dd HH:mm&apos;,
	&apos;EEE MMM dd HH:mm:ss:SSS zzz yyyy&apos;,
	&apos;EEE MMM dd HH:mm:ss.SSS zzz yyyy&apos;,
	&apos;EEE MMM dd HH:mm:ss zzz yyyy&apos;,
	&apos;EEE MMM dd zzz yyyy&apos;,
	&apos;dd-MMM-yyyy HH:mm:ss:SSS&apos;,
	&apos;dd-MMM-yyyy HH:mm:ss.SSS&apos;,
	&apos;dd-MMM-yyyy HH:mm:ss&apos;,
	&apos;yyyy MM dd&apos;,
	&apos;yyyy.MM.dd&apos;,
	&apos;MM-dd-yyyy&apos;,
	&apos;MM dd yyyy&apos;,
	&apos;MM.dd.yyyy&apos;,
	&apos;HH:mm:ss:SSS&apos;,
	&apos;HH:mm:ss.SSS&apos;,
	&apos;HH:mm:ss&apos;,
	&apos;yyyyMMddHHmmssSSS&apos;,
	&apos;yyyyMMddHHmmss&apos;,
	&apos;yyyyMMddHHmm&apos;,
	&apos;hh:mm aa&apos;];

var formatters = [];
for each (pattern in patterns) {
	formatters.push(org.joda.time.format.DateTimeFormat.forPattern(pattern));
}

function getMillis(date) {
	var instant = 0;
	if (typeof date == &apos;number&apos; || date instanceof java.lang.Number)
		instant = new Number(date);
	else if (date instanceof Date || date instanceof java.util.Date)
		instant = date.getTime();
	else if (date instanceof org.joda.time.ReadableInstant)
		instant = date.getMillis();
	else {
		for each (formatter in formatters) {
			try {
				instant = formatter.parseMillis(new String(date));
				break;
			} catch(e) {}
		}
	}

	return instant;
}

function getDate(date) {
	return new java.util.Date(getMillis(date));
}

function convertDate(date, outpattern) {
	return org.joda.time.format.DateTimeFormat.forPattern(outpattern).print(getMillis(date));
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>0e158aa1-77ee-465c-bb7a-13f4c8ecda13</id>
          <name>Create FHIR OperationOutcome</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149839020</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>CHANNEL_ATTACHMENT</contextType>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>CHANNEL_POSTPROCESSOR</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
    Creates a FHIR OperationOutcome resource and adds it to the response map with the key &quot;response&quot;.

    @param {String} severity - Indicates whether the issue indicates a variation from successful
        processing. Values: fatal | error | warning | information
    @param {String} code - Describes the type of the issue. The system that creates an
        OperationOutcome SHALL choose the most applicable code from the IssueType value set, and may
        additional provide its own code for the error in the details element. Values: invalid | security |
        processing | transient | informational
    @param {String} details - Additional details about the error. This may be a text description of
        the error, or a system code that identifies the error.
    @param {String} fhirVersion - The FHIR version of the OperationOutcome resource. Values: DSTU2 | DSTU2_1 | 
    	   DSTU_HL7ORG | STU3 | R4 | R5
    @param {int} httpStatusCode - The HTTP status code to send back with the response. Defaults to 400
        if not specified.
    @param {Error} e - If included, this will be used to build up the response status message and
        error.
    @param {Boolean} isFormatXML - If true, the resource will be formatted in XML. Otherwise, it will
        be formatted in JSON. If not specified, it will attempt to find the _format parameter in the source
        map, or return JSON.
    @return {Response} The created Response object.
*/
function createOperationOutcome(severity, code, details, fhirVersion, httpStatusCode, e, isFormatXML) {
    if (!httpStatusCode) {
        httpStatusCode = 400;
    }

    if (!isFormatXML &amp;&amp; $s(&apos;parameters&apos;) &amp;&amp; $s(&apos;parameters&apos;).contains(&apos;_format&apos;)) {
        isFormatXML = !FhirUtil.isJSON($s(&apos;parameters&apos;).getParameter(&apos;_format&apos;));
    }

    var outcome = FhirUtil.createOperationOutcome(severity, code, details, fhirVersion);
    var message = isFormatXML ? FhirUtil.toXML(outcome, fhirVersion) : FhirUtil.toJSON(outcome, fhirVersion);
    responseMap.put(&apos;response&apos;, FhirResponseFactory.getResponse(message, httpStatusCode, isFormatXML ? FhirUtil.getMIMETypeXML() : FhirUtil.getMIMETypeJSON()));
    var response = new Response(message);
    response.setStatusMessage(severity.toUpperCase() + &apos; OperationOutcome created with status &apos; + httpStatusCode + &apos;.&apos;);

    if (httpStatusCode &gt;= 400) {
        response.setStatus(Status.ERROR);

        if (e) {
            var customMessage = &apos;Channel &apos; + channelName + &apos;: &apos;;
            if (e.rhinoException) {
                customMessage += &apos;Error on line &apos; + e.rhinoException.lineNumber() + &apos;: &apos;;
            }
            customMessage += e.toString();
    
            var errorContent = com.mirth.connect.util.ErrorMessageBuilder.buildErrorMessage(&apos;FHIR Listener&apos;, customMessage, e.javaException || null);
            if (e.javaException) {
                logger.error(errorContent, e.javaException);    
            } else {
                logger.error(errorContent);
            }
            response.setError(errorContent);
        }
    }

    return response;
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>a9691b6e-b455-4789-b4d7-89bcc095a163</id>
          <name>Get Prefer Header Value</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149838665</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>CHANNEL_ATTACHMENT</contextType>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>CHANNEL_POSTPROCESSOR</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Returns the &quot;return&quot; element of the Prefer HTTP header if specified.

	@return {String} The &quot;return&quot; element of the Prefer header, or undefined if not present
*/
function getPreferValue() {
	var preferReturn;
	var preferHeader = $(&apos;headers&apos;).getHeader(&apos;Prefer&apos;);
	
	if (preferHeader) {
		for each (element in new org.apache.http.message.BasicHeader(&apos;Prefer&apos;, preferHeader).getElements()) {
			if (element.getName() == &apos;return&apos;) {
				preferReturn = element.getValue();
				break;
			}
		}
	}
	
	return preferReturn;
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>18c799ae-3553-40b0-b8cc-8898fbad5f7d</id>
          <name>Import Common Packages</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149838148</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>CHANNEL_ATTACHMENT</contextType>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>CHANNEL_POSTPROCESSOR</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>COMPILED_CODE</type>
            <code>/**
	Imports HAPI FHIR packages commonly used in the FHIR Listener channel.
*/
importPackage(Packages.ca.uhn.fhir.model.api);
importPackage(Packages.ca.uhn.fhir.model.base.resource);
importPackage(Packages.ca.uhn.fhir.model.primitive);
importPackage(Packages.org.hl7.fhir.r4.model);
importPackage(org.apache.commons.lang3);
importPackage(org.apache.commons.lang3.math);</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>ece0b77f-a9bc-43f1-ae57-96bb3a1b4143</id>
          <name>Update Resource Meta</name>
          <revision>1</revision>
          <lastModified>
            <time>1595149838383</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Sets the resource ID, version ID, and last updated date/time.

	@param {IBaseResource} resource - The FHIR resource object.
	@param {String} id - The logical ID of the resource.
	@param {Number} versionId - The version ID of the resource.
	@return {Date} The last updated date/time.
*/
function updateResourceMeta(resource, id, versionId) {
	resource.setId(id);
	resource.getMeta().setVersionId(new String(versionId));
	var lastUpdated = new java.util.Date();
	resource.getMeta().getLastUpdatedElement().setTimeZone(java.util.TimeZone.getDefault());
	resource.getMeta().setLastUpdated(lastUpdated);
	return lastUpdated;
}</code>
          </properties>
        </codeTemplate>
      </codeTemplates>
    </codeTemplateLibrary>
    <codeTemplateLibrary version="3.9.0">
      <id>4f1160ba-0cd5-4899-9329-03683147ccca</id>
      <name>HL7 v2.x to FHIR Creation Functions</name>
      <revision>1</revision>
      <lastModified>
        <time>1595399126094</time>
        <timezone>Etc/UTC</timezone>
      </lastModified>
      <description>These code templates serve as an example of how to dynamically build
FHIR resources and convert from other formats such as HL7 v2.x.

Some of the code templates in this library are dependent on other
code templates from the &quot;HL7 v2.x to FHIR Helper Functions&quot; library.</description>
      <includeNewChannels>false</includeNewChannels>
      <enabledChannelIds>
        <string>42e730bb-0721-435e-8dcf-d25d6d5d1dc6</string>
      </enabledChannelIds>
      <disabledChannelIds>
        <string>1892f241-d643-4abb-b0af-b20b87e0cf12</string>
        <string>e678dbf5-f021-43dc-84ae-967500d5c31a</string>
      </disabledChannelIds>
      <codeTemplates>
        <codeTemplate version="3.9.0">
          <id>63476871-1ea1-4377-8998-0e2e0670e575</id>
          <name>Create and Consolidate FHIR Patient</name>
          <revision>1</revision>
          <lastModified>
            <time>1595399126429</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Constructs a new FHIR Patient object from the PID and NK1 segments. Also consolidates and cleans up
	empty fields.

	@param {XML} msg - The E4X XML representation of the HL7 v2.x message.
	@return {Object} The JavaScript Object representation of the FHIR Patient.
*/
function createAndConsolidateFhirPatient(msg) {
	return consolidate(cleanupFhirPatient(createFhirPatient(msg)));
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>67f171ca-47bd-431c-b71b-4b032ee52e21</id>
          <name>Create FHIR Patient</name>
          <revision>1</revision>
          <lastModified>
            <time>1595399126232</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.plugins.fhir.shared.FhirModelBuilderCodeTemplateProperties" version="3.9.0">
            <type>FUNCTION</type>
            <functionSignature>createFhirPatient(msg)</functionSignature>
            <jsDoc>/**
	Use the createAndConsolidateFhirPatient method instead, as it consolidates empty fields too.
	Constructs a new FHIR Patient object from the PID and NK1 segments.

	@param {XML} msg - The E4X XML representation of the HL7 v2.x message.
	@return {Object} The JavaScript Object representation of the FHIR Patient.
*/</jsDoc>
            <resultReturnValue>true</resultReturnValue>
            <resultMapType>CHANNEL</resultMapType>
            <resultMapVariable></resultMapVariable>
            <definition>Patient</definition>
            <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
              <usingBuilder>true</usingBuilder>
              <properties class="linked-hash-map">
                <entry>
                  <string>resourceType</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>Patient</stringValue>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>identifier</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                      <stringValue>createPatientIdentifiers(msg[&apos;PID&apos;])</stringValue>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>name</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                      <stringValue>createPatientNames(msg[&apos;PID&apos;])</stringValue>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>telecom</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                      <stringValue>createPatientTelecoms(msg[&apos;PID&apos;])</stringValue>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>gender</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>convertToFhirGender(msg[&apos;PID&apos;][&apos;PID.8&apos;][&apos;PID.8.1&apos;].toString())</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>birthDate</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>convertToFhirDate(msg[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString())</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>deceasedBoolean</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.BooleanModel">
                      <stringValue>convertYesNoIndicator(msg[&apos;PID&apos;][&apos;PID.30&apos;][&apos;PID.30.1&apos;].toString())</stringValue>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>deceasedDateTime</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>convertToFhirTimestamp(msg[&apos;PID&apos;][&apos;PID.29&apos;][&apos;PID.29.1&apos;].toString())</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>address</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                      <stringValue>createPatientAddresses(msg[&apos;PID&apos;])</stringValue>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>maritalStatus</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                      <usingBuilder>true</usingBuilder>
                      <properties class="linked-hash-map">
                        <entry>
                          <string>text</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>msg[&apos;PID&apos;][&apos;PID.16&apos;][&apos;PID.16.1&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                      </properties>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>multipleBirthBoolean</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.BooleanModel">
                      <stringValue>convertYesNoIndicator(msg[&apos;PID&apos;][&apos;PID.24&apos;][&apos;PID.24.1&apos;].toString())</stringValue>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>contact</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                      <stringValue>createPatientContacts(msg[&apos;NK1&apos;])</stringValue>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>communication</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                      <usingBuilder>true</usingBuilder>
                      <elements>
                        <com.mirth.connect.jsonbuilder.shared.models.ObjectModel>
                          <usingBuilder>true</usingBuilder>
                          <properties class="linked-hash-map">
                            <entry>
                              <string>language</string>
                              <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                <enabled>true</enabled>
                                <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                                  <usingBuilder>true</usingBuilder>
                                  <properties class="linked-hash-map">
                                    <entry>
                                      <string>id</string>
                                      <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                        <enabled>true</enabled>
                                        <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                          <stringValue>msg[&apos;PID&apos;][&apos;PID.15&apos;][&apos;PID.15.1&apos;].toString()</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </properties>
                                      </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    </entry>
                                    <entry>
                                      <string>text</string>
                                      <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                        <enabled>true</enabled>
                                        <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                          <stringValue>msg[&apos;PID&apos;][&apos;PID.15&apos;][&apos;PID.15.2&apos;].toString()</stringValue>
                                          <scriptExpression>true</scriptExpression>
                                        </properties>
                                      </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    </entry>
                                  </properties>
                                </properties>
                              </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            </entry>
                          </properties>
                        </com.mirth.connect.jsonbuilder.shared.models.ObjectModel>
                      </elements>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
              </properties>
            </model>
            <fhirVersion>R4</fhirVersion>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>767a5ea0-0510-4784-a651-770759f2c4ca</id>
          <name>Create FHIR Patient Address</name>
          <revision>1</revision>
          <lastModified>
            <time>1595399126757</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.plugins.fhir.shared.FhirModelBuilderCodeTemplateProperties" version="3.9.0">
            <type>FUNCTION</type>
            <functionSignature>createPatientAddress(pid11)</functionSignature>
            <jsDoc>/**
	Creates a new FHIR Address object from the given PID.11 field.

	@param {XML} pid11 - The E4X XML PID.11 node from the HL7 v2.x message.
	@return {Object} The JavaScript Object representation of the FHIR Address.
*/</jsDoc>
            <resultReturnValue>true</resultReturnValue>
            <resultMapType>CHANNEL</resultMapType>
            <resultMapVariable></resultMapVariable>
            <definition>Address</definition>
            <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
              <usingBuilder>true</usingBuilder>
              <properties class="linked-hash-map">
                <entry>
                  <string>use</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>convertAddressUse(pid11[&apos;PID.11.7&apos;].toString())</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>type</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>false</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>postal</stringValue>
                      <usingEnum>true</usingEnum>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>text</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>(pid11[&apos;PID.11.1&apos;].toString() + &apos; &apos; + pid11[&apos;PID.11.2&apos;].toString() + &apos; &apos; + pid11[&apos;PID.11.3&apos;].toString() + &apos; &apos; + pid11[&apos;PID.11.4&apos;].toString() + &apos; &apos; + pid11[&apos;PID.11.5&apos;].toString() + &apos; &apos; + pid11[&apos;PID.11.6&apos;].toString()).trim()</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>line</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                      <usingBuilder>true</usingBuilder>
                      <elements>
                        <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                          <stringValue>pid11[&apos;PID.11.1&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                        <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                          <stringValue>pid11[&apos;PID.11.2&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                      </elements>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>city</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>pid11[&apos;PID.11.3&apos;].toString()</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>district</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>pid11[&apos;PID.11.9&apos;].toString()</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>state</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>pid11[&apos;PID.11.4&apos;].toString()</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>postalCode</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>pid11[&apos;PID.11.5&apos;].toString()</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>country</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>pid11[&apos;PID.11.6&apos;].toString()</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>period</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                      <usingBuilder>true</usingBuilder>
                      <properties class="linked-hash-map">
                        <entry>
                          <string>start</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>convertToFhirTimestamp(pid11[&apos;PID.11.13&apos;].toString())</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>end</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>convertToFhirTimestamp(pid11[&apos;PID.11.14&apos;].toString())</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                      </properties>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
              </properties>
            </model>
            <fhirVersion>R4</fhirVersion>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>815aeba2-099f-4f62-aae0-567aa9927a4b</id>
          <name>Create FHIR Patient Addresses</name>
          <revision>1</revision>
          <lastModified>
            <time>1595399126831</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Creates a new array of FHIR Address objects from the given PID segment.

	@param {XML} pid - The E4X XML PID node from the HL7 v2.x message.
	@return {Array} The array of Address objects.
*/
function createPatientAddresses(pid) {
	var addresses = Lists.list();
	for (var i = 0; i &lt; pid[&apos;PID.11&apos;].length(); i++) {
		addresses.add(createPatientAddress(pid[&apos;PID.11&apos;][i]));
	}
	return addresses.toArray();
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>b8ca268a-0fda-4445-95bc-27334ebcf97f</id>
          <name>Create FHIR Patient Contact</name>
          <revision>1</revision>
          <lastModified>
            <time>1595399126154</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.plugins.fhir.shared.FhirModelBuilderCodeTemplateProperties" version="3.9.0">
            <type>FUNCTION</type>
            <functionSignature>createPatientContact(nk1)</functionSignature>
            <jsDoc>/**
	Creates a new FHIR Patient_Contact object from the given NK1 segment.

	@param {XML} nk1 - The E4X XML NK1 segment from the HL7 v2.x message.
	@return {Object} The JavaScript Object representation of the FHIR Patient_Contact.
*/</jsDoc>
            <resultReturnValue>true</resultReturnValue>
            <resultMapType>CHANNEL</resultMapType>
            <resultMapVariable></resultMapVariable>
            <definition>Patient_Contact</definition>
            <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
              <usingBuilder>true</usingBuilder>
              <properties class="linked-hash-map">
                <entry>
                  <string>relationship</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                      <usingBuilder>true</usingBuilder>
                      <elements>
                        <com.mirth.connect.jsonbuilder.shared.models.ObjectModel>
                          <usingBuilder>true</usingBuilder>
                          <properties class="linked-hash-map">
                            <entry>
                              <string>id</string>
                              <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                <enabled>true</enabled>
                                <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                  <stringValue>nk1[&apos;NK1.3&apos;][&apos;NK1.3.1&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            </entry>
                            <entry>
                              <string>text</string>
                              <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                <enabled>true</enabled>
                                <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                  <stringValue>nk1[&apos;NK1.3&apos;][&apos;NK1.3.2&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            </entry>
                          </properties>
                        </com.mirth.connect.jsonbuilder.shared.models.ObjectModel>
                        <com.mirth.connect.jsonbuilder.shared.models.ObjectModel>
                          <usingBuilder>true</usingBuilder>
                          <properties class="linked-hash-map">
                            <entry>
                              <string>id</string>
                              <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                <enabled>true</enabled>
                                <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                  <stringValue>nk1[&apos;NK1.7&apos;][&apos;NK1.7.1&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            </entry>
                            <entry>
                              <string>text</string>
                              <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                <enabled>true</enabled>
                                <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                  <stringValue>nk1[&apos;NK1.7&apos;][&apos;NK1.7.2&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </properties>
                              </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            </entry>
                          </properties>
                        </com.mirth.connect.jsonbuilder.shared.models.ObjectModel>
                      </elements>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>name</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                      <usingBuilder>true</usingBuilder>
                      <properties class="linked-hash-map">
                        <entry>
                          <string>use</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>usual</stringValue>
                              <usingEnum>true</usingEnum>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>family</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>nk1[&apos;NK1.2&apos;][&apos;NK1.2.1&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>given</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                              <usingBuilder>true</usingBuilder>
                              <elements>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>nk1[&apos;NK1.2&apos;][&apos;NK1.2.2&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>nk1[&apos;NK1.2&apos;][&apos;NK1.2.3&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                              </elements>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>prefix</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                              <usingBuilder>true</usingBuilder>
                              <elements>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>nk1[&apos;NK1.2&apos;][&apos;NK1.2.5&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                              </elements>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>suffix</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                              <usingBuilder>true</usingBuilder>
                              <elements>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>nk1[&apos;NK1.2&apos;][&apos;NK1.2.4&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                              </elements>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>period</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                              <usingBuilder>true</usingBuilder>
                              <properties class="linked-hash-map">
                                <entry>
                                  <string>start</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>convertToFhirTimestamp(nk1[&apos;NK1.2&apos;][&apos;NK1.2.12&apos;].toString())</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>end</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <stringValue>convertToFhirTimestamp(nk1[&apos;NK1.2&apos;][&apos;NK1.2.13&apos;].toString())</stringValue>
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                              </properties>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                      </properties>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>telecom</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                      <stringValue>createPatientContactTelecoms(nk1)</stringValue>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>address</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                      <usingBuilder>true</usingBuilder>
                      <properties class="linked-hash-map">
                        <entry>
                          <string>use</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>convertAddressUse(nk1[&apos;NK1.4&apos;][&apos;NK1.4.7&apos;].toString())</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>type</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>false</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>postal</stringValue>
                              <usingEnum>true</usingEnum>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>text</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>(nk1[&apos;NK1.4&apos;][&apos;NK1.4.1&apos;].toString() + &apos; &apos; + nk1[&apos;NK1.4&apos;][&apos;NK1.4.2&apos;].toString() + &apos; &apos; + nk1[&apos;NK1.4&apos;][&apos;NK1.4.3&apos;].toString() + &apos; &apos; + nk1[&apos;NK1.4&apos;][&apos;NK1.4.4&apos;].toString() + &apos; &apos; + nk1[&apos;NK1.4&apos;][&apos;NK1.4.5&apos;].toString() + &apos; &apos; + nk1[&apos;NK1.4&apos;][&apos;NK1.4.6&apos;].toString()).trim()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>line</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                              <usingBuilder>true</usingBuilder>
                              <elements>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>nk1[&apos;NK1.4&apos;][&apos;NK1.4.1&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                                  <stringValue>nk1[&apos;NK1.4&apos;][&apos;NK1.4.2&apos;].toString()</stringValue>
                                  <scriptExpression>true</scriptExpression>
                                </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                              </elements>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>city</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>nk1[&apos;NK1.4&apos;][&apos;NK1.4.3&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>district</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>nk1[&apos;NK1.4&apos;][&apos;NK1.4.9&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>state</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>nk1[&apos;NK1.4&apos;][&apos;NK1.4.4&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>postalCode</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>nk1[&apos;NK1.4&apos;][&apos;NK1.4.5&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>country</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>nk1[&apos;NK1.4&apos;][&apos;NK1.4.6&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>period</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                              <usingBuilder>true</usingBuilder>
                              <properties class="linked-hash-map">
                                <entry>
                                  <string>start</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                                <entry>
                                  <string>end</string>
                                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                    <enabled>true</enabled>
                                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                                      <scriptExpression>true</scriptExpression>
                                    </properties>
                                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                                </entry>
                              </properties>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                      </properties>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>gender</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>convertToFhirGender(nk1[&apos;NK1.15&apos;][&apos;NK1.15.1&apos;].toString())</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
              </properties>
            </model>
            <fhirVersion>R4</fhirVersion>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>f58ca0f3-f121-453d-ad59-b960300fa35f</id>
          <name>Create FHIR Patient Contact Telecoms</name>
          <revision>1</revision>
          <lastModified>
            <time>1595399126383</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Creates a new array of FHIR ContactPoint objects from the given NK1 segment.

	@param {XML} nk1 - The E4X XML NK1 segment from the HL7 v2.x message.
	@return {Array} The array of ContactPoint objects.
*/
function createPatientContactTelecoms(nk1) {
	var telecoms = Lists.list();
	for (var i = 0; i &lt; nk1[&apos;NK1.5&apos;].length(); i++) {
		telecoms.add(createPatientTelecom(nk1[&apos;NK1.5&apos;][i], &apos;home&apos;));
	}
	for (var i = 0; i &lt; nk1[&apos;NK1.6&apos;].length(); i++) {
		telecoms.add(createPatientTelecom(nk1[&apos;NK1.6&apos;][i], &apos;work&apos;));
	}
	return telecoms.toArray();
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>d66442af-90e6-4e2b-813a-b287cdc05af6</id>
          <name>Create FHIR Patient Contacts</name>
          <revision>1</revision>
          <lastModified>
            <time>1595399126573</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Creates a new array of FHIR Patient_Contact objects for all NK1 segments in the message.

	@param {XML} nk1List - The E4X XML NK1 list from the HL7 v2.x message.
	@return {Array} The array of Patient_Contact objects.
*/
function createPatientContacts(nk1List) {
	var contacts = Lists.list();
	for (var i = 0; i &lt; nk1List.length(); i++) {
		contacts.add(createPatientContact(nk1List[i]));
	}
	return contacts.toArray();
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>1f5b9ac0-85c0-4602-a164-89b8e13256ae</id>
          <name>Create FHIR Patient Identifier</name>
          <revision>1</revision>
          <lastModified>
            <time>1595399126899</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.plugins.fhir.shared.FhirModelBuilderCodeTemplateProperties" version="3.9.0">
            <type>FUNCTION</type>
            <functionSignature>createPatientIdentifier(pid3)</functionSignature>
            <jsDoc>/**
	Creates a new FHIR Identifier object from the given PID.3 field.

	@param {XML} pid3 - The E4X XML PID.3 node of the HL7 v2.x message.
	@return {Object} The JavaScript Object representation of the FHIR Identifier.
*/</jsDoc>
            <resultReturnValue>true</resultReturnValue>
            <resultMapType>CHANNEL</resultMapType>
            <resultMapVariable></resultMapVariable>
            <definition>Identifier</definition>
            <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
              <usingBuilder>true</usingBuilder>
              <properties class="linked-hash-map">
                <entry>
                  <string>use</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>false</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>usual</stringValue>
                      <usingEnum>true</usingEnum>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>type</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                      <usingBuilder>true</usingBuilder>
                      <properties class="linked-hash-map">
                        <entry>
                          <string>text</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>pid3[&apos;PID.3.5&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                      </properties>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>system</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>pid3[&apos;PID.3.4&apos;].toString()</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>value</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>pid3[&apos;PID.3.1&apos;].toString()</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>period</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                      <usingBuilder>true</usingBuilder>
                      <properties class="linked-hash-map">
                        <entry>
                          <string>start</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>convertToFhirTimestamp(pid3[&apos;PID.3.7&apos;].toString())</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>end</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>convertToFhirTimestamp(pid3[&apos;PID.3.8&apos;].toString())</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                      </properties>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
              </properties>
            </model>
            <fhirVersion>R4</fhirVersion>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>1132126f-5bd3-4b2f-a11c-f7107114c8da</id>
          <name>Create FHIR Patient Identifiers</name>
          <revision>1</revision>
          <lastModified>
            <time>1595399126627</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Creates a new array of FHIR Identifier objects from the given PID segment.

	@param {XML} pid - The E4X XML PID node from the HL7 v2.x message.
	@return {Array} The array of Identifier objects.
*/
function createPatientIdentifiers(pid) {
	var identifiers = Lists.list();
	for (var i = 0; i &lt; pid[&apos;PID.3&apos;].length(); i++) {
		identifiers.add(createPatientIdentifier(pid[&apos;PID.3&apos;][i]));
	}
	return identifiers.toArray();
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>a446affe-ac81-4fea-8572-336ba63dfeae</id>
          <name>Create FHIR Patient Name</name>
          <revision>1</revision>
          <lastModified>
            <time>1595399126488</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.plugins.fhir.shared.FhirModelBuilderCodeTemplateProperties" version="3.9.0">
            <type>FUNCTION</type>
            <functionSignature>createPatientName(node)</functionSignature>
            <jsDoc>/**
	Creates a new FHIR HumanName object from the given PID.5 or PID.9 field.

	@param {XML} node - The E4X XML PID.5 or PID.9 field from the HL7 v2.x message.
	@return {Object} The JavaScript Object representation of the FHIR HumanName.
*/</jsDoc>
            <resultReturnValue>true</resultReturnValue>
            <resultMapType>CHANNEL</resultMapType>
            <resultMapVariable></resultMapVariable>
            <definition>HumanName</definition>
            <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
              <usingBuilder>true</usingBuilder>
              <properties class="linked-hash-map">
                <entry>
                  <string>use</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>usual</stringValue>
                      <usingEnum>true</usingEnum>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>family</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>node[&apos;PID.5.1&apos;].toString() || node[&apos;PID.9.1&apos;].toString()</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>given</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                      <usingBuilder>true</usingBuilder>
                      <elements>
                        <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                          <stringValue>node[&apos;PID.5.2&apos;].toString() || node[&apos;PID.9.2&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                        <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                          <stringValue>node[&apos;PID.5.3&apos;].toString() || node[&apos;PID.9.3&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                      </elements>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>prefix</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                      <usingBuilder>true</usingBuilder>
                      <elements>
                        <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                          <stringValue>node[&apos;PID.5.5&apos;].toString() || node[&apos;PID.9.5&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                      </elements>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>suffix</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ArrayModel">
                      <usingBuilder>true</usingBuilder>
                      <elements>
                        <com.mirth.connect.jsonbuilder.shared.models.StringModel>
                          <stringValue>node[&apos;PID.5.4&apos;].toString() || node[&apos;PID.9.4&apos;].toString()</stringValue>
                          <scriptExpression>true</scriptExpression>
                        </com.mirth.connect.jsonbuilder.shared.models.StringModel>
                      </elements>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>period</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
                      <usingBuilder>true</usingBuilder>
                      <properties class="linked-hash-map">
                        <entry>
                          <string>start</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>node[&apos;PID.5.12&apos;].toString() || node[&apos;PID.9.12&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                        <entry>
                          <string>end</string>
                          <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                            <enabled>true</enabled>
                            <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                              <stringValue>node[&apos;PID.5.13&apos;].toString() || node[&apos;PID.9.13&apos;].toString()</stringValue>
                              <scriptExpression>true</scriptExpression>
                            </properties>
                          </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                        </entry>
                      </properties>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
              </properties>
            </model>
            <fhirVersion>R4</fhirVersion>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>d73cd539-ab3c-4e82-bd24-81a6025e7ed4</id>
          <name>Create FHIR Patient Names</name>
          <revision>1</revision>
          <lastModified>
            <time>1595399126296</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Creates a new array of FHIR HumanName objects from the given PID segment.

	@param {XML} pid - The E4X XML PID node from the HL7 v2.x message.
	@return {Array} The array of HumanName objects.
*/
function createPatientNames(pid) {
	var names = Lists.list();
	for (var i = 0; i &lt; pid[&apos;PID.5&apos;].length(); i++) {
		names.add(createPatientName(pid[&apos;PID.5&apos;][i]));
	}
	for (var i = 0; i &lt; pid[&apos;PID.9&apos;].length(); i++) {
		names.add(createPatientName(pid[&apos;PID.9&apos;][i]));
	}
	return names.toArray();
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>ab382e75-1993-4d31-b9b8-6295b8d241ca</id>
          <name>Create FHIR Patient Telecom</name>
          <revision>1</revision>
          <lastModified>
            <time>1595399126968</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.plugins.fhir.shared.FhirModelBuilderCodeTemplateProperties" version="3.9.0">
            <type>FUNCTION</type>
            <functionSignature>createPatientTelecom(node, use)</functionSignature>
            <jsDoc>/**
	Creates a new FHIR ContactPoint object from the given PID.13, PID.14, NK1.5, or NK1.6 field.

	@param {XML} node - The E4X XML PID.13, PID.14, NK1.5, or NK1.6 field from the HL7 v2.x message.
	@param {String} use - The FHIR telecom use value: home/work/temp/old/mobile
	@return {Object} The JavaScript Object representation of the FHIR ContactPoint.
*/</jsDoc>
            <resultReturnValue>true</resultReturnValue>
            <resultMapType>CHANNEL</resultMapType>
            <resultMapVariable></resultMapVariable>
            <definition>ContactPoint</definition>
            <model class="com.mirth.connect.jsonbuilder.shared.models.ObjectModel">
              <usingBuilder>true</usingBuilder>
              <properties class="linked-hash-map">
                <entry>
                  <string>system</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>phone</stringValue>
                      <usingEnum>true</usingEnum>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>value</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>node[&apos;PID.13.1&apos;].toString() || node[&apos;PID.14.1&apos;].toString() || node[&apos;NK1.5.1&apos;].toString() || node[&apos;NK1.6.1&apos;].toString()</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
                <entry>
                  <string>use</string>
                  <com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                    <enabled>true</enabled>
                    <properties class="com.mirth.connect.jsonbuilder.shared.models.StringModel">
                      <stringValue>use</stringValue>
                      <scriptExpression>true</scriptExpression>
                    </properties>
                  </com.mirth.connect.jsonbuilder.shared.models.ObjectProperty>
                </entry>
              </properties>
            </model>
            <fhirVersion>R4</fhirVersion>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>2b99377c-f3c3-422e-ab55-3b0d3b344107</id>
          <name>Create FHIR Patient Telecoms</name>
          <revision>1</revision>
          <lastModified>
            <time>1595399126689</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Creates a new array of FHIR ContactPoint objects from the given PID segment.

	@param {XML} pid - The E4X XML PID node from the HL7 v2.x message.
	@return {Array} The array of ContactPoint objects.
*/
function createPatientTelecoms(pid) {
	var telecoms = Lists.list();
	for (var i = 0; i &lt; pid[&apos;PID.13&apos;].length(); i++) {
		telecoms.add(createPatientTelecom(pid[&apos;PID.13&apos;][i], &apos;home&apos;));
	}
	for (var i = 0; i &lt; pid[&apos;PID.14&apos;].length(); i++) {
		telecoms.add(createPatientTelecom(pid[&apos;PID.14&apos;][i], &apos;work&apos;));
	}
	return telecoms.toArray();
}</code>
          </properties>
        </codeTemplate>
      </codeTemplates>
    </codeTemplateLibrary>
    <codeTemplateLibrary version="3.9.0">
      <id>9025896a-65d0-458c-92ac-335fe985a232</id>
      <name>HL7 v2.x to FHIR Helper Functions</name>
      <revision>3</revision>
      <lastModified>
        <time>1595347811780</time>
        <timezone>Etc/UTC</timezone>
      </lastModified>
      <description>General functions to help convert HL7 v2.x to FHIR resources.

These are used by the example HL7 to FHIR transformer, as well as
the &quot;HL7 v2.x to FHIR Creation Functions&quot; code template library.</description>
      <includeNewChannels>false</includeNewChannels>
      <enabledChannelIds>
        <string>42e730bb-0721-435e-8dcf-d25d6d5d1dc6</string>
        <string>e678dbf5-f021-43dc-84ae-967500d5c31a</string>
      </enabledChannelIds>
      <disabledChannelIds>
        <string>1892f241-d643-4abb-b0af-b20b87e0cf12</string>
      </disabledChannelIds>
      <codeTemplates>
        <codeTemplate version="3.9.0">
          <id>2cc062f8-aac9-48e1-947e-0567d4497e07</id>
          <name>Cleanup FHIR Patient</name>
          <revision>1</revision>
          <lastModified>
            <time>1595239062037</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Removes name / telecom / address entries with no actual value.

	@param {Object} patient - The JavaScript Object representing the FHIR Patient.
	@return {Object} The same Object passed in, cleaned up.
*/
function cleanupFhirPatient(patient) {
	// Remove names with no value
	cleanupFhirNames(patient, &apos;name&apos;);
	
	// Remove telecom entries with no value
	cleanupFhirTelecoms(patient, &apos;telecom&apos;);

	// Remove address entries with no value
	cleanupFhirAddresses(patient, &apos;address&apos;);

	if (patient.contact) {
		for each (contact in patient.contact) {
			if (!isFhirNameValid(contact.name)) {
				delete contact.name;
			}
			
			cleanupFhirTelecoms(contact, &apos;telecom&apos;);

			if (!isFhirAddressValid(contact.address)) {
				delete contact.address;
			}
		}
	}

	return patient;
}

function cleanupFhirNames(parent, property) {
	cleanupArray(parent, property, isFhirNameValid);
}

function isFhirNameValid(name) {
	return name &amp;&amp; (!isValueEmpty(name.text) || !isValueEmpty(name.family) || !isValueEmpty(name.given) || !isValueEmpty(name.prefix) || !isValueEmpty(name.suffix));
}

function cleanupFhirTelecoms(parent, property) {
	cleanupArray(parent, property, function(telecom) {
		return !isValueEmpty(telecom.value);
	});
}

function cleanupFhirAddresses(parent, property) {
	cleanupArray(parent, property, isFhirAddressValid);
}

function isFhirAddressValid(address) {
	return address &amp;&amp; (!isValueEmpty(address.text) || !isValueEmpty(address.line) || !isValueEmpty(address.city) || !isValueEmpty(address.state) || !isValueEmpty(address.postalCode) || !isValueEmpty(address.country));
}

function cleanupArray(parent, property, handleFunction) {
	var arr = parent[property];

	if (arr) {
		var length = arr.length;
		for (var i = length - 1; i &gt;= 0; i--) {
			if (!handleFunction(arr[i])) {
				delete arr[i];
				length--;
			}
		}
		arr.length = length;

		// Handle Java arrays
		if (arr.length != length) {
			parent[property] = org.apache.commons.lang3.ArrayUtils.subarray(arr, 0, length);
		}
	}
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>2e62489a-423d-4471-a919-ed3f71827199</id>
          <name>Combine Arrays</name>
          <revision>1</revision>
          <lastModified>
            <time>1595239061955</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Combines two arrays into one. Works with both Java and JavaScript arrays.

	@param {Array} array1 - The first array.
	@param {Array} array2 - The second array.
	@return {Array} The combined array.
*/
function combineArrays(array1, array2) {
	var isJavaArray1 = Object.prototype.toString.call(array1) == &apos;[object JavaArray]&apos;;
	var isJavaArray2 = Object.prototype.toString.call(array2) == &apos;[object JavaArray]&apos;;

	if (isJavaArray1 &amp;&amp; isJavaArray2) {
		return org.apache.commons.lang3.ArrayUtils.addAll(array1, array2);
	} else if (isJavaArray1) {
		for (var i = array1.length - 1; i &gt;= 0; i--) {
			array2.unshift(array1[i]);
		}
		return array2;
	} else {
		for each (value in array2) {
			array1.push(value);
		}
		return array1;
	}
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>6faf1e4b-d159-4d34-a07a-2fe0a3bde4cf</id>
          <name>Consolidate Empty Properties</name>
          <revision>1</revision>
          <lastModified>
            <time>1595239062223</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Removes empty strings, objects and arrays from a JavaScript object.

	@param {Object/Array} obj - The object or array to consolidate.
	@return {Object/Array} The consolidates object or array.
*/
function consolidate(obj) {
	if (typeof obj != &apos;undefined&apos; &amp;&amp; obj != null) {
		var protoToString = Object.prototype.toString.call(obj);
		
		if (obj instanceof Array || protoToString == &apos;[object Array]&apos; || protoToString == &apos;[object JavaArray]&apos;) {
			var length = obj.length;
			
			for (var i = obj.length - 1; i &gt;= 0; i--) {
				if (!doConsolidate(obj, i)) {
					length--;
				}
			}
			obj.length = length;

			// Handle Java Arrays
			if (length != obj.length) {
				obj = org.apache.commons.lang3.ArrayUtils.subarray(obj, 0, length);
			}
		} else if (protoToString == &apos;[object Object]&apos;) {
			for (var property in obj) {
				doConsolidate(obj, property);
			}
		}
	}
	return obj;
}

function doConsolidate(obj, property) {
	var value = obj[property] = consolidate(obj[property]);
	var empty = isValueEmpty(value);
	if (empty) {
		delete obj[property];
	}
	return !empty;
}

function isValueEmpty(value) {
	var protoToString = Object.prototype.toString.call(value);

	if (typeof value == &apos;undefined&apos; || value == null) {
		return true;
	} else if (value instanceof Array || protoToString == &apos;[object Array]&apos; || protoToString == &apos;[object JavaArray]&apos;) {
		if (value.length &gt; 0) {
			for each (element in value) {
				if (!isValueEmpty(element)) {
					return false;
				}
			}
		}
		return true;
	} else if (typeof value == &apos;string&apos; || protoToString == &apos;[object String]&apos;) {
		return value.length == 0;
	} else if (value instanceof java.lang.String) {
		return org.apache.commons.lang3.StringUtils.isEmpty(value);
	} else if (protoToString == &apos;[object Object]&apos;) {
		for (var property in value) {
			if (!isValueEmpty(value[property])) {
				return false;
			}
		}
		return true;
	}

	return false;
}
</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>b7bffbe4-9da5-40a8-8a35-7e3ad5a9bebf</id>
          <name>Convert Address Use</name>
          <revision>1</revision>
          <lastModified>
            <time>1595239061836</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Converts an HL7 v2.x address type code to the corresponding FHIR address use.

	@param {String} code - The HL7 address type (Table 0190)
	@return {String} The FHIR address use code
*/
function convertAddressUse(code) {
	var fhirCode;
	
	switch ((code + &apos;&apos;).toUpperCase()) {
		case &apos;H&apos;:
		case &apos;L&apos;:
		case &apos;M&apos;:
		case &apos;P&apos;:
		case &apos;SH&apos;:
			fhirCode = org.hl7.fhir.r4.model.codesystems.AddressUse.HOME;
			break;
		case &apos;B&apos;:
		case &apos;O&apos;:
		case &apos;BI&apos;:
			fhirCode = org.hl7.fhir.r4.model.codesystems.AddressUse.WORK;
			break;
		case &apos;C&apos;:
		case &apos;V&apos;:
			fhirCode = org.hl7.fhir.r4.model.codesystems.AddressUse.TEMP;
			break;
		default:
			fhirCode = org.hl7.fhir.r4.model.codesystems.AddressUse.OLD;
	}

	return fhirCode.toCode();
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>687a3eef-3155-47c8-bb12-de158d0055ac</id>
          <name>Convert Date</name>
          <revision>1</revision>
          <lastModified>
            <time>1595239061729</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Converts an HL7 v2.x formatted date into the correct format for FHIR date.
	
	HL7 format expected: yyyyMMdd
	FHIR format: yyyy-MM-dd

	@param {String} date - The HL7 v2.x date string
	@return {String} The converted FHIR date string
*/
function convertToFhirDate(date) {
	return convertToFhirTimestamp(date, &quot;yyyy-MM-dd&quot;);
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>f338c38c-477a-4dca-8714-2e96c382716e</id>
          <name>Convert Gender</name>
          <revision>1</revision>
          <lastModified>
            <time>1595239061888</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Converts an HL7 v2.x gender code to the corresponding FHIR code.

	@param {String} code - The HL7 gender code (Table 0001)
	@return {String} The FHIR administrative gender code
*/
function convertToFhirGender(code) {
	var fhirCode;
	
	switch ((code + &apos;&apos;).toUpperCase()) {
		case &apos;F&apos;:
			fhirCode = org.hl7.fhir.r4.model.codesystems.AdministrativeGender.FEMALE;
			break;
		case &apos;M&apos;:
			fhirCode = org.hl7.fhir.r4.model.codesystems.AdministrativeGender.MALE;
			break;
		case &apos;O&apos;:
		case &apos;A&apos;:
		case &apos;N&apos;:
			fhirCode = org.hl7.fhir.r4.model.codesystems.AdministrativeGender.OTHER;
			break;
		case &apos;U&apos;:
		default:
			fhirCode = org.hl7.fhir.r4.model.codesystems.AdministrativeGender.UNKNOWN;
	}

	return fhirCode.toCode();
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>0061fef8-39be-48c1-b81e-60719c97c149</id>
          <name>Convert Timestamp</name>
          <revision>1</revision>
          <lastModified>
            <time>1595239061787</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Converts an HL7 v2.x formatted timestamp into the correct format for FHIR dateTime.
	
	HL7 format expected: yyyyMMddHHmmssZZ
	FHIR format: yyyy-MM-dd&apos;T&apos;HH:mm:ssZZ

	@param {String} date - The HL7 v2.x timestamp string
	@return {String} The converted FHIR timestamp string
*/
function convertToFhirTimestamp(date) {
	if (!date) {
		return &apos;&apos;;
	}

	var patterns = [
		&quot;yyyyMMddHHmmss.SSSZZ&quot;,
		&quot;yyyyMMddHHmmss.SSSZ&quot;,
		&quot;yyyyMMddHHmmss.SSS&quot;,
		&quot;yyyyMMddHHmmssZZ&quot;,
		&quot;yyyyMMddHHmmssZ&quot;,
		&quot;yyyyMMddHHmmss&quot;,
		&quot;yyyyMMddHHmm&quot;,
		&quot;yyyyMMddHH&quot;,
		&quot;yyyyMMdd&quot;
	];

	var instant;
	for each (pattern in patterns) {
		try {
			instant = org.joda.time.format.DateTimeFormat.forPattern(pattern).parseMillis(new String(date));
			break;
		} catch(e) {}
	}

	if (instant) {
		var outpattern = arguments.length &gt;= 2 ? arguments[1] : &quot;yyyy-MM-dd&apos;T&apos;HH:mm:ssZZ&quot;;
		try {
			return org.joda.time.format.DateTimeFormat.forPattern(outpattern).print(instant);
		} catch (e) {}
	}
	
	return date;
}</code>
          </properties>
        </codeTemplate>
        <codeTemplate version="3.9.0">
          <id>760658e4-f24f-4a57-bbb9-9ae847f6daf8</id>
          <name>Convert Yes/No Indicator</name>
          <revision>1</revision>
          <lastModified>
            <time>1595239062132</time>
            <timezone>Etc/UTC</timezone>
          </lastModified>
          <contextSet>
            <delegate>
              <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
              <contextType>DESTINATION_DISPATCHER</contextType>
              <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
              <contextType>SOURCE_RECEIVER</contextType>
              <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
            </delegate>
          </contextSet>
          <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
            <type>FUNCTION</type>
            <code>/**
	Converts an HL7 v2.x yes/no indicator code to a boolean value. If the code is null or an empty string,
	false will be returned.

	@param {String} code - The HL7 yes/no indicator (Table 0136)
	@return {Boolean} True/false
*/
function convertYesNoIndicator(code) {
	return code == &apos;Y&apos;;
}</code>
          </properties>
        </codeTemplate>
      </codeTemplates>
    </codeTemplateLibrary>
  </codeTemplateLibraries>
  <serverSettings>
    <clearGlobalMap>true</clearGlobalMap>
    <queueBufferSize>1000</queueBufferSize>
    <defaultMetaDataColumns>
      <metaDataColumn>
        <name>SOURCE</name>
        <type>STRING</type>
        <mappingName>mirth_source</mappingName>
      </metaDataColumn>
      <metaDataColumn>
        <name>TYPE</name>
        <type>STRING</type>
        <mappingName>mirth_type</mappingName>
      </metaDataColumn>
    </defaultMetaDataColumns>
    <defaultAdministratorBackgroundColor>
      <red>158</red>
      <green>177</green>
      <blue>201</blue>
      <alpha>255</alpha>
    </defaultAdministratorBackgroundColor>
    <smtpTimeout>5000</smtpTimeout>
    <smtpSecure>0</smtpSecure>
    <smtpAuth>false</smtpAuth>
  </serverSettings>
  <updateSettings version="3.9.0">
    <statsEnabled>true</statsEnabled>
    <lastStatsTime>1594999979141</lastStatsTime>
  </updateSettings>
  <globalScripts>
    <entry>
      <string>Undeploy</string>
      <string>// This script executes once for each deploy, undeploy, or redeploy task
// if at least one channel was undeployed
// You only have access to the globalMap here to persist data
return;</string>
    </entry>
    <entry>
      <string>Postprocessor</string>
      <string>// This script executes once after a message has been processed
// This script applies across all channels
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
// You have access to &quot;response&quot;, if returned from the channel postprocessor
return;</string>
    </entry>
    <entry>
      <string>Deploy</string>
      <string>// This script executes once for each deploy or redeploy task
// You only have access to the globalMap here to persist data
return;</string>
    </entry>
    <entry>
      <string>Preprocessor</string>
      <string>// Modify the message variable below to pre process data
// This script applies across all channels
return message;</string>
    </entry>
  </globalScripts>
  <pluginProperties>
    <entry>
      <string>Data Pruner</string>
      <properties>
        <property name="archiveEnabled">&lt;boolean&gt;false&lt;/boolean&gt;</property>
        <property name="archiverBlockSize">50</property>
        <property name="archiverOptions">&lt;com.mirth.connect.util.messagewriter.MessageWriterOptions&gt;
  &lt;destinationContent&gt;false&lt;/destinationContent&gt;
  &lt;encrypt&gt;false&lt;/encrypt&gt;
  &lt;includeAttachments&gt;false&lt;/includeAttachments&gt;
  &lt;passwordEnabled&gt;false&lt;/passwordEnabled&gt;
&lt;/com.mirth.connect.util.messagewriter.MessageWriterOptions&gt;</property>
        <property name="enabled">false</property>
        <property name="includeAttachments">&lt;boolean&gt;false&lt;/boolean&gt;</property>
        <property name="maxEventAge"></property>
        <property name="pollingProperties">&lt;com.mirth.connect.donkey.model.channel.PollConnectorProperties version=&quot;3.9.0&quot;&gt;
  &lt;pollingType&gt;INTERVAL&lt;/pollingType&gt;
  &lt;pollOnStart&gt;false&lt;/pollOnStart&gt;
  &lt;pollingFrequency&gt;3600000&lt;/pollingFrequency&gt;
  &lt;pollingHour&gt;0&lt;/pollingHour&gt;
  &lt;pollingMinute&gt;0&lt;/pollingMinute&gt;
  &lt;cronJobs/&gt;
  &lt;pollConnectorPropertiesAdvanced&gt;
    &lt;weekly&gt;true&lt;/weekly&gt;
    &lt;inactiveDays&gt;
      &lt;boolean&gt;false&lt;/boolean&gt;
      &lt;boolean&gt;false&lt;/boolean&gt;
      &lt;boolean&gt;false&lt;/boolean&gt;
      &lt;boolean&gt;false&lt;/boolean&gt;
      &lt;boolean&gt;false&lt;/boolean&gt;
      &lt;boolean&gt;false&lt;/boolean&gt;
      &lt;boolean&gt;false&lt;/boolean&gt;
      &lt;boolean&gt;false&lt;/boolean&gt;
    &lt;/inactiveDays&gt;
    &lt;dayOfMonth&gt;1&lt;/dayOfMonth&gt;
    &lt;allDay&gt;true&lt;/allDay&gt;
    &lt;startingHour&gt;8&lt;/startingHour&gt;
    &lt;startingMinute&gt;0&lt;/startingMinute&gt;
    &lt;endingHour&gt;17&lt;/endingHour&gt;
    &lt;endingMinute&gt;0&lt;/endingMinute&gt;
  &lt;/pollConnectorPropertiesAdvanced&gt;
&lt;/com.mirth.connect.donkey.model.channel.PollConnectorProperties&gt;</property>
        <property name="pruneEvents">false</property>
        <property name="pruningBlockSize">1000</property>
      </properties>
    </entry>
  </pluginProperties>
  <resourceProperties>
    <list>
      <com.mirth.connect.plugins.directoryresource.DirectoryResourceProperties version="3.9.0">
  <pluginPointName>Directory Resource</pluginPointName>
        <type>Directory</type>
        <id>Default Resource</id>
        <name>[Default Resource]</name>
        <description>Loads libraries from the custom-lib folder in the Mirth Connect home directory.</description>
        <includeWithGlobalScripts>true</includeWithGlobalScripts>
        <directory>/opt/connect/appdata/unibolibs</directory>
        <directoryRecursion>true</directoryRecursion>
      </com.mirth.connect.plugins.directoryresource.DirectoryResourceProperties>
    </list>
  </resourceProperties>
  <channelDependencies/>
  <configurationMap>
    <entry>
      <string>fhirDBDatabaseType</string>
      <com.mirth.connect.util.ConfigurationProperty>
        <value>MySQL</value>
      </com.mirth.connect.util.ConfigurationProperty>
    </entry>
    <entry>
      <string>fhirDBMaxRetries</string>
      <com.mirth.connect.util.ConfigurationProperty>
        <value>3</value>
      </com.mirth.connect.util.ConfigurationProperty>
    </entry>
    <entry>
      <string>fhirDBUrl</string>
      <com.mirth.connect.util.ConfigurationProperty>
        <value>jdbc:mysql://db:3306/mirthdb</value>
      </com.mirth.connect.util.ConfigurationProperty>
    </entry>
    <entry>
      <string>fhirDBDriver</string>
      <com.mirth.connect.util.ConfigurationProperty>
        <value>com.mysql.jdbc.Driver</value>
      </com.mirth.connect.util.ConfigurationProperty>
    </entry>
    <entry>
      <string>fhirDBUsername</string>
      <com.mirth.connect.util.ConfigurationProperty>
        <value>root</value>
      </com.mirth.connect.util.ConfigurationProperty>
    </entry>
    <entry>
      <string>fhirDBPassword</string>
      <com.mirth.connect.util.ConfigurationProperty>
        <value>root_password</value>
      </com.mirth.connect.util.ConfigurationProperty>
    </entry>
  </configurationMap>
</serverConfiguration>
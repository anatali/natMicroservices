<html xmlns:th="http://www.thymeleaf.org"> 
<head><title>SpringBootIntro</title>

</head>

<body>
<h1>SpringBootIntro</h1>
<p>
<ul>
<li><a href="./">Welcome!</a>. I am the Human Interface GUI defined in 
<a href="./welcome">src/main/resources/templates/welcome.hmtl</a>.<br/><br/>
</li>

<li>The <a href="humanInterfaceController">
src/main/java/HumanInterfaceController.java</a>
injects into me the address of the server running application:<br/> 

<pre>ipaddress=<span th:text="${address}"  id="serveraddr">0</span>
port=<span th:text="${port}" id="serverport">0</span></pre>
</li>

<li>which is in turn defined in 
 
 <a href="./properties">src/main/resources/application.properties</a>
 <br/> 
</li>


</ul>
 
  </p>
 
 
 
 
 
 <h3>Info area</h3> 
 <hr/>
 <pre><span th:text="${info}" id="info">0</span></pre>
 <hr/>
 
 <!--
//WARNING: CORS policy. 
//See https://medium.com/@dtkatz/3-ways-to-fix-the-cors-error-and-how-access-control-allow-origin-works-d97d55946d9
//Remember https://ipinfo.io/json: xhr.open('GET', "https://ipinfo.io/json", true);
/*
0	UNSENT	The open method hasn't been called yet
1	OPENED	The send method has been called
2	HEADERS_RECEIVED	The send method has been called and the HTTP request has returned the status and headers
3	LOADING	The HTTP request response is being downloaded
4	DONE	Everything has completed
The readyState property chronicles the path our HTTP request takes, 
and each change in its value results in the readystatechange event getting fired. 

For every HTTP request that we make, our readyState property hits each of these five values. 
This means our readystatechange event gets fired five times.
*/

 <script>
let xhr = new XMLHttpRequest();
let ipaddr = document.querySelector("#serveraddr").innerHTML
let port   = document.querySelector("#serverport").innerHTML
xhr.open('GET', "http://"+ipaddr+":"+port+"/info", true);
xhr.send();
xhr.onreadystatechange = processRequestAnswerAsText;

function processRequestAnswerAsText(e) {
	console.log("done " + e + " readyState=" + xhr.readyState + " status=" + xhr.status);
    if (xhr.readyState == 4 && xhr.status == 200) {
        let response =  xhr.responseText;
        console.log( response);
        document.querySelector("#info").innerHTML = response ;
    }
}  

function processRequestAnswerInJson(e) {
	console.log("done " + e + " readyState=" + xhr.readyState + " status=" + xhr.status);
    if (xhr.readyState == 4 && xhr.status == 200) {
        let response = JSON.parse(xhr.responseText);       
        console.log( response);
        document.querySelector("#info").innerHTML = response.ip;
    }
}      
</script>
 -->
<!--
ANOTHER WAY TO CALL
<script>
/*
    fetch("https://ipinfo.io/json")
    //fetch("http://localhost:8080/info")
      .then(function (response) {
        //console.log("response: " + response.json().ip);
        return response.json();
      })
      .then(function (myJson) {
        console.log("response: " + myJson.ip);
        document.querySelector("#ipText").innerHTML = myJson.ip;
      })
      .catch(function (error) {
        console.log("Error: " + error);
      });
*/
</script>

<script type="text/javascript">
    var ip = location.host;;
    //alert(ip);
/*    
function httpGet(theUrl)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
    xmlHttp.send( null );
    return xmlHttp.responseText;
}

$.get(
    "index.html",
    {paramOne : 1, paramX : 'abc'},
    function(data) {
       alert('page content: ' + data);
    }
);    
*/
</script>
-->
</body>
</html>